# Day 1数据库基础

### 一、数据库简介【重点掌握】

#### 1.数据库系统

> 数据库是数据的仓库，被称为DataBase【简称DB】,指的是长期保存在计算机上的存储设备上，按照一定的顺序组织起来，可以被各种用户或者引用共享的数据
>
> 本质：存储，维护和管理数据的集合
>
> 与普通的数据仓库不同的是，数据库依据数据结构来组织数据，因为有了数据结构，数据库中的数据比较条理化
>
> 【面试题】数据库的特点及作用：
>
> ​	a.将数据保存到文件或者内存
>
> ​	b.接收特定的命令，然后对文件作出相应的操作
>
> ​	c.具有极快的查找速度【可以根据自己 的结构特性来实现快速查找】
>
> ​	d.可以给一个个的字段添加约束【与excel表格相比】
>
> 注意：常见的xxx数据库，其实就是xxx数据库管理系统，数据库管理系统其实就是一个软件，是数据库管理的程序实现

#### 2.常见数据库管理系统

> DataBase:DB,数据库
>
> DataBase Management System:DBMS,数据库管理系统
>
> 数据库管理系统：是一种操作和管理数据库的软件，用于建立，使用和维护数据库，对数据库进行统一的管理和控制，以保证数据库的安全性和完整性，用户通过数据库管理系统访问数据库中的数据
>
> 【面试题】：数据库和数据库管理系统之间的关系
>
> ​	数据库：存储，维护和管理数据的集合【容器】
>
> ​	数据库管理系统：就是一个数据库软件，可以对数据库进行管理和控制
>
> 用户访问数据库中的数据的顺序：数据库管理系统【DBMS】------》数据库【DB】------》数据表【Table】-----》数据【依据条件】【实体】
>
> 常见的数据库管理系统:sqlserver,MySql,Oracle,SQlite,Redis,MongoDB等
>
> 1>Oracle（甲骨文）:目前比较成功的关系型数据库管理系统，运行稳定，功能齐全，性能超群，技术领先，主要应用在大型的企业数据库领域
>
> 2>DB2:IBM（国际商业机器公司）的产品，伸缩性比较强
>
> 3>SQL Server:Microsoft的产品，软件界面友好，易学易用，在操作性和交互性方面独树一帜
>
> 4>PostgreSQL:加州大学伯克利分校以教学为目地开发的数据库系统，支持关系和面向对象的数据库，属于数据库管理系统
>
> 5>MySQL:免费的数据库系统，被广泛引用于中小型应用系统，体积小，速度快，总体拥有成本低，开发源代码，2008年被SUN收购，2009年SUN被Oracle收购

#### 3.关系型数据库

> 关系型数据库是依据数据之间的关系【关系模型】来创建的数据库
>
> 关系模型：一对一，一对多，多对多等关系模型，关系型数据库可以很好的存储一些关系模型的数据，比如：一个老师对应多个学生的数据【多对多】，一本书对应多个作者【一对多】，一本书对应一个出版日期【一对一】
>
> MySQL是一个典型的关系型数据库，是一种关联数据库管理系统，关联数据库将保存在不同的表中
>
> MySQL的特点：
>
> ​	a.MySQL是开源的，所以是免费的
>
> ​	b.MySQL支持大型的数据库，可以处理上千万条记录的数据库
>
> ​	c.使用的是标准的SQL数据语言形式
>
> ​	d.可以运行在多个系统上，并且支持多种语言，例如：c,C++，Python，Java,PHP,Ruby等
>
> ​	e.可以定制的，你可以通过修改源码来开发自己的MySQL系统	

### 二、数据库安装

#### 1.安装方式

> 1.验证是否安装MySQL
>
> ```python
> 演示命令：
> yangyang@yangyang-virtualmachine:~$ mysql -u root -p		#登录MySQL数据库
> Enter password: 
> ERROR 2002 (HY000): Can't connect to local MySQL server through socket 	'/var/run/mysqld/mysqld.sock' (2)				#报错，说明数据库没有启动
> yangyang@yangyang-virtualmachine:~$ sudo service mysql start		#启动数据库
> yangyang@yangyang-virtualmachine:~$ mysql -u root -p		
> Enter password: 							#输入数据库密码rock1204
> Welcome to the MySQL monitor.  Commands end with ; or \g.		#出现左边的信息说明已经安装
> Your MySQL connection id is 3
> Server version: 5.7.22-0ubuntu0.16.04.1 (Ubuntu)
> 
> Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.
> 
> Oracle is a registered trademark of Oracle Corporation and/or its
> affiliates. Other names may be trademarks of their respective
> owners.
> 
> Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
> 
> mysql> exit		#退出数据库
> Bye
> ```

> 2.方式一：使用离线安装
>
> ##### 第一步：下载MySQL资源，安装之前请先卸载之前的，一定要卸载干净
>
> https://dev.mysql.com/downloads/file/?id=477124，进入官网之后直接点击No thanks, just start my download，下载下来的是mysql-apt-config_0.8.10-1_all.deb安装包【注意：如果是其他的则有问题】
>
> ##### 第二步：在终端里输入下面的命令安装下载的发布包
>
> sudo dpkg   -i  文件路径+文件名　
> 也可以cd到文件目录下，直接执行sudo  dpkg    -i    mysql-apt-config_0.8.10-1_all.deb
>
> ##### 第三步：使用以下命令从MySQL APT存储库更新包信息
>
> sudo apt-get update
>
> ##### 第四步：安装MySQL
>
> sudo apt-get install mysql-server　
>
> 注意：这里要选择第二个，不然安装之后只有用sudo才能进入MySQL，而且不能使用数据库

> 3.方式二：在线安装
>
> sudo apt-get install mysql-server，执行完，设置数据库密码
>
> sudo apt-get install mysql-client
>
> sudo apt-get install libmysqlclient-dev
>
> sudo netstat -tap | grep mysql

> 4.方式四：在线安装
>
> sudo apt-get update
>
> sudo apt-get install mysql-server
>
> 安装完mysql-server 会提示可以运行mysql_secure_installation。运行mysql_secure_installation会执行几个设置：
> --为root用户设置密码
> --删除匿名账号
> --取消root用户远程登录
> --删除test库和对test库的访问权限
> --刷新授权表使修改生效
>
> 通过这几项的设置能够提高mysql库的安全。建议生产环境中mysql安装这完成后一定要运行一次mysql_secure_installation，相关操作如下
>
> ```shell
> [root@localhost ~]# mysql_secure_installation
> NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
> SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!
> In order to log into MySQL to secure it, we'll need the current
> password for the root user. If you've just installed MySQL, and
> you haven't set the root password yet, the password will be blank,
> so you should just press enter here.
> Enter current password for root (enter for none):<–初次运行直接回车
> OK, successfully used password, moving on…
> Setting the root password ensures that nobody can log into the MySQL
> root user without the proper authorisation.
> Set root password? [Y/n]    #是否设置root用户密码，输入y并回车或直接回车
> New password:               #设置root用户的密码
> Re-enter new password:      #再输入一次你设置的密码
> Password updated successfully!
> Reloading privilege tables..
> … Success!
> By default, a MySQL installation has an anonymous user, allowing anyone
> to log into MySQL without having to have a user account created for
> them. This is intended only for testing, and to make the installation
> go a bit smoother. You should remove them before moving into a
> production environment.
> Remove anonymous users? [Y/n]   #是否删除匿名用户,生产环境建议删除，所以直接回车
> … Success!
> Normally, root should only be allowed to connect from 'localhost'. This
> ensures that someone cannot guess at the root password from the network.
> Disallow root login remotely? [Y/n] #是否禁止root远程登录,根据自己的需求选择Y/n并回车,建议禁止
> … Success!
> By default, MySQL comes with a database named 'test' that anyone can
> access. This is also intended only for testing, and should be removed
> before moving into a production environment.
> Remove test database and access to it? [Y/n] #是否删除test数据库,直接回车
> - Dropping test database…
> … Success!
> - Removing privileges on test database…
> … Success!
> Reloading the privilege tables will ensure that all changes made so far
> will take effect immediately.
> Reload privilege tables now? [Y/n] #是否重新加载权限表，直接回车
> … Success!
> Cleaning up…
> All done! If you've completed all of the above steps, your MySQL
> installation should now be secure.
> Thanks for using MySQL!
> [root@localhost ~]#
> ```
>
> 数据库设置：参见mysql配置详解，配置文件在/etc/my.cnf
>
> 检查mysql服务状态：systemctl status mysql.service

#### 2.卸载方式

> 如果之前有安装,不能使用的话 可按如下步骤卸载
>
> ```python
> 演示命令：
> #第一步：依次执行下面的语句
> sudo apt-get autoremove --purge mysql-server
> sudo apt-get remove mysql-server
> sudo apt-get autoremove mysql-server
> sudo apt-get remove mysql-common 
> 
> #第二步：清理残留数据
> dpkg -l |grep ^rc|awk '{print $2}' |sudo xargs dpkg -P
> #这个步骤尽量多执行几次，清理干净
> ```

#### 3.启动和停止mysql服务

> 检查MySQL的状态：**sudo service mysql status**
>
> 开启MySQL服务器：**sudo service mysql start**
>
> 关闭MySQL服务器：**sudo service mysql stop**
>
> mysql服务的默认端口：3306

#### 4.其他命令

> ```shell
> #1.连接shell：进入mysql数据库的shell交互环境对其进行管理
> mysql -u root -p
> 
> #2.查看当前mysql的版本
> select version();
> 
> #3.查看当前时间
> select now();
> 
> #4.退出mysql
> exit
> quit
> ctrl+d
> ```

### 三、SQL概述

#### 1.简介

> SQL：Structure   Query  Language,结构查询语言
>
> ​	各个数据库厂商都支持SQL标准-----》普通话
>
> ​	各个数据库厂商在标准的基础上做了扩展------》方言	

#### 2.数据库服务器、数据库和表之间的关系【面试题】

> 数据库服务器【数据库管理系统】：只是在计算机上安装了一个应用程序，可以实现数据的管理和控制，该管理程序可以管理多个数据库
>
> 数据库：在一个数据库管理系统中，可以创建多个数据库库，一般开发人员会针对每一个应用创建一个数据库
>
> 数据表：在一个数据库中，可以具体的需求可以创建多张表，为了保存实体中的数据，

#### 3.数据在SQL中的存储形式

> 举例：User表
>
> id     	name 		age
>
> 1		zhangsan	10
>
> 2 		lisi 			18
>
> 说明：
>
> ​	a.表中的一行为一条记录【实体】
>
> ​	b.表中的一列记录的是同种类型的数据

#### 4.SQL的分类

> DDL：Data Definition   Language,数据定义语言，用户创建，修改和删除库和表结构，关键字为：CREATE   ALTER  DROP
>
> DML:Data  Manipulation Language,数据操作语言，用于对数据表进行增删改的操作，关键字：insert   update  delete
>
> DQL:Data Query  Language,数据查询语言，用于对数据表进行查询的操作，关键字：select       from     where       group by         having       order by     limit
>
> DCL:Data Control Language,数据控制语言，用来定义访问权限和安全级别

### 四、数据库操作

> 1、创建数据库
> 命令：create database <数据库名>
>
> 2、显示所有的数据库
> 命令：show databases （注意：最后有个s）
>
> 3、删除数据库
> 命令：drop database <数据库名>
>
> 4、连接数据库
> 命令：use <数据库名>
>
> 5、查看当前使用的数据库
> mysql> select database();
> 6、当前数据库包含的表信息：
> mysql> show tables; （注意：最后有个s）
>
> 注意：创建数据表之前，一定要选择数据库并且连接成功，只有连接成功之后才可以在当前数据库下创建数据表
>
> ```shell
> 演示命令：
> mysql> create database mydb3;
> Query OK, 1 row affected (0.01 sec)
> 
> mysql> show databases;
> +--------------------+
> | Database           |
> +--------------------+
> | information_schema |
> | mydb1              |
> | mydb2              |
> | mydb3              |
> | mysql              |
> | performance_schema |
> | sys                |
> +--------------------+
> 7 rows in set (0.00 sec)
> 
> mysql> select database();
> +------------+
> | database() |
> +------------+
> | mydb1      |
> +------------+
> 1 row in set (0.00 sec)
> 
> mysql> use mydb3; 
> Database changed
> mysql> select database();
> +------------+
> | database() |
> +------------+
> | mydb3      |
> +------------+
> 1 row in set (0.00 sec)
> 
> mysql> drop database mydb2;
> Query OK, 0 rows affected (0.01 sec)
> 
> mysql> show databases;
> +--------------------+
> | Database           |
> +--------------------+
> | information_schema |
> | mydb1              |
> | mydb3              |
> | mysql              |
> | performance_schema |
> | sys                |
> +--------------------+
> 6 rows in set (0.00 sec)
> 
> mysql> show tables;
> Empty set (0.01 sec)
> 
> mysql> 
> ```

### 五、数据表操作

#### 1.DDL

##### 1.1create创建

> 语法：
>
> ```mysql
> #创建数据库
> CREATE DATABASE database_name;
> 
> #创建表
> CREATE TABLE 表名(
> 		字段1 字段类型[列级别约束条件][默认值]，
> 		字段2 字段类型[列级别约束条件][默认值]，
> 		….
> 		字段n 字段类型[列级别约束条件][默认值]
> 		[表级别约束条件]
> )
> ```

> ```shell
> 1.数字数据类型
> #- INT - 正常大小的整数，可以带符号。如果是有符号的，它允许的范围是从-2147483648到2147483647。如果是无符号，允许的范围是从0到4294967295。 可以指定多达11位的宽度。
> - TINYINT - 一个非常小的整数，可以带符号。如果是有符号，它允许的范围是从-128到127。如果是无符号，允许的范围是从0到255，可以指定多达4位数的宽度。
> - SMALLINT - 一个小的整数，可以带符号。如果有符号，允许范围为-32768至32767。如果无符号，允许的范围是从0到65535，可以指定最多5位的宽度。
> - MEDIUMINT - 一个中等大小的整数，可以带符号。如果有符号，允许范围为-8388608至8388607。 如果无符号，允许的范围是从0到16777215，可以指定最多9位的宽度。
> - BIGINT - 一个大的整数，可以带符号。如果有符号，允许范围为-9223372036854775808到9223372036854775807。如果无符号，允许的范围是从0到18446744073709551615. 可以指定最多20位的宽度。
> #- FLOAT(M,D) - 不能使用无符号的浮点数字。可以定义显示长度(M)和小数位数(D)。这不是必需的，并且默认为10,2。其中2是小数的位数，10是数字(包括小数)的总数。小数精度可以到24个浮点。     单精度
> #- DOUBLE(M,D) - 不能使用无符号的双精度浮点数。可以定义显示长度(M)和小数位数(D)。 这不是必需的，默认为16,4，其中4是小数的位数。小数精度可以达到53位的DOUBLE。 REAL是DOUBLE同义词。  双精度
> - DECIMAL(M,D) - 非压缩浮点数不能是无符号的。在解包小数，每个小数对应于一个字节。定义显示长度(M)和小数(D)的数量是必需的。 NUMERIC是DECIMAL的同义词。
> 
> 2.日期和时间类型
> #- DATE - 以YYYY-MM-DD格式的日期，在1000-01-01和9999-12-31之间。 例如，1973年12月30日将被存储为1973-12-30。
> #- DATETIME - 日期和时间组合以YYYY-MM-DD HH:MM:SS格式，在1000-01-01 00:00:00 到9999-12-31 23:59:59之间。例如，1973年12月30日下午3:30，会被存储为1973-12-30 15:30:00。
> - TIMESTAMP - 1970年1月1日午夜之间的时间戳，到2037的某个时候。这看起来像前面的DATETIME格式，无需只是数字之间的连字符; 1973年12月30日下午3点30分将被存储为19731230153000(YYYYMMDDHHMMSS)。
> #- TIME - 存储时间在HH:MM:SS格式。
> - YEAR(M) - 以2位或4位数字格式来存储年份。如果长度指定为2(例如YEAR(2))，年份就可以为1970至2069(70〜69)。如果长度指定为4，年份范围是1901-2155，默认长度为4。
> 
> 3.字符串类型
> 虽然数字和日期类型比较有意思，但存储大多数数据都可能是字符串格式。 下面列出了在MySQL中常见的字符串数据类型。
> #- CHAR(M) - 固定长度的字符串是以长度为1到255之间个字符长度(例如：CHAR(5))，存储右空格填充到指定的长度。 限定长度不是必需的，它会默认为1。
> #- VARCHAR(M) - 可变长度的字符串是以长度为1到255之间字符数(高版本的MySQL超过255); 例如： VARCHAR(25). 创建VARCHAR类型字段时，必须定义长度。
> - BLOB or TEXT - 字段的最大长度是65535个字符。 BLOB是“二进制大对象”，并用来存储大的二进制数据，如图像或其他类型的文件。定义为TEXT文本字段还持有大量的数据; 两者之间的区别是，排序和比较上存储的数据，BLOB大小写敏感，而TEXT字段不区分大小写。不用指定BLOB或TEXT的长度。
> - TINYBLOB 或 TINYTEXT - BLOB或TEXT列用255个字符的最大长度。不指定TINYBLOB或TINYTEXT的长度。
> - MEDIUMBLOB or MEDIUMTEXT - BLOB或TEXT列具有16777215字符的最大长度。不指定MEDIUMBLOB或MEDIUMTEXT的长度。
> - LONGBLOB 或 LONGTEXT -  BLOB或TEXT列具有4294967295字符的最大长度。不指定LONGBLOB或LONGTEXT的长度。
> #- ENUM - 枚举，这是一个奇特的术语列表。当定义一个ENUM，要创建它的值的列表，这些是必须用于选择的项(也可以是NULL)。例如，如果想要字段包含“A”或“B”或“C”，那么可以定义为ENUM为 ENUM(“A”，“B”，“C”)也只有这些值(或NULL)才能用来填充这个字段。
> 
> 
> 
> #整数类型：int
> #浮点数类型：float  / double
> #字符串类型：varchar
> #日期类型：date/datetime/time
> ```
>
> 【面试题】主要了解 char 和 varchar 的区别
>
> char(M)是固定长度的字符串， 在定义时指定字符串列长。当保存数据时如果长度不够在右侧填充空格以达到指定的长度。M 表示列的长度，M 的取值范围是0-255个字符
>
> varchar(M)是长度可变的字符串，M 表示最大的列长度。M 的取值范围是0-65535。varchar的最大实际长度是由最长的行的大小和使用的字符集确定的，而实际占用的空间为字符串的实际长度+1

> 需求：创建一个员工表
>
> 字段				数据类型
>
> id			  			整型
>
> name					字符型
>
> gender					字符型
>
> birthday			        日期型
>
> entry_date				日期型
>
> job						字符型
>
> salary					 浮点型	
>
> ```shell
> 演示命令：
> mysql> select database();
> +------------+
> | database() |
> +------------+
> | mydb3      |
> +------------+
> 1 row in set (0.01 sec)
> 
> mysql> use mydb1;
> Database changed
> mysql> select database();
> +------------+
> | database() |
> +------------+
> | mydb1      |
> +------------+
> 1 row in set (0.00 sec)
> 
> mysql> create table worker(
>  -> id int(10),
>  -> name varchar(20),
>  -> gender varchar(10),
>  -> birth  date,
>  -> entrydate  date,
>  -> job   varchar(30),
>  -> salary   double
>  -> );
> Query OK, 0 rows affected (0.27 sec)
> 
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb1 |
> +-----------------+
> | worker          |
> +-----------------+
> 1 row in set (0.00 sec)	          
> ```

##### 1.2alter操作

> a.语法：
>
> ```mysql
> #1.修改表名
> 语法规则：ALTER TABLE old_table_name RENAME [TO] new_table_name
> 
> #2.修改字段的数据类型
> 语法规则：ALTER TABLE table_name MODIFY 字段名 数据类型
> 修改完成之后可以查看DESC table_name检验结果
> 
> #3.修改字段名
> 语法规则：ALTER TABLE table_name CHANGE 旧字段名 新字段名 数据类型
> 
> #4.添加字段
> 语法规则：ALTER TABLE table_name ADD 新字段名 数据类型 [约束条件] [FIRST|AFTER 已经存在的字段名]
> 
> #5.删除字段
> 语法规则：ALTER TABLE table_name DROP 字段名
> 
> #6.修改字段的排列位置
> 语法规则：ALTER TABLE table_name MODIFY 字段1 数据类型 FIRST|AFTER 字段2
> 	first: 设置成第一个
> 	after 字段2： 在指定字段2的后面
> 	
> #7.删除表的外键约束
> 语法规则：ALTER TABLE table_name DROP FOREIGN KEY 外键约束名
> 
> #8.删除数据表
> #删除没有被关联的表
> 语法规则：DROP TABLE [IF EXISTS] 表1，表2...
> #删除被其他表关联的的表
> 直接删除会出现错误的，操作： 先解除关联 再进行删除
> ```

> ```Python
> """
> alter table worker   add age int;  增加一个age字段
> alter table worker drop age;   删除age字段
> alter table worker modify  job varchar(50);  修改job列的长度为50
> alter table worker rename to user;/rename table worker to user;	将worker表名修改为user表
> alter table worker change name username varchar(30);将表中的name字段名修改为username
> show create table worker;   显示一个表的创建细节【包含字符集】
> alter table worker character set gbk;  修改表的字符集为gbk格式
> desc worker;  显示一个表中的所有字段
> """
> ```
>
> ```shell
> 演示命令：
> mysql> desc worker;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | id        | int(10)     | YES  |     | NULL    |       |
> | name      | varchar(20) | YES  |     | NULL    |       |
> | gender    | varchar(10) | YES  |     | NULL    |       |
> | birth     | date        | YES  |     | NULL    |       |
> | entrydate | date        | YES  |     | NULL    |       |
> | job       | varchar(30) | YES  |     | NULL    |       |
> | salary    | double      | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 7 rows in set (0.12 sec)
> 
> mysql> alter table worker add age int;
> Query OK, 0 rows affected (0.35 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> mysql> desc worker;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | id        | int(10)     | YES  |     | NULL    |       |
> | name      | varchar(20) | YES  |     | NULL    |       |
> | gender    | varchar(10) | YES  |     | NULL    |       |
> | birth     | date        | YES  |     | NULL    |       |
> | entrydate | date        | YES  |     | NULL    |       |
> | job       | varchar(30) | YES  |     | NULL    |       |
> | salary    | double      | YES  |     | NULL    |       |
> | age       | int(11)     | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 8 rows in set (0.00 sec)
> 
> mysql> alter table worker modify job varchar(60);
> Query OK, 0 rows affected (0.03 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> mysql> desc worker;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | id        | int(10)     | YES  |     | NULL    |       |
> | name      | varchar(20) | YES  |     | NULL    |       |
> | gender    | varchar(10) | YES  |     | NULL    |       |
> | birth     | date        | YES  |     | NULL    |       |
> | entrydate | date        | YES  |     | NULL    |       |
> | job       | varchar(60) | YES  |     | NULL    |       |
> | salary    | double      | YES  |     | NULL    |       |
> | age       | int(11)     | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 8 rows in set (0.00 sec)
> 
> mysql> alter table worker drop age;
> Query OK, 0 rows affected (0.10 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> mysql> desc worker;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | id        | int(10)     | YES  |     | NULL    |       |
> | name      | varchar(20) | YES  |     | NULL    |       |
> | gender    | varchar(10) | YES  |     | NULL    |       |
> | birth     | date        | YES  |     | NULL    |       |
> | entrydate | date        | YES  |     | NULL    |       |
> | job       | varchar(60) | YES  |     | NULL    |       |
> | salary    | double      | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 7 rows in set (0.00 sec)
> 
> mysql> alter table worker rename to user;
> Query OK, 0 rows affected (0.01 sec)
> 
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb1 |
> +-----------------+
> | user            |
> +-----------------+
> 1 row in set (0.00 sec)
> 
> mysql> rename table user to worker;
> Query OK, 0 rows affected (0.09 sec)
> 
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb1 |
> +-----------------+
> | worker          |
> +-----------------+
> 1 row in set (0.00 sec)
> 
> mysql> desc user;
> ERROR 1146 (42S02): Table 'mydb1.user' doesn't exist
> mysql> desc worker;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | id        | int(10)     | YES  |     | NULL    |       |
> | name      | varchar(20) | YES  |     | NULL    |       |
> | gender    | varchar(10) | YES  |     | NULL    |       |
> | birth     | date        | YES  |     | NULL    |       |
> | entrydate | date        | YES  |     | NULL    |       |
> | job       | varchar(60) | YES  |     | NULL    |       |
> | salary    | double      | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 7 rows in set (0.00 sec)
> 
> mysql> alter table worker change name username varchar(50);
> Query OK, 0 rows affected (0.00 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> mysql> desc worker;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | id        | int(10)     | YES  |     | NULL    |       |
> | username  | varchar(50) | YES  |     | NULL    |       |
> | gender    | varchar(10) | YES  |     | NULL    |       |
> | birth     | date        | YES  |     | NULL    |       |
> | entrydate | date        | YES  |     | NULL    |       |
> | job       | varchar(60) | YES  |     | NULL    |       |
> | salary    | double      | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 7 rows in set (0.01 sec)
> 
> mysql> show create table worker;
> +--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> | Table  | Create Table                                                                                                                                                                                                                                                                                           |
> +--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> | worker | CREATE TABLE `worker` (
> `id` int(10) DEFAULT NULL,
> `username` varchar(50) DEFAULT NULL,
> `gender` varchar(10) DEFAULT NULL,
> `birth` date DEFAULT NULL,
> `entrydate` date DEFAULT NULL,
> `job` varchar(60) DEFAULT NULL,
> `salary` double DEFAULT NULL
> ) ENGINE=InnoDB DEFAULT CHARSET=latin1 |
> +--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> 1 row in set (0.00 sec)
> 
> mysql> alter table worker character set gbk;
> Query OK, 0 rows affected (0.01 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> mysql> show create table worker;
> +--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> | Table  | Create Table                                                                                                                                                                                                                                                                                                                                                       |
> +--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> | worker | CREATE TABLE `worker` (
> `id` int(10) DEFAULT NULL,
> `username` varchar(50) CHARACTER SET latin1 DEFAULT NULL,
> `gender` varchar(10) CHARACTER SET latin1 DEFAULT NULL,
> `birth` date DEFAULT NULL,
> `entrydate` date DEFAULT NULL,
> `job` varchar(60) CHARACTER SET latin1 DEFAULT NULL,
> `salary` double DEFAULT NULL
> ) ENGINE=InnoDB DEFAULT CHARSET=gbk |
> +--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> 1 row in set (0.00 sec)
> 
> mysql> 
> ```
>
> 补充：如何设置数据库或者数据表的编码格式
>
> 目的：安装完mysql之后，系统默认的字符编码格式为latin1,如果在表中插入的数据是中文，则会出现乱码，将mysql的编码格式设置为 能够支持中文的格式【gbk,utf8】
>
> ```shell
> #1.创建数据库的时候直接设置数据库的编码格式，该库中所有的数据表的编码格式都会被设置：对系统中所有的数据库都有效
> 第一个终端
> mysql> show databases;
> +--------------------+
> | Database           |
> +--------------------+
> | information_schema |
> | mydb1              |
> | mydb3              |
> | mysql              |
> | performance_schema |
> | sys                |
> +--------------------+
> 6 rows in set (0.53 sec)
> 
> mysql> create database mydb2;
> Query OK, 1 row affected (0.06 sec)
> 
> mysql> show create database mydb2 \G;
> *************************** 1. row ***************************
>     Database: mydb2
> Create Database: CREATE DATABASE `mydb2` /*!40100 DEFAULT CHARACTER SET latin1 */
> 1 row in set (0.00 sec)
> 
> ERROR: 
> No query specified
> 
> mysql> exit
> Bye
> rock@rockrong:~$ mysql -u root -p
> Enter password: 
> Welcome to the MySQL monitor.  Commands end with ; or \g.
> Your MySQL connection id is 2
> Server version: 5.7.27-0ubuntu0.16.04.1 (Ubuntu)
> 
> Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
> 
> Oracle is a registered trademark of Oracle Corporation and/or its
> affiliates. Other names may be trademarks of their respective
> owners.
> 
> Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
> 
> mysql> \s
> --------------
> mysql  Ver 14.14 Distrib 5.7.27, for Linux (x86_64) using  EditLine wrapper
> 
> Connection id:		2
> Current database:	
> Current user:		root@localhost
> SSL:			Not in use
> Current pager:		stdout
> Using outfile:		''
> Using delimiter:	;
> Server version:		5.7.27-0ubuntu0.16.04.1 (Ubuntu)
> Protocol version:	10
> Connection:		Localhost via UNIX socket
> Server characterset:	utf8
> Db     characterset:	utf8
> Client characterset:	utf8
> Conn.  characterset:	utf8
> UNIX socket:		/var/run/mysqld/mysqld.sock
> Uptime:			1 min 14 sec
> 
> Threads: 1  Questions: 5  Slow queries: 0  Opens: 107  Flush tables: 1  Open tables: 26  Queries per second avg: 0.067
> --------------
> 
> mysql> 
> 
> 
> 新开一个终端
> rock@rockrong:~$ cd /etc/mysql/
> rock@rockrong:/etc/mysql$ ls
> conf.d        fabric.cfg       mysql.cnf
> debian.cnf    my.cnf           mysql.conf.d
> debian-start  my.cnf.fallback  mysql-fabric-doctrine-1.4.0.zip
> rock@rockrong:/etc/mysql$ vim my.cnf
> rock@rockrong:/etc/mysql$ sudo vim /etc/mysql/mysql
> mysql.cnf                        mysql-fabric-doctrine-1.4.0.zip
> mysql.conf.d/                    
> rock@rockrong:/etc/mysql$ sudo vim /etc/mysql/mysql
> mysql.cnf                        mysql-fabric-doctrine-1.4.0.zip
> mysql.conf.d/                    
> rock@rockrong:/etc/mysql$ sudo vim /etc/mysql/mysql
> mysql.cnf                        mysql-fabric-doctrine-1.4.0.zip
> mysql.conf.d/                    
> rock@rockrong:/etc/mysql$ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf 
> [sudo] rock 的密码： 
> rock@rockrong:/etc/mysql$ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf 
> rock@rockrong:/etc/mysql$ service mysql restart
> rock@rockrong:/etc/mysql$ 
> 
> #修改文件比较麻烦，采用下面的方式：编码格式只对当前数据库有效
> mysql> create database mydb4 charset utf8;
> Query OK, 1 row affected (0.06 sec)
> 
> mysql> 
> 
> #2.创建数据表的时候直接设置表的编码格式：只对当前数据表有效
> mysql> use mydb3;
> Database changed
> mysql> select database();
> +------------+
> | database() |
> +------------+
> | mydb3      |
> +------------+
> 1 row in set (0.00 sec)
> 
> mysql> create table user(
>  -> name varchar(20),
>  -> age int,
>  -> hobby varchar(50)
>  -> )charset=utf8;
> Query OK, 0 rows affected (0.10 sec)
> 
> ```

##### 1.3drop删除

> 语法：
>
> ```mysql
> #1.删除库
> DROP DATABASE database_name
> 
> #2.删除表
> DROP TABLE 表1，表2....
> #注意：删除表的时候，只能删除没有和其他表关联的表，直接删除 会报错，如果非要删除，则先解除关联，再进行删除
> 
> ```

#### 2.DML

##### 2.1insert插入

> 语法：
>
> ```mysql
> #单行插入
> INSERT INTO table_name (field1, field2,...fieldN) VALUES(value1, value2,...valueN);
>                     
> #多行插入
> INSERT INTO table_name (field1, field2,...fieldN)
>                     VALUES
>                     (value1, value2,...valueN),
>                     (value12, value22,...valueNN)...;
>                     
> #注意：
> 	a.列名与列值的类型，个数以及顺序需要一一对应
> 	b.可以将列名当做Python中的形参，values中的值当做Python中的实参，完成赋值过程
> 	c.值不能超过列定义的长度
> 	d.如果插入的值为空，则使用null
> 	e.字段的类型为日期的时候，也和字符串一样，使用引号括起来
> 	f.不管是单行插入还是多行插入，都可以省略(field1, field2,...fieldN)
> 	
> 演示命令：
> 
> mysql> use mydb1;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> insert into worker (id,username,gender,birth,entrydate,job,salary) values(1001,"zhangsan","male","2000-9-19",'2017-8-28',"前台",8438);
> ERROR 1366 (HY000): Incorrect string value: '\xE5\x89\x8D\xE5\x8F\xB0' for column 'job' at row 1
> mysql> insert into worker (id,username,gender,birth,entrydate,job,salary) values(1001,"zhangsan","male","2000-9-19",'2017-8-28',"前台",8438);
> ERROR 1366 (HY000): Incorrect string value: '\xE5\x89\x8D\xE5\x8F\xB0' for column 'job' at row 1
> mysql> insert into worker (id,username,gender,birth,entrydate,job,salary) values(1001,"zhangsan","male","2000-9-19",'2017-8-28',"aaa",8438);
> Query OK, 1 row affected (0.01 sec)
> 
> mysql> insert into worker (id,username,gender,birth,entrydate,job,salary) values(1002,"lisi","male","2000-9-19",'2017-8-28',"bbbb",8438);
> Query OK, 1 row affected (0.05 sec)
> 
> mysql> insert into worker (id,username,gender,birth,entrydate,job,salary) values(1003,"tom","female","2000-9-19",'2017-8-28',"cccc",4000);
> Query OK, 1 row affected (0.04 sec)
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+------+--------+
> | id   | username | gender | birth      | entrydate  | job  | salary |
> +------+----------+--------+------------+------------+------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | aaa  |   8438 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | bbbb |   8438 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | cccc |   4000 |
> +------+----------+--------+------------+------------+------+--------+
> 3 rows in set (0.07 sec)
> 
> mysql> insert into worker (id,username,gender,birth,entrydate,job,salary) values(1004,"xiaohua","female","2000-9-19",'2017-8-28',"cccc",8888),(1005,"xiaoli","female","2000-9-19",'2017-8-28',"cccc",100000),(1006,"jack","male","2000-9-19",'2017-8-28',"dddd",6000);
> Query OK, 3 rows affected (0.01 sec)
> Records: 3  Duplicates: 0  Warnings: 0
> 
> mysql> select * from worker;                                                  +------+----------+--------+------------+------------+------+--------+
> | id   | username | gender | birth      | entrydate  | job  | salary |
> +------+----------+--------+------------+------------+------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | aaa  |   8438 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | bbbb |   8438 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | cccc |   4000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | cccc |   8888 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | cccc | 100000 |
> | 1006 | jack     | male   | 2000-09-19 | 2017-08-28 | dddd |   6000 |
> +------+----------+--------+------------+------------+------+--------+
> 6 rows in set (0.00 sec)                                                 
> 
> ```

##### 2.2update更新

> 语法：
>
> ```mysql
> UPDATE table_name SET field1=new-value1, field2=new-value2  [WHERE Clause]
> 
> 注意：
> 	a.可以更新一个字段或者多个字段
> 	b.可以结合where子句指定条件
> 	c.可以根据给定的条件更新一个表中的所有的值
> 	d.如果没有where子句则默认更新整张表
> 	
> 	
> #1.将所有员工的薪水修改为5000元
> #2.将所有员工的薪水修改为6000元，同时将job修改为hello
> 
> 演示命令：
> ysql> update worker set salary=5000;
> Query OK, 6 rows affected (0.04 sec)
> Rows matched: 6  Changed: 6  Warnings: 0
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+------+--------+
> | id   | username | gender | birth      | entrydate  | job  | salary |
> +------+----------+--------+------------+------------+------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | aaa  |   5000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | bbbb |   5000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | cccc |   5000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | cccc |   5000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | cccc |   5000 |
> | 1006 | jack     | male   | 2000-09-19 | 2017-08-28 | dddd |   5000 |
> +------+----------+--------+------------+------------+------+--------+
> 6 rows in set (0.00 sec)
> 
> mysql> update worker set salary=6000,job='hello';
> Query OK, 6 rows affected (0.01 sec)
> Rows matched: 6  Changed: 6  Warnings: 0
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1006 | jack     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> +------+----------+--------+------------+------------+-------+--------+
> 6 rows in set (0.00 sec)
> 
> ```

##### 1>where子句

> 语法：
>
> 注意：where子句其实就是一个操作符，类似于Python中的if语句，可以做数据的筛选
>
> | 操作符      | 说明                      |
> | ----------- | ------------------------- |
> | =           | 相等                      |
> | <> / !=     | 不相等                    |
> | <           | 小于                      |
> | <=          | 小于等于                  |
> | >           | 大于                      |
> | >=          | 大于等于                  |
> | between and | 位于两值之间              |
> | IN(A，B)    | A 和 B 之间               |
> | AND         | 连接多个表达式 并且的关系 |

> ```shell
> #格式：update 表名  set  filed=value....  where  条件表达式；
> 
> #1.将tom的薪资修改为3000
> 
> #2.将jack的薪资修改为4600，同时将性别修改为female
> 
> #3.将zhangsan的薪水在原来的基础上提高3000
> 
> #4.将性别为female并且job为hello员工，所有人工资增加2000
> 
> #5.将薪资在8000~9000之间员工的薪资减少1000
> 
> 演示命令：
> mysql> update worker set salary=3000 where username='tom';
> Query OK, 1 row affected (0.07 sec)
> Rows matched: 1  Changed: 1  Warnings: 0
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | hello |   3000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1006 | jack     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> +------+----------+--------+------------+------------+-------+--------+
> 6 rows in set (0.00 sec)
> 
> mysql> update worker set salary=4600,gender='female' where username='jack';
> Query OK, 1 row affected (0.01 sec)
> Rows matched: 1  Changed: 1  Warnings: 0
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | hello |   3000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1006 | jack     | female | 2000-09-19 | 2017-08-28 | hello |   4600 |
> +------+----------+--------+------------+------------+-------+--------+
> 6 rows in set (0.00 sec)
> 
> mysql> update worker set salary=salary+3000 where username='zhangsan';
> Query OK, 1 row affected (0.11 sec)
> Rows matched: 1  Changed: 1  Warnings: 0
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   9000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | hello |   3000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1006 | jack     | female | 2000-09-19 | 2017-08-28 | hello |   4600 |
> +------+----------+--------+------------+------------+-------+--------+
> 6 rows in set (0.01 sec)
> 
> mysql> update worker set salary=salary+2000 where gender='female' and job='hello';
> Query OK, 4 rows affected (0.04 sec)
> Rows matched: 4  Changed: 4  Warnings: 0
> 
> mysql> select * from worker;                                                  +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   9000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | hello |   5000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | hello |   8000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   8000 |
> | 1006 | jack     | female | 2000-09-19 | 2017-08-28 | hello |   6600 |
> +------+----------+--------+------------+------------+-------+--------+
> 6 rows in set (0.00 sec)
> 
> mysql> update worker set salary=salary-1000 where salary between 8000 and 9000;   #update worker set salary=salary-1000 where salary>=8000 and salary<=9000;  
> Query OK, 3 rows affected (0.05 sec)
> Rows matched: 3  Changed: 3  Warnings: 0
> 
> mysql> select * from worker;                                                  +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   8000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1003 | tom      | female | 2000-09-19 | 2017-08-28 | hello |   5000 |
> | 1004 | xiaohua  |female | 2000-09-19 | 2017-08-28 | hello |   7000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   7000 |
> | 1006 | jack     | female | 2000-09-19 | 2017-08-28 | hello |   6600 |
> +------+----------+--------+------------+------------+-------+--------+
> 6 rows in set (0.00 sec)
> 
> mysql> 
> 
> ```

##### 2.3delete删除

> 语法：
>
> ```mysql
> DELETE FROM table_name [WHERE Clause]
> 
> #1.删除tom的数据
> #2.删除所有的数据
> 
> 演示命令：
> mysql> delete from worker where username="tom";
> Query OK, 1 row affected (0.02 sec)
> 
> mysql> select * from worker;
> +------+----------+--------+------------+------------+-------+--------+
> | id   | username | gender | birth      | entrydate  | job   | salary |
> +------+----------+--------+------------+------------+-------+--------+
> | 1001 | zhangsan | male   | 2000-09-19 | 2017-08-28 | hello |   8000 |
> | 1002 | lisi     | male   | 2000-09-19 | 2017-08-28 | hello |   6000 |
> | 1004 | xiaohua  | female | 2000-09-19 | 2017-08-28 | hello |   7000 |
> | 1005 | xiaoli   | female | 2000-09-19 | 2017-08-28 | hello |   7000 |
> | 1006 | jack     | female | 2000-09-19 | 2017-08-28 | hello |   6600 |
> +------+----------+--------+------------+------------+-------+--------+
> 5 rows in set (0.00 sec)
> 
> mysql> delete from worker;
> Query OK, 5 rows affected (0.00 sec)
> 
> mysql> select * from worker;
> Empty set (0.00 sec)
> 
> mysql> 
> 
> 
> #【面试题】delete、truncate、drop之间的区别
> 注意：
> 	delete:删除表中的数据，表结构还在，删除后的数据可以找回
> 	truncate：不但会删除数据，还会删除表，然后再创建一个同样的新表，删除的数据不能找回，执行速度比delete快
> 	
> 	#1
> 	truncate后，该表和索引所占用的空间会恢复到最初大小
> 	delete后，不会减少表或者索引所占用的空间
> 	drop后，将表所占用的空间全部释放掉
> 	
> 	#2.
> 	truncate只删除table
> 	drop可以删除database和table
> 	delete删除数据
> 	
> 	#3.
> 	truncate和delete都可以删除数据，但是drop只能删除表结构
> 	
> 	#4.
> 	truncate和delete属于DML
> 	drop属于DDL
> 
> ```

#### 3.DQL

> 注意：DQL一般需要结合where使用
>
> between....and....:介于两者之间
>
> and：逻辑与【表示两个条件同时成立】
>
> or:逻辑或【表示两个条件中至少有一个成立】
>
> in:在...中，表示肯定，类似于Python中的成员运算符
>
> not in:不在。。。中
>
> is:是。。。。，类似于Python中的身份运算符
>
> is not：不是。。。。
>
> 语法：
>
> ```mysql
> SELECT 列名 FROM 表名【WHERE --> GROUP BY -->HAVING--> ORDER BY】
> 
> select * from 表名; 查询一个表中的所有数据
> 
> #1.查找整张表
> #2.查找指定列
> #3.查找性别为g,并且班级为1-1的学生信息
> #4.查找学号为1或者姓名为ddd的学生信息
> #5.查找学号为1,2,3的学生信息
> #6.查询学号不为2,3的学生信息
> #7.查询生日为null的学生信息
> #8.查询性别非b的学生信息
> #9.查询姓名不为null的学生信息
> 
> 演示命令：
> mysql> select * from student;
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 7 rows in set (0.00 sec)
> 
> mysql> select * from student;
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 7 rows in set (0.00 sec)
> 
> mysql> select sno,sname from student;
> +------+-------+
> | sno  | sname |
> +------+-------+
> | 1    | aaa   |
> | 2    | bbb   |
> | 3    | cccc  |
> | 4    | ddddd |
> | 4    | ddddd |
> | 4    | ddddd |
> | 1    | aaaaa |
> +------+-------+
> 7 rows in set (0.00 sec)
> 
> mysql> select * from student where ssex='g' and class='1-1'
>  -> ;
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> +------+-------+------+---------------------+-------+
> 2 rows in set (0.04 sec)
> 
> mysql> select * from student where sno=1 or sname='ddddd';
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 5 rows in set (0.05 sec)
> 
> mysql> select * from student where sno=1 or sno=2 or sno=3;
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 4 rows in set (0.00 sec)
> 
> mysql> select * from student where sno in(1,2,3);
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 4 rows in set (0.01 sec)
> 
> mysql> select * from student where sno not in(2,3);
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 5 rows in set (0.00 sec)
> 
> mysql> select * from student where  sbirthday is null;
> Empty set (0.02 sec)
> 
> mysql> select * from student where ssex!='b';
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> +------+-------+------+---------------------+-------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student where ssex<>'b';
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> +------+-------+------+---------------------+-------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student where  sname  is not  null;
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 7 rows in set (0.00 sec)
> 
> mysql> 
> 
> ```

#### 作业：创建表，按照要求操作

> ```mysql
> #建学生信息表student
> create table student(
> sno varchar(20),
> sname varchar(20),
> ssex varchar(20),
> sbirthday datetime,
> class varchar(20)
> );
> #建立成绩表
> create table score
> (
> sno varchar(20),
> cno varchar(20),
> degree decimal
> );
> #添加学生信息
> insert into student values('108','曾华','男','1977-09-01','95033');
> insert into student values('105','匡明','男','1975-10-02','95031');
> insert into student values('107','王丽','女','1976-01-23','95033');
> insert into student values('101','李军','男','1976-02-20','95033');
> insert into student values('109','王芳','女','1975-02-10','95031');
> insert into student values('103','陆君','男','1974-06-03','95031');
> #添加成绩表
> insert into score values('103','3-245','86');
> insert into score values('105','3-245','75');
> insert into score values('109','3-245','68');
> insert into score values('103','3-105','92');
> insert into score values('105','3-105','88');
> insert into score values('109','3-105','76');
> insert into score values('103','3-105','64');
> insert into score values('105','3-105','91');
> insert into score values('109','3-105','78');
> insert into score values('103','6-166','85');
> insert into score values('105','6-166','79');
> insert into score values('109','6-166','81');
> 
> #1、 查询Student表中的所有记录的Sname、Ssex和Class列
> #2、 查询学生的生日即不重复的sbirthday列
> #3、 查询Student表的所有记录
> #4、查询Score表中成绩在60到80之间的所有记录
> #5、 查询Score表中成绩为85，86或88的记录
> #6、 查询Student表中“95031”班或性别为“女”的同学记录
> #7、 以Class降序查询Student表的所有记录
> #8、 以Cno升序、Degree降序查询Score表的所有记录
> #9、 查询“95031”班的学生人数
> #10、查询Score表中的最高分的学生学号和课程号
> #11、查询每门课的平均成绩
> #12、查询Score表中至少有5名学生选修的并以3开头的课程的平均分数
> #13、查询分数大于70，小于90的Sno列
> 
> ```

# Day2 数据库查询

### 一、上堂回顾

#### 1.默写题目

> 假设在数据库中有一张user表，完成下面操作
>
> 1.查找user表中的所有列
>
> ​	DQL:select  *  from user;
>
> 2.将user表中的name字段名修改为username
>
> ​	DDL:alter table user change name username  varchar(20);
>
> 3.删除user表中姓名为zhangsan的所有信息
>
> ​	DML:delete from user where name='zhangsan'; 
>
> 4.查询年龄在20~40之间的所有人的信息
>
> ​	DQL:select * from user where age between 20 and 40;
>
> ​               select * from user where age>=20 and age<=40;
>
> 5.将zhangsan的年龄修改为18
>
> ​	DML:update  user set  age=18  where name='zhangsan';
>
> 6.删除user表
>
> ​	drop table user;
>
> ​	drop database  xxx;

#### 2.知识点回顾

> 1.数据库管理系统，数据库，数据表之间的关系
>
> 2.SQL的分类【面试题】
>
> ​	DDL:操作表结构【表名，字段：类型和名称，库】，create【库，表】，alter，drop【库，表】
>
> ​	DML:操作表中的实体【增删改】，insert  delete  update
>
> ​	DQL:操作表中的实体【查】，select 【where   ....】

> 补充：更改mysql的密码：
>
> ```shell
> rock@rockrong:~$ mysql -uroot -prock1204
> mysql: [Warning] Using a password on the command line interface can be insecure.
> Welcome to the MySQL monitor.  Commands end with ; or \g.
> Your MySQL connection id is 3
> Server version: 5.7.27-0ubuntu0.16.04.1 (Ubuntu)
> 
> Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
> 
> Oracle is a registered trademark of Oracle Corporation and/or its
> affiliates. Other names may be trademarks of their respective
> owners.
> 
> Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
> 
> mysql> show datatbases;
> ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'datatbases' at line 1
> mysql> show databases;
> +--------------------+
> | Database           |
> +--------------------+
> | information_schema |
> | mydb1              |
> | mydb2              |
> | mysql              |
> | performance_schema |
> | sys                |
> +--------------------+
> 6 rows in set (0.07 sec)
> 
> mysql> use mysql;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> show tables;
> +---------------------------+
> | Tables_in_mysql           |
> +---------------------------+
> | columns_priv              |
> | db                        |
> | engine_cost               |
> | event                     |
> | func                      |
> | general_log               |
> | gtid_executed             |
> | help_category             |
> | help_keyword              |
> | help_relation             |
> | help_topic                |
> | innodb_index_stats        |
> | innodb_table_stats        |
> | ndb_binlog_index          |
> | plugin                    |
> | proc                      |
> | procs_priv                |
> | proxies_priv              |
> | server_cost               |
> | servers                   |
> | slave_master_info         |
> | slave_relay_log_info      |
> | slave_worker_info         |
> | slow_log                  |
> | tables_priv               |
> | time_zone                 |
> | time_zone_leap_second     |
> | time_zone_name            |
> | time_zone_transition      |
> | time_zone_transition_type |
> | user                      |
> +---------------------------+
> 31 rows in set (0.00 sec)
> 
> mysql> desc user;
> +------------------------+-----------------------------------+------+-----+-----------------------+-------+
> | Field                  | Type                              | Null | Key | Default               | Extra |
> +------------------------+-----------------------------------+------+-----+-----------------------+-------+
> | Host                   | char(60)                          | NO   | PRI |                       |       |
> | User                   | char(32)                          | NO   | PRI |                       |       |
> | Select_priv            | enum('N','Y')                     | NO   |     | N                     |       |
> | Insert_priv            | enum('N','Y')                     | NO   |     | N                     |       |
> | Update_priv            | enum('N','Y')                     | NO   |     | N                     |       |
> | Delete_priv            | enum('N','Y')                     | NO   |     | N                     |       |
> | Create_priv            | enum('N','Y')                     | NO   |     | N                     |       |
> | Drop_priv              | enum('N','Y')                     | NO   |     | N                     |       |
> | Reload_priv            | enum('N','Y')                     | NO   |     | 
> | Lock_tables_priv       | enum('N','Y')                     | NO   |     |
> | plugin                 | char(64)                          | NO   |     | mysql_native_password |       |
> | authentication_string  | text                              | YES  |     | NULL                  |       |
> | password_expired       | enum('N','Y')                     | NO   |     | N                     |       |
> | password_last_changed  | timestamp                         | YES  |     | NULL                  |       |
> | password_lifetime      | smallint(5) unsigned              | YES  |     | NULL                  |       |
> | account_locked         | enum('N','Y')                     | NO   |     | N                     |       |
> +------------------------+-----------------------------------+------+-----+-----------------------+-------+
> 45 rows in set (0.07 sec)
> 
> mysql> select host,user,authentication_string from user;
> +-----------+------------------+-------------------------------------------+
> | host      | user             | authentication_string                     |
> +-----------+------------------+-------------------------------------------+
> | localhost | root             | *366B3C85680FD75A61030BFECA6BB5FF0CAC6FAD |
> | localhost | mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |
> | localhost | mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |
> | localhost | debian-sys-maint | *32A7870CDCF13E51FDF7575497438FC817790A2B |
> +-----------+------------------+-------------------------------------------+
> 4 rows in set (0.04 sec)
> 
> mysql> update user set  authentication_string=password('abc123') where user='root';
> Query OK, 1 row affected, 1 warning (0.12 sec)
> Rows matched: 1  Changed: 1  Warnings: 1
> 
> #需要重启一个终端，重启mysql服务
> mysql> exit
> Bye
> rock@rockrong:~$ mysql -u root -p
> Enter password: 
> ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
> rock@rockrong:~$ mysql -u root -p
> Enter password: 
> Welcome to the MySQL monitor.  Commands end with ; or \g.
> Your MySQL connection id is 4
> Server version: 5.7.27-0ubuntu0.16.04.1 (Ubuntu)
> 
> Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
> 
> Oracle is a registered trademark of Oracle Corporation and/or its
> affiliates. Other names may be trademarks of their respective
> owners.
> 
> Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
> 
> mysql> 
> ```

#### 3.作业讲解

> ```shell
> #建学生信息表student
> create table student(
> sno varchar(20),
> sname varchar(20),
> ssex varchar(20),
> sbirthday datetime,
> class varchar(20)
> );
> #建立成绩表
> create table score
> (
> sno varchar(20),
> cno varchar(20),
> degree decimal
> );
> #添加学生信息
> insert into student values('108','曾华','男','1977-09-01','95033');
> insert into student values('105','匡明','男','1975-10-02','95031');
> insert into student values('107','王丽','女','1976-01-23','95033');
> insert into student values('101','李军','男','1976-02-20','95033');
> insert into student values('109','王芳','女','1975-02-10','95031');
> insert into student values('103','陆君','男','1974-06-03','95031');
> #添加成绩表
> insert into score values('103','3-245','86');
> insert into score values('105','3-245','75');
> insert into score values('109','3-245','68');
> insert into score values('103','3-105','92');
> insert into score values('105','3-105','88');
> insert into score values('109','3-105','76');
> insert into score values('103','3-105','64');
> insert into score values('105','3-105','91');
> insert into score values('109','3-105','78');
> insert into score values('103','6-166','85');
> insert into score values('105','6-166','79');
> insert into score values('109','6-166','81');
> 
> #1、 查询Student表中的所有记录的Sname、Ssex和Class列
> #2、 查询学生的生日即不重复的sbirthday列
> #3、 查询Student表的所有记录
> #4、查询Score表中成绩在60到80之间的所有记录
> #5、 查询Score表中成绩为85，86或88的记录
> #6、 查询Student表中“95031”班或性别为“女”的同学记录
> #7、 以Class降序查询Student表的所有记录
> #8、 以Cno升序、Degree降序查询Score表的所有记录
> #9、 查询“95031”班的学生人数
> #10、查询Score表中的最高分的学生学号和课程号
> #13、查询分数大于70，小于90的Sno列
> 
> mysql> select sname,ssex,class from student;
> +--------+------+-------+
> | sname  | ssex | class |
> +--------+------+-------+
> | 曾华   | 男   | 95033 |
> | 匡明   | 男   | 95031 |
> | 王丽   | 女   | 95033 |
> | 李军   | 男   | 95033 |
> | 王芳   | 女   | 95031 |
> | 陆君   | 男   | 95031 |
> +--------+------+-------+
> 6 rows in set (0.00 sec)
> 
> mysql> select sbirthday  from student;
> +---------------------+
> | sbirthday           |
> +---------------------+
> | 1977-09-01 00:00:00 |
> | 1975-10-02 00:00:00 |
> | 1976-01-23 00:00:00 |
> | 1976-02-20 00:00:00 |
> | 1975-02-10 00:00:00 |
> | 1974-06-03 00:00:00 |
> +---------------------+
> 6 rows in set (0.00 sec)
> 
> mysql> select distinct sbirthday  from student;
> +---------------------+
> | sbirthday           |
> +---------------------+
> | 1977-09-01 00:00:00 |
> | 1975-10-02 00:00:00 |
> | 1976-01-23 00:00:00 |
> | 1976-02-20 00:00:00 |
> | 1975-02-10 00:00:00 |
> | 1974-06-03 00:00:00 |
> +---------------------+
> 6 rows in set (0.00 sec)
> 
> mysql> select * from score where degree between 60 and 80;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 105  | 3-245 |     75 |
> | 109  | 3-245 |     68 |
> | 109  | 3-105 |     76 |
> | 103  | 3-105 |     64 |
> | 109  | 3-105 |     78 |
> | 105  | 6-166 |     79 |
> +------+-------+--------+
> 6 rows in set (0.03 sec)
> 
> mysql> select * from score where degree=85 or degree=86 or degree=88;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-245 |     86 |
> | 105  | 3-105 |     88 |
> | 103  | 6-166 |     85 |
> +------+-------+--------+
> 3 rows in set (0.00 sec)
> 
> mysql> select * from score where degree in(85,86,88);
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-245 |     86 |
> | 105  | 3-105 |     88 |
> | 103  | 6-166 |     85 |
> +------+-------+--------+
> 3 rows in set (0.00 sec)
> 
> mysql> select * from student where class='95031' or ssex='女';
> +------+--------+------+---------------------+-------+
> | sno  | sname  | ssex | sbirthday           | class |
> +------+--------+------+---------------------+-------+
> | 105  | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |
> | 107  | 王丽   | 女   | 1976-01-23 00:00:00 | 95033 |
> | 109  | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |
> | 103  | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |
> +------+--------+------+---------------------+-------+
> 4 rows in set (0.00 sec)
> 
> mysql> select * from student order by class desc;
> +------+--------+------+---------------------+-------+
> | sno  | sname  | ssex | sbirthday           | class |
> +------+--------+------+---------------------+-------+
> | 108  | 曾华   | 男   | 1977-09-01 00:00:00 | 95033 |
> | 107  | 王丽   | 女   | 1976-01-23 00:00:00 | 95033 |
> | 101  | 李军   | 男   | 1976-02-20 00:00:00 | 95033 |
> | 105  | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |
> | 109  | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |
> | 103  | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |
> +------+--------+------+---------------------+-------+
> 6 rows in set (0.00 sec)
> 
> mysql> select * from score order by cno asc,degree desc;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-105 |     92 |
> | 105  | 3-105 |     91 |
> | 105  | 3-105 |     88 |
> | 109  | 3-105 |     78 |
> | 109  | 3-105 |     76 |
> | 103  | 3-105 |     64 |
> | 103  | 3-245 |     86 |
> | 105  | 3-245 |     75 |
> | 109  | 3-245 |     68 |
> | 103  | 6-166 |     85 |
> | 109  | 6-166 |     81 |
> | 105  | 6-166 |     79 |
> +------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select * from student where class='95031';
> +------+--------+------+---------------------+-------+
> | sno  | sname  | ssex | sbirthday           | class |
> +------+--------+------+---------------------+-------+
> | 105  | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |
> | 109  | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |
> | 103  | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |
> +------+--------+------+---------------------+-------+
> 3 rows in set (0.00 sec)
> 
> mysql> select count(*) from student where class='95031';
> +----------+
> | count(*) |
> +----------+
> |        3 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> select * from score;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-245 |     86 |
> | 105  | 3-245 |     75 |
> | 109  | 3-245 |     68 |
> | 103  | 3-105 |     92 |
> | 105  | 3-105 |     88 |
> | 109  | 3-105 |     76 |
> | 103  | 3-105 |     64 |
> | 105  | 3-105 |     91 |
> | 109  | 3-105 |     78 |
> | 103  | 6-166 |     85 |
> | 105  | 6-166 |     79 |
> | 109  | 6-166 |     81 |
> +------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select max(degree) from score;
> +-------------+
> | max(degree) |
> +-------------+
> |          92 |
> +-------------+
> 1 row in set (0.00 sec)
> 
> mysql> select sno,cno from score where degree=92;
> +------+-------+
> | sno  | cno   |
> +------+-------+
> | 103  | 3-105 |
> +------+-------+
> 1 row in set (0.00 sec)
> 
> mysql> select sno,cno from score where degree=(select max(degree) from score); 
> +------+-------+
> | sno  | cno   |
> +------+-------+
> | 103  | 3-105 |
> +------+-------+
> 1 row in set (0.04 sec)
> 
> mysql> select * from score;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-245 |     86 |
> | 105  | 3-245 |     75 |
> | 109  | 3-245 |     68 |
> | 103  | 3-105 |     92 |
> | 105  | 3-105 |     88 |
> | 109  | 3-105 |     76 |
> | 103  | 3-105 |     64 |
> | 105  | 3-105 |     91 |
> | 109  | 3-105 |     78 |
> | 103  | 6-166 |     85 |
> | 105  | 6-166 |     79 |
> | 109  | 6-166 |     81 |
> +------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select sno from score where degree>70 and degree<90;
> +------+
> | sno  |
> +------+
> | 103  |
> | 105  |
> | 105  |
> | 109  |
> | 109  |
> | 103  |
> | 105  |
> | 109  |
> +------+
> 8 rows in set (0.00 sec)
> 
> #11、查询每门课的平均成绩
> #12、查询Score表中至少有5名学生选修的并以3开头的课程的平均分数
> mysql> select cno,avg(degree) from score group by cno;
> +-------+-------------+
> | cno   | avg(degree) |
> +-------+-------------+
> | 3-105 |     81.5000 |
> | 3-245 |     76.3333 |
> | 6-166 |     81.6667 |
> +-------+-------------+
> 3 rows in set (0.05 sec)
> 
> mysql> select cno,avg(degree) from score where cno like '3%' 
>  -> group by cno having count(cno)>=5;
> +-------+-------------+
> | cno   | avg(degree) |
> +-------+-------------+
> | 3-105 |     81.5000 |
> +-------+-------------+
> 1 row in set (0.02 sec)
> 
> mysql> select cno,count(cno) from score group by cno;
> +-------+------------+
> | cno   | count(cno) |
> +-------+------------+
> | 3-105 |          6 |
> | 3-245 |          3 |
> | 6-166 |          3 |
> +-------+------------+
> 3 rows in set (0.00
> ```

### 二、数据库操作

#### 1.DQL【重点掌握】

##### 1.1基础查询

> a.查询所有列
>
> select * from user;
>
> b.查询指定的列
>
> select id,name from user;

##### 1.2条件查询-where

> select * from user where  条件表达式；

##### 1.3模糊查询-like

> 一般情况下，where用于精确查询，如name='张三',但是，我们需要过滤，只要求name中包含某个特定的字符，如：name='张xxx',此时，则需要使用where结合like同时使用
>
> 通配符：
>
> ​	_:可以匹配任意一个字符
>
> ​	%：可以匹配任意0~n个字符【n>=1】
>
> 语法：select * from user   where  name like  'xxxx'
>
> ```shell
> #1.查询姓名由4个字符组成的记录
> #2.查询姓名由3个字符组成的记录，并且最后一个字符为d的记录
> #3.查询姓名以字符a开头的记录
> #4.查询姓名的第2位为字符c的记录
> #5.查询姓名中包含字符d的记录
> 
> 演示命令：
> mysql> use mydb1;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb1 |
> +-----------------+
> | score           |
> | student         |
> +-----------------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student;
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 7 rows in set (0.02 sec)
> 
> mysql> select * from student where sname="aaa";
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> +------+-------+------+---------------------+-------+
> 1 row in set (0.05 sec)
> 
> mysql> select * from student where sname like "____";
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> +------+-------+------+---------------------+-------+
> 1 row in set (0.00 sec)
> 
> mysql> select * from student where sname like "___";
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 2    | bbb   | g    | 1994-10-08 00:00:00 | 1-1   |
> +------+-------+------+---------------------+-------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student where sname like "__d";
> Empty set (0.01 sec)
> 
> mysql> select * from student where sname like "a%";
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 1    | aaa   | g    | 1994-10-08 00:00:00 | 1-1   |
> | 1    | aaaaa | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student where sname like "_c%";
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 3    | cccc  | b    | 1996-10-08 00:00:00 | 1-2   |
> +------+-------+------+---------------------+-------+
> 1 row in set (0.00 sec)
> 
> mysql> select * from student where sname like "%d%";
> +------+-------+------+---------------------+-------+
> | sno  | sname | ssex | sbirthday           | class |
> +------+-------+------+---------------------+-------+
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-2   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-1   |
> | 4    | ddddd | b    | 1996-10-09 00:00:00 | 1-3   |
> +------+-------+------+---------------------+-------+
> 3 rows in set (0.01 sec)
> 
> mysql> 
> ```

##### 1.4字段控制查询

> as:给字段起别名，语法：select   old   as new  from user;
>
> ifnull()：如果指定字段的值为null，则可以转化为其他的数据,语法：select ifnull(field,default) from user;
>
> distinct:去除重复记录 ,语法：select   distinct field  from user;
>
> ```shell
> 演示命令：
> mysql> select id from student;
> +------+
> | id   |
> +------+
> | 1    |
> | 2    |
> | 3    |
> | 4    |
> | 5    |
> | 6    |
> | 7    |
> | 7    |
> +------+
> 8 rows in set (0.00 sec)
> 
> mysql> select distinct id from student;
> +------+
> | id   |
> +------+
> | 1    |
> | 2    |
> | 3    |
> | 4    |
> | 5    |
> | 6    |
> | 7    |
> +------+
> 7 rows in set (0.03 sec)
> 
> mysql> select distinct id,name,age,gender from student;
> +------+------+------+--------+
> | id   | name | age  | gender |
> +------+------+------+--------+
> | 1    | aaa  |   19 | male   |
> | 2    | bbb  |   10 | female |
> | 3    | abc  |   10 | female |
> | 4    | ccc  |    8 | female |
> | 5    | def  |    8 | female |
> | 6    | ddd  |   15 | male   |
> | 7    | eeee |   15 | male   |
> | 7    | fff  |   30 | female |
> +------+------+------+--------+
> 8 rows in set (0.00 sec)
> 
> mysql> select name,gender from student;
> +------+--------+
> | name | gender |
> +------+--------+
> | aaa  | male   |
> | bbb  | female |
> | abc  | female |
> | ccc  | female |
> | def  | female |
> | ddd  | male   |
> | eeee | male   |
> | fff  | female |
> +------+--------+
> 8 rows in set (0.00 sec)
> 
> mysql> select name as 姓名,gender as 性别 from student;
> +--------+--------+
> | 姓名   | 性别   |
> +--------+--------+
> | aaa    | male   |
> | bbb    | female |
> | abc    | female |
> | ccc    | female |
> | def    | female |
> | ddd    | male   |
> | eeee   | male   |
> | fff    | female |
> +--------+--------+
> 8 rows in set (0.05 sec)
> 
> mysql> select name,gender from student;
> +------+--------+
> | name | gender |
> +------+--------+
> | aaa  | male   |
> | bbb  | female |
> | abc  | female |
> | ccc  | female |
> | def  | female |
> | ddd  | male   |
> | eeee | male   |
> | fff  | female |
> +------+--------+
> 8 rows in set (0.01 sec)
> 
> mysql> select name username,gender sex from student;  #as可以省略
> +----------+--------+
> | username | sex    |
> +----------+--------+
> | aaa      | male   |
> | bbb      | female |
> | abc      | female |
> | ccc      | female |
> | def      | female |
> | ddd      | male   |
> | eeee     | male   |
> | fff      | female |
> +----------+--------+
> 8 rows in set (0.00 sec)
> 
> mysql> select * from student;
> +------+------+------+--------+
> | id   | name | age  | gender |
> +------+------+------+--------+
> | 1    | aaa  |   19 | male   |
> | 2    | bbb  |   10 | female |
> | 3    | abc  |   10 | female |
> | 4    | ccc  |    8 | female |
> | 5    | def  |    8 | female |
> | 6    | ddd  |   15 | male   |
> | 7    | eeee |   15 | male   |
> | 7    | fff  |   30 | female |
> +------+------+------+--------+
> 8 rows in set (0.00 sec)
> 
> mysql> select id+age from student;
> +--------+
> | id+age |
> +--------+
> |     20 |
> |     12 |
> |     13 |
> |     12 |
> |     13 |
> |     21 |
> |     22 |
> |     37 |
> +--------+
> 8 rows in set (0.06 sec)
> 
> mysql> insert into student values('8','ggg');
> ERROR 1136 (21S01): Column count doesn't match value count at row 1
> mysql> insert into student values('8','ggg',null,null);
> Query OK, 1 row affected (0.01 sec)
> 
> mysql> select id+age from student;
> +--------+
> | id+age |
> +--------+
> |     20 |
> |     12 |
> |     13 |
> |     12 |
> |     13 |
> |     21 |
> |     22 |
> |     37 |
> |   NULL |
> +--------+
> 9 rows in set (0.00 sec)
> 
> mysql> select id+ifnull(age,0) from student;
> +------------------+
> | id+ifnull(age,0) |
> +------------------+
> |               20 |
> |               12 |
> |               13 |
> |               12 |
> |               13 |
> |               21 |
> |               22 |
> |               37 |
> |                8 |
> +------------------+
> 9 rows in set (0.03 sec)
> 
> mysql> select ifnull(id,'0')+ifnull(age,0) from student;
> +------------------------------+
> | ifnull(id,'0')+ifnull(age,0) |
> +------------------------------+
> |                           20 |
> |                           12 |
> |                           13 |
> |                           12 |
> |                           13 |
> |                           21 |
> |                           22 |
> |                           37 |
> |                            8 |
> +------------------------------+
> 9 rows in set (0.01 sec)
> 
> mysql> 
> ```

##### 1.5排序-order by

> ```shell
> orderby:指定查询数据返回的顺序，语法：select * from user order by 排序方式
> 
> 	asc:升序【Ascending】
> 
> 	desc:降序【Descending】
> 
> 注意：
> 	a.可以排序返回所列出提供的任意字段的结果
> 	b.可以同时对多个字段进行排序
> 	c.可以使用关键字asc或者desc来执行升序和降序，默认为升序
> 	d.也可以结合where子句设置条件
> 	
> #1.查询所有学生信息，按照年龄升序排序
> #2.查询所有学生信息，按照年龄降序排序
> #3.查询所有学生信息，按照年龄升序排序，如果年龄相等，则按照编号进行降序排序
> 
> 演示命令：
> mysql> select * from student order by age;
> +------+------+------+--------+
> | id   | name | age  | gender |
> +------+------+------+--------+
> | 8    | ggg  | NULL | NULL   |
> | 4    | ccc  |    8 | female |
> | 5    | def  |    8 | female |
> | 2    | bbb  |   10 | female |
> | 3    | abc  |   10 | female |
> | 6    | ddd  |   15 | male   |
> | 7    | eeee |   15 | male   |
> | 1    | aaa  |   19 | male   |
> | 7    | fff  |   30 | female |
> +------+------+------+--------+
> 9 rows in set (0.04 sec)
> 
> mysql> select * from student order by age asc;
> +------+------+------+--------+
> | id   | name | age  | gender |
> +------+------+------+--------+
> | 8    | ggg  | NULL | NULL   |
> | 4    | ccc  |    8 | female |
> | 5    | def  |    8 | female |
> | 2    | bbb  |   10 | female |
> | 3    | abc  |   10 | female |
> | 6    | ddd  |   15 | male   |
> | 7    | eeee |   15 | male   |
> | 1    | aaa  |   19 | male   |
> | 7    | fff  |   30 | female |
> +------+------+------+--------+
> 9 rows in set (0.00 sec)
> 
> mysql> select * from student order by age desc;
> +------+------+------+--------+
> | id   | name | age  | gender |
> +------+------+------+--------+
> | 7    | fff  |   30 | female |
> | 1    | aaa  |   19 | male   |
> | 6    | ddd  |   15 | male   |
> | 7    | eeee |   15 | male   |
> | 2    | bbb  |   10 | female |
> | 3    | abc  |   10 | female |
> | 4    | ccc  |    8 | female |
> | 5    | def  |    8 | female |
> | 8    | ggg  | NULL | NULL   |
> +------+------+------+--------+
> 9 rows in set (0.01 sec)
> 
> mysql> select * from student order by age asc,id desc;
> +------+------+------+--------+
> | id   | name | age  | gender |
> +------+------+------+--------+
> | 8    | ggg  | NULL | NULL   |
> | 5    | def  |    8 | female |
> | 4    | ccc  |    8 | female |
> | 3    | abc  |   10 | female |
> | 2    | bbb  |   10 | female |
> | 7    | eeee |   15 | male   |
> | 6    | ddd  |   15 | male   |
> | 1    | aaa  |   19 | male   |
> | 7    | fff  |   30 | female |
> +------+------+------+--------+
> 9 rows in set (0.01 sec)
> 
> mysql> 
> ```

##### 1.6聚合函数

> 作用：用来做纵向运算的函数
>
> 语法：select 聚合函数  from  user  where  xxx   order by   xxx；
>
> count():统计指定列的记录的行数
>
> ```shell
> count()
> #1.查询所有性别为male的人数
> #2.查询年龄大于20的人数
> #3.查询年龄和编号之和大于20的人数
> #4.查询有年龄的人数，有性别的人数
> 
> 演示命令：
> mysql> select count(*) from student;
> +----------+
> | count(*) |
> +----------+
> |        9 |
> +----------+
> 1 row in set (0.06 sec)
> 
> mysql> select count(*) from student where gender='male';
> +----------+
> | count(*) |
> +----------+
> |        3 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> select count(id) from student where age>20;
> +-----------+
> | count(id) |
> +-----------+
> |         1 |
> +-----------+
> 1 row in set (0.00 sec)
> 
> mysql> select count(*) from student where age>20;
> +----------+
> | count(*) |
> +----------+
> |        1 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> select count(*) from student where id+ifnull(age,0)>20;
> +----------+
> | count(*) |
> +----------+
> |        3 |
> +----------+
> 1 row in set (0.03 sec)
> 
> mysql> select count(age),count(gender) from student;
> +------------+---------------+
> | count(age) | count(gender) |
> +------------+---------------+
> |          8 |             8 |
> +------------+---------------+
> 1 row in set (0.00 sec)
> 
> mysql> select count(*) from student where age is not null and gender is not null;
> +----------+
> | count(*) |
> +----------+
> |        8 |
> +----------+
> 1 row in set (0.03 sec)
> 
> mysql> 
> ```
>
> sum():计算指定列的数值和，如果指定列类型不是数字类型，则计算结果为0
>
> ```shell
> #1.查询所有学生的年龄和
> #2.查询所有学生的年龄和，以及所有学生的编号和
> #3.查询所有学生的年龄+编号和
> mysql> select sum(age) from student;
> +----------+
> | sum(age) |
> +----------+
> |      115 |
> +----------+
> 1 row in set (0.04 sec)
> 
> mysql> select sum(age),sum(id) from student;
> +----------+---------+
> | sum(age) | sum(id) |
> +----------+---------+
> |      115 |      43 |
> +----------+---------+
> 1 row in set (0.00 sec)
> 
> mysql> select sum(age)+sum(id) from student;
> +------------------+
> | sum(age)+sum(id) |
> +------------------+
> |              158 |
> +------------------+
> 1 row in set (0.00 sec)
> 
> ```
>
> max()/min():获取指定列的最大值或者最小值
>
> ```shell
> #查询年龄的最大值和最小值
> mysql> select max(age),min(age) from student;
> +----------+----------+
> | max(age) | min(age) |
> +----------+----------+
> |       30 |        8 |
> +----------+----------+
> 1 row in set (0.00 sec)
> ```
>
> avg():计算指定列的平均值，如果指定列类型不是数字类型，则计算结果为0
>
> ```shell
> #查询年龄的平均值
> mysql> select avg(age) from student;
> +----------+
> | avg(age) |
> +----------+
> |  14.3750 |
> +----------+
> 1 row in set (0.00 sec)
> 
> ```

##### 1.7分组查询-group by

> group by :分组查询
>
> having:有....,表示条件，注意和where的区别
>
> ```shell
> #1.查询男生和女生的人数
> mysql> select count(*) from student group by gender;
> +----------+
> | count(*) |
> +----------+
> |        1 |
> |        5 |
> |        3 |
> +----------+
> 3 rows in set (0.06 sec)
> 
> mysql> select count(*) from student where gender is not null group by gender;
> +----------+
> | count(*) |
> +----------+
> |        5 |
> |        3 |
> +----------+
> 2 rows in set (0.00 sec)
> 
> #雇员表
> #1.查询各部门的人数
> #2.查询每个部门的部门编号和每个部门的工资和
> #3.查询每个部门的部门编号和部门的人数
> #4.查询每个部门的部门编号以及每个部门工资大于5000的员工人数
> #5.查询工资总和大于9000的部门编号以及工资和
> #6.查询工资大于1500，部门工资总和大于6000的部门编号以及工资和
> mysql> create table emp(
>  -> empno int,
>  -> empname varchar(50),
>  -> job varchar(50),
>  -> mgr int,
>  -> hiredate date,
>  -> sal int,
>  -> comm int,
>  -> deptno int
>  -> );
> ERROR 1046 (3D000): No database selected
> mysql> use mydb1;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> create table emp( empno int, empname varchar(50), job varchar(50), mgr int, hiredate date, sal int, comm int, deptno int );
> Query OK, 0 rows affected (0.28 sec)
> 
> mysql> desc emp;
> +----------+-------------+------+-----+---------+-------+
> | Field    | Type        | Null | Key | Default | Extra |
> +----------+-------------+------+-----+---------+-------+
> | empno    | int(11)     | YES  |     | NULL    |       |
> | empname  | varchar(50) | YES  |     | NULL    |       |
> | job      | varchar(50) | YES  |     | NULL    |       |
> | mgr      | int(11)     | YES  |     | NULL    |       |
> | hiredate | date        | YES  |     | NULL    |       |
> | sal      | int(11)     | YES  |     | NULL    |       |
> | comm     | int(11)     | YES  |     | NULL    |       |
> | deptno   | int(11)     | YES  |     | NULL    |       |
> +----------+-------------+------+-----+---------+-------+
> 8 rows in set (0.10 sec)
> 
> mysql> insert into emp values(7369,'smith','clark',7902,'1980-12-17',800,null,20);
> Query OK, 1 row affected (0.14 sec)
> 
> mysql> 
> mysql> insert into emp values(7499,'allen','salesman',7698,'1981-02-20',1600,300,30);
> Query OK, 1 row affected (0.04 sec)
> 
> mysql> 
> mysql> insert into emp values(7521,'ward','salesman',7698,'1981-02-22',1250,500,30);
> Query OK, 1 row affected (0.09 sec)
> 
> mysql> 
> mysql> insert into emp values(7566,'jones','managen',7839,'1981-04-02',2975,null,30);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> 
> mysql> insert into emp values(7654,'martin','salesman',7698,'1981-09-28',1250,1400,30);
> Query OK, 1 row affected (0.01 sec)
> 
> mysql> insert into emp values(7698,'blake','manager',7839,'1981-05-01',2850,null,30);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> 
> mysql> insert into emp values(7782,'clark','manageer',7839,'1980-06-17',2450,null,10);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> 
> mysql> insert into emp values(7788,'scott','analyst',7566,'1987-02-20',3000,null,20);
> Query OK, 1 row affected (0.02 sec)
> 
> mysql> 
> mysql> insert into emp values(7839,'king','president',null,'1987-02-20',5000,null,10);
> Query OK, 1 row affected (0.01 sec)
> 
> mysql> 
> mysql> 
> mysql> 
> mysql> select * from emp;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7369 | smith   | clark     | 7902 | 1980-12-17 |  800 | NULL |     20 |
> |  7499 | allen   | salesman  | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman  | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman  | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> |  7698 | blake   | manager   | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> |  7782 | clark   | manageer  | 7839 | 1980-06-17 | 2450 | NULL |     10 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 9 rows in set (0.00 sec)
> 
> mysql> select count(*) from emp where deptno=30;
> +----------+
> | count(*) |
> +----------+
> |        5 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> select count(*) from emp group by  deptno;
> +----------+
> | count(*) |
> +----------+
> |        2 |
> |        2 |
> |        5 |
> +----------+
> 3 rows in set (0.00 sec)
> 
> mysql> select deptno,count(*) from emp group by  deptno;
> +--------+----------+
> | deptno | count(*) |
> +--------+----------+
> |     10 |        2 |
> |     20 |        2 |
> |     30 |        5 |
> +--------+----------+
> 3 rows in set (0.00 sec)
> 
> mysql> select deptno,sum(sal) from emp group by deptno;
> +--------+----------+
> | deptno | sum(sal) |
> +--------+----------+
> |     10 |     7450 |
> |     20 |     3800 |
> |     30 |     9925 |
> +--------+----------+
> 3 rows in set (0.00 sec)
> 
> mysql> select deptno,count(*) from emp where sal>5000 group by  deptno;
> Empty set (0.01 sec)
> 
> mysql> select deptno,count(*) from emp where sal>1500 group by  deptno;
> +--------+----------+
> | deptno | count(*) |
> +--------+----------+
> |     10 |        2 |
> |     20 |        1 |
> |     30 |        3 |
> +--------+----------+
> 3 rows in set (0.00 sec)
> 
> mysql> select deptno,sum(sal) from emp group by deptno;
> +--------+----------+
> | deptno | sum(sal) |
> +--------+----------+
> |     10 |     7450 |
> |     20 |     3800 |
> |     30 |     9925 |
> +--------+----------+
> 3 rows in set (0.00 sec)
> 
> mysql> select deptno,sum(sal) from emp group by deptno having sum(sal)>9000;
> +--------+----------+
> | deptno | sum(sal) |
> +--------+----------+
> |     30 |     9925 |
> +--------+----------+
> 1 row in set (0.05 sec)
> 
> mysql> select deptno,sum(sal) from emp group by deptno where sum(sal)>9000;
> ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'where sum(sal)>9000' at line 1
> mysql> select * from emp where sal>1500;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7499 | allen   | salesman  | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7698 | blake   | manager   | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> |  7782 | clark   | manageer  | 7839 | 1980-06-17 | 2450 | NULL |     10 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 6 rows in set (0.02 sec)
> 
> mysql> select * from emp where sal>1500 group by deptno;
> ERROR 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'mydb1.emp.empno' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
> mysql> select deptno,sum(sal) from emp where sal>1500 group by 
>  -> ;
> ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 1
> mysql> select deptno,sum(sal) from emp where sal>1500 
>  -> group by deptno;
> +--------+----------+
> | deptno | sum(sal) |
> +--------+----------+
> |     10 |     7450 |
> |     20 |     3000 |
> |     30 |     7425 |
> +--------+----------+
> 3 rows in set (0.00 sec)
> 
> mysql> select deptno,sum(sal) from emp where sal>1500 group by deptno;
> +--------+----------+
> | deptno | sum(sal) |
> +--------+----------+
> |     10 |     7450 |
> |     20 |     3000 |
> |     30 |     7425 |
> +--------+----------+
> 3 rows in set (0.01 sec)
> 
> mysql> select deptno,sum(sal) from emp where sal>1500 group by deptno
>  -> having sum(sal)>6000;
> +--------+----------+
> | deptno | sum(sal) |
> +--------+----------+
> |     10 |     7450 |
> |     30 |     7425 |
> +--------+----------+
> 2 rows in set (0.01 sec)
> 
> mysql> use mydb2;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb2 |
> +-----------------+
> | score           |
> | student         |
> +-----------------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student;
> +------+--------+------+---------------------+-------+
> | sno  | sname  | ssex | sbirthday           | class |
> +------+--------+------+---------------------+-------+
> | 108  | 曾华   | 男   | 1977-09-01 00:00:00 | 95033 |
> | 105  | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |
> | 107  | 王丽   | 女   | 1976-01-23 00:00:00 | 95033 |
> | 101  | 李军   | 男   | 1976-02-20 00:00:00 | 95033 |
> | 109  | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |
> | 103  | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |
> +------+--------+------+---------------------+-------+
> 6 rows in set (0.04 sec)
> 
> mysql> select * from score;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-245 |     86 |
> | 105  | 3-245 |     75 |
> | 109  | 3-245 |     68 |
> | 103  | 3-105 |     92 |
> | 105  | 3-105 |     88 |
> | 109  | 3-105 |     76 |
> | 103  | 3-105 |     64 |
> | 105  | 3-105 |     91 |
> | 109  | 3-105 |     78 |
> | 103  | 6-166 |     85 |
> | 105  | 6-166 |     79 |
> | 109  | 6-166 |     81 |
> +------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select cno,avg(degree) from score group by cno;
> +-------+-------------+
> | cno   | avg(degree) |
> +-------+-------------+
> | 3-105 |     81.5000 |
> | 3-245 |     76.3333 |
> | 6-166 |     81.6667 |
> +-------+-------------+
> 3 rows in set (0.05 sec)
> 
> mysql> select cno,avg(degree) from score where cno like '3%' 
>  -> group by cno having count(cno)>=5;
> +-------+-------------+
> | cno   | avg(degree) |
> +-------+-------------+
> | 3-105 |     81.5000 |
> +-------+-------------+
> 1 row in set (0.02 sec)
> 
> mysql> select cno,count(cno) from score group by cno;
> +-------+------------+
> | cno   | count(cno) |
> +-------+------------+
> | 3-105 |          6 |
> | 3-245 |          3 |
> | 6-166 |          3 |
> +-------+------------+
> 3 rows in set (0.00 sec)
> 
> mysql> 
> ```
>
> where和having的区别：
>
> ​	a.相同点：二者都可以作为条件使用
>
> ​	b.having是在分组后对数据进行过滤，但是，where在分组之前对数据进行过滤
>
> ​	c.having后面可以使用聚合函数，where后面不能使用聚合函数
>
> ​	d.书写和执行顺序：where----->group by ----->having

##### 1.8分页查询-limit

> limit:用来限定查询结构的起始行和总行数
>
> 语法：limit  i,n;     i表示起始索引，n表示需要查找的总行数
>
> 说明：
>
> ​	a.查询10条语句，索引从0到9，第1条记录到第10条记录
>
> ​	    select * from user  limit 10;       注意：limit n等价于limit 0,n
>
> ​	    select * from user  limit 0,10;
>
> ​	b.查询8条语句，索引从5到12，第6条记录到第13条记录
>
> ​	     select * from user  limit 5,8;
>
> ​	c.查询从某个指定索引开始，到结束所有的记录行，可以指定第二个参数为-1
>
> ​	     select * from user  limit 5,-1;
>
> ```shell
> mysql> select * from emp limit 4;
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7369 | smith   | clark    | 7902 | 1980-12-17 |  800 | NULL |     20 |
> |  7499 | allen   | salesman | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen  | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 4 rows in set (0.00 sec)
> 
> mysql> select * from emp limit 2,3;
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen  | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 3 rows in set (0.00 sec)
> 
> ```

##### 1.9书写和执行顺序

> 书写顺序：select ----->from----->where----->group by ---->having---->order by--->limit
>
> 执行顺序：from ---->where ---->group by---->having ----->select---->order by----->limit

### 三、数据的完整性

> 作用：保证用户输入的数据保存到数据库中完全正确的
>
> 确保数据库中数据的正确则在创建表的时候给表中的数据添加约束
>
> 数据的完整性的分类：
>
> ​	实体完整性
>
> ​	域完整性
>
> ​	引用完整性

#### 1.实体完整性

> 定义主键和外键主要是为了维护关系型数据库的表之间的完整性
>
> 主键：是确定能够一条记录的唯一标识，比如：用户表，每个用户的信息表中的一条记录，包括身份证号，姓名，年龄等，只有身份证号可以唯一的确定这个人，其他信息都有可能会重复，所以，将身份证号设置为主键
>
> 外键：用于关联另一张表，是能确定另一张表的字段，用于保证数据的一致性
>
> 约束类型：
>
> ​	主键约束、唯一约束、自动增长列

##### 1.1主键约束【primary key】

> 特点：数据唯一，不能为null
>
> 主键是表中的一个字段或者多个字段，它的值用于唯一的标记当前的记录，在两个表的关联关系中，主键用来在一个表中引用另一个表中的特定记录
>
> ```shell
> mysql> use mydb3;
> Database changed
> #方式一
> mysql> create table stu1(
>  -> sid int primary key,
>  -> name varchar(30)
>  -> );
> Query OK, 0 rows affected (0.11 sec)
> 
> mysql> desc stu1;
> +-------+-------------+------+-----+---------+-------+
> | Field | Type        | Null | Key | Default | Extra |
> +-------+-------------+------+-----+---------+-------+
> | sid   | int(11)     | NO   | PRI | NULL    |       |
> | name  | varchar(30) | YES  |     | NULL    |       |
> +-------+-------------+------+-----+---------+-------+
> 2 rows in set (0.05 sec)
> 
> #方式二
> mysql> create table stu2(
>  -> sid int,
>  -> name varchar(50),
>  -> primary key(sid)
>  -> );
> Query OK, 0 rows affected (0.15 sec)
> 
> mysql> desc stu2;
> +-------+-------------+------+-----+---------+-------+
> | Field | Type        | Null | Key | Default | Extra |
> +-------+-------------+------+-----+---------+-------+
> | sid   | int(11)     | NO   | PRI | NULL    |       |
> | name  | varchar(50) | YES  |     | NULL    |       |
> +-------+-------------+------+-----+---------+-------+
> 2 rows in set (0.07 sec)
> 
> #方式三
> mysql> create table stu3( sid int, name varchar(40) );
> Query OK, 0 rows affected (0.11 sec)
> 
> mysql> desc stu3;
> +-------+-------------+------+-----+---------+-------+
> | Field | Type        | Null | Key | Default | Extra |
> +-------+-------------+------+-----+---------+-------+
> | sid   | int(11)     | YES  |     | NULL    |       |
> | name  | varchar(40) | YES  |     | NULL    |       |
> +-------+-------------+------+-----+---------+-------+
> 2 rows in set (0.00 sec)
> 
> mysql> alter table stu3 add constraint stu3_id 
>  -> primary key(sid);
> Query OK, 0 rows affected
> ```

##### 1.2唯一约束【unique】

> 作用：确保非主键列中不能输入重复的值
>
> 注意：在一张表中，primary key一般只设置给一个字段，unique可以设置给除了主键之外的任意的字段，unique限定的字段可以为null
>
> ```shell
> mysql> create table stu4( sid int primary key, name varchar
>  -> (50) unique);
> Query OK, 0 rows affected (0.06 sec)
> 
> ```

##### 1.3自动增长列【auto_increment】

> 作用：一般给主键自动增长列，列只能是整数类型，但是如果删除之前的序号，后面新添加的㞑不会重新开始，而是接着被删除的序号显示
>
> ```shell
> mysql> create table stu5(
>  -> sid int primary key auto_increment,
>  -> name varchar(20)
>  -> );
> Query OK, 0 rows affected (0.07 sec)
> 
> mysql> 
> 
> ```

#### 2.域完整性

> 作用：限制当前单元格中的数据的正确性，域表示当前单元格
>
> 约束类型：
>
> ​	数据类型
>
> ​	非空约束：not null
>
> ​	默认值约束：default

##### 2.1数据类型

> 数值类型：int/float/double
>
> 日期类型：date
>
> 字符串类型：char/varchar

##### 2.2非空约束

> ```shell
> mysql> create table stu5(
>  -> id int primary key auto_increment,
>  -> name varchar(50) unique not null
>  -> );
> Query OK, 0 rows affected (0.02 sec)
> 
> #插入数据的时候，name不能为空，如果为空，则数据库报错
> 
> ```

##### 2.3默认值约束

> ```
> mysql> create table stu6(
>  -> id int primary key auto_increment,
>  -> name varchar(50) unique not null,
>  -> address varchar(50) default "beijing"
>  -> );
> Query OK, 0 rows affected (0.03 sec)
> 
> mysql> insert into stu6(name) values('ddd');
> Query OK, 1 row affected (0.00 sec)
> 
> #如果不设置值，则使用默认值
> mysql> insert into stu6(name,address) values('eeee','shenzhen');
> Query OK, 1 row affected (0.01 sec)
> mysql> insert into stu6(name,address) values('fff',default);
> Query OK, 1 row affected (0.00 sec)
> 
> #下面两种写法等价
> mysql> insert into stu6  values(null,'fff',default);
> ERROR 1062 (23000): Duplicate entry 'fff' for key 'name'  #提示重复，因为name是unique
> mysql> insert into stu6  values(null,'ggg',default);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> select * from stu6;
> +----+------+----------+
> | id | name | address  |
> +----+------+----------+
> |  1 | ddd  | beijing  |
> |  2 | eeee | NULL     |
> |  3 | fff  | beijing  |
> |  5 | ggg  | beijing  |
> |  6 | ee1  | shenzhen |
> +----+------+----------+
> 5 rows in set (0.00 sec)
> 
> ```

#### 3.引用完整性

> 一般情况下，如果要进行多张表的联合操作，则需要设置外键，外键一般是主键，主键和外键的类型保持一致
>
> ```shell
> #方式一
> mysql> create table student1( stuid varchar(10) primary key, stuname varchar(20) );
> Query OK, 0 rows affected (0.04 sec)
> 
> mysql> create table score1( stuid varchar(10), score int, cid int );Query OK, 0 rows affected (0.06 sec)
> 
> mysql> alter table score1 add constraint fk 
>  -> foreign key(stuid) references student1(stuid);
> Query OK, 0 rows affected (0.17 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> #方式二
> mysql> create table student2( stuid varchar(10) primary key, stuname varchar(20) );
> Query OK, 0 rows affected (0.14 sec)
> 
> mysql> create table score2(
>  -> score int,
>  -> cid int,
>  -> constraint stu_sco_key foreign key(stuid) references
>  -> student2(stuid));
> Query OK, 0 rows affected (0.08 sec)
> 
> mysql> 
> ```

#### 4.表与表之间的关系

> 一对一：A和B两张表，在A中任意取出一条数据，在B中也会找出唯一的一条数据
>
> 一对多：A和B两张表，在A中任意取出一条数据，在B中会找到多条数据
>
> 多对多：A、B和C三张表，在A中任意取出一条数据，在B中会找到多条数据，在B中任意取出一条数据，在C中会找到多条数据

### 四、多表查询

#### 1.合并结果集

> 作用：将两个select语句的查询结果合并到一起
>
> 合并结果集的两种方式：
>
> ​	union:去除重复记录【相当于求并集】
>
> ​	union all:不去除重复记录
>
> ```shell
> mysql> create table A(
>  -> name varchar(20),
>  -> score int
>  -> );
> Query OK, 0 rows affected (0.08 sec)
> 
> mysql> create table B( name varchar(20), score int );
> Query OK, 0 rows affected (0.05 sec)
> 
> mysql> insert into A values('a',10),('b',20),('c',30);
> Query OK, 3 rows affected (0.07 sec)
> Records: 3  Duplicates: 0  Warnings: 0
> 
> mysql> insert into B values('a',10),('b',20),('d',40);
> Query OK, 3 rows affected (0.01 sec)
> Records: 3  Duplicates: 0  Warnings: 0
> 
> mysql> select * from A;
> +------+-------+
> | name | score |
> +------+-------+
> | a    |    10 |
> | b    |    20 |
> | c    |    30 |
> +------+-------+
> 3 rows in set (0.00 sec)
> 
> mysql> select * from B;
> +------+-------+
> | name | score |
> +------+-------+
> | a    |    10 |
> | b    |    20 |
> | d    |    40 |
> +------+-------+
> 3 rows in set (0.00 sec)
> 
> mysql> select * from A
>  -> union 
>  -> select * from B;
> +------+-------+
> | name | score |
> +------+-------+
> | a    |    10 |
> | b    |    20 |
> | c    |    30 |
> | d    |    40 |
> +------+-------+
> 4 rows in set (0.08 sec)
> 
> mysql> select * from A union all select * from B;
> +------+-------+
> | name | score |
> +------+-------+
> | a    |    10 |
> | b    |    20 |
> | c    |    30 |
> | a    |    10 |
> | b    |    20 |
> | d    |    40 |
> +------+-------+
> 6 rows in set (0.00 sec)
> 
> mysql> 
> ```

# Day3 数据库复杂查询

### 一、上堂回顾

#### 1.默写题目

> 已知user表，其中的字段有uid,name,age，书写符合下面要求的sql语句
>
> 1.查询表中所有姓李的人的记录
>
> 模糊查询like：select * from user where name like  "李%";
>
> 2.查询所有的name和age，结果集中的字段名为  姓名   和  年龄
>
> 字段控制查询as:select name 姓名,age  年龄 from user;
>
> 3.查询不重复的name列
>
> 字段控制查询distinct:select distinct name from user;
>
> 4.根据年龄进行降序排序
>
> 排序order by:select * from user order by age desc;
>
> 5.求所有人的年龄和
>
> 聚合函数sum：select sum(age) from user;
>
> 6.查询所有信息，只显示前5条数据
>
> 分页查询limit：select * from user  limit   5;
>
> 7.书写创建user表的sql语句，其中uid为主键并且为自增长列，给name添加唯一约束并且值不为null，age的默认值为18
>
> 约束：主键约束，唯一约束，默认值约束，不为null约束
>
> create table user(uid int primary key  auto_increment,name varchar(20) unique not null,age int default 18);

#### 2.知识点回顾

> 1.DQL:重点掌握【group   by】
>
> 2.数据库的完整性
>
> ​	添加约束：主键，唯一约束，外键
>
> ​	primary key
>
> ​	unique
>
> ​	auto_increment
>
> ​	not null
>
> ​        default
>
> ​	foreign key

### 二、多表查询【重点掌握】

#### 1.连接查询

> 求出多个表的乘积，例如t1连接t2,那么查询的结果是t1 * t2,会产生笛卡尔积，而在实际应用中，需要去除重复的记录，则需要通过条件进行过滤
>
> 解决办法：可以使用主外键之间的关系作为条件去除无用信息
>
> ```shell
> rock@rockrong:~$ mysql -u root -p
> Enter password: 
> Welcome to the MySQL monitor.  Commands end with ; or \g.
> Your MySQL connection id is 5
> Server version: 5.7.27-0ubuntu0.16.04.1 (Ubuntu)
> 
> Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
> 
> Oracle is a registered trademark of Oracle Corporation and/or its
> affiliates. Other names may be trademarks of their respective
> owners.
> 
> Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
> 
> mysql> show databases;
> +--------------------+
> | Database           |
> +--------------------+
> | information_schema |
> | mydb1              |
> | mydb2              |
> | mydb3              |
> | mysql              |
> | performance_schema |
> | sys                |
> +--------------------+
> 7 rows in set (0.20 sec)
> 
> mysql> use mydb2;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb2 |
> +-----------------+
> | score           |
> | student         |
> +-----------------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from student;
> +------+--------+------+---------------------+-------+
> | sno  | sname  | ssex | sbirthday           | class |
> +------+--------+------+---------------------+-------+
> | 108  | 曾华   | 男   | 1977-09-01 00:00:00 | 95033 |
> | 105  | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |
> | 107  | 王丽   | 女   | 1976-01-23 00:00:00 | 95033 |
> | 101  | 李军   | 男   | 1976-02-20 00:00:00 | 95033 |
> | 109  | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |
> | 103  | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |
> +------+--------+------+---------------------+-------+
> 6 rows in set (0.06 sec)
> 
> mysql> select * from score;
> +------+-------+--------+
> | sno  | cno   | degree |
> +------+-------+--------+
> | 103  | 3-245 |     86 |
> | 105  | 3-245 |     75 |
> | 109  | 3-245 |     68 |
> | 103  | 3-105 |     92 |
> | 105  | 3-105 |     88 |
> | 109  | 3-105 |     76 |
> | 103  | 3-105 |     64 |
> | 105  | 3-105 |     91 |
> | 109  | 3-105 |     78 |
> | 103  | 6-166 |     85 |
> | 105  | 6-166 |     79 |
> | 109  | 6-166 |     81 |
> +------+-------+--------+
> 12 rows in set (0.05 sec)
> 
> mysql> select count(*) from student,score;    #12 * 6 = 72
> +----------+
> | count(*) |
> +----------+
> |       72 |
> +----------+
> 1 row in set (0.03 sec)
> 
> mysql> select count(*) from student;      #6
> +----------+
> | count(*) |
> +----------+
> |        6 |
> +----------+
> 1 row in set (0.01 sec)
> 
> mysql> select count(*) from score;    #12
> +----------+
> | count(*) |
> +----------+
> |       12 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> desc student;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | sno       | varchar(20) | YES  |     | NULL    |       |
> | sname     | varchar(20) | YES  |     | NULL    |       |
> | ssex      | varchar(20) | YES  |     | NULL    |       |
> | sbirthday | datetime    | YES  |     | NULL    |       |
> | class     | varchar(20) | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 5 rows in set (0.17 sec)
> 
> mysql> desc score;
> +--------+---------------+------+-----+---------+-------+
> | Field  | Type          | Null | Key | Default | Extra |
> +--------+---------------+------+-----+---------+-------+
> | sno    | varchar(20)   | YES  |     | NULL    |       |
> | cno    | varchar(20)   | YES  |     | NULL    |       |
> | degree | decimal(10,0) | YES  |     | NULL    |       |
> +--------+---------------+------+-----+---------+-------+
> 3 rows in set (0.00 sec)
> 
> #设置主键
> mysql> alter table student add constraint stu_id primary key(sno);
> Query OK, 0 rows affected (1.55 sec)
> Records: 0  Duplicates: 0  Warnings: 0
> 
> mysql> desc student;
> +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | sno       | varchar(20) | NO   | PRI | NULL    |       |
> | sname     | varchar(20) | YES  |     | NULL    |       |
> | ssex      | varchar(20) | YES  |     | NULL    |       |
> | sbirthday | datetime    | YES  |     | NULL    |       |
> | class     | varchar(20) | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 5 rows in set (0.02 sec)
> 
> #设置外键
> mysql> alter table score add constraint fk_id foreign key(sno) references student(sno);
> Query OK, 12 rows affected (0.15 sec)
> Records: 12  Duplicates: 0  Warnings: 0
> 
> mysql> desc student;                                                          +-----------+-------------+------+-----+---------+-------+
> | Field     | Type        | Null | Key | Default | Extra |
> +-----------+-------------+------+-----+---------+-------+
> | sno       | varchar(20) | NO   | PRI | NULL    |       |
> | sname     | varchar(20) | YES  |     | NULL    |       |
> | ssex      | varchar(20) | YES  |     | NULL    |       |
> | sbirthday | datetime    | YES  |     | NULL    |       |
> | class     | varchar(20) | YES  |     | NULL    |       |
> +-----------+-------------+------+-----+---------+-------+
> 5 rows in set (0.00 sec)
> 
> mysql> desc score;
> +--------+---------------+------+-----+---------+-------+
> | Field  | Type          | Null | Key | Default | Extra |
> +--------+---------------+------+-----+---------+-------+
> | sno    | varchar(20)   | YES  | MUL | NULL    |       |
> | cno    | varchar(20)   | YES  |     | NULL    |       |
> | degree | decimal(10,0) | YES  |     | NULL    |       |
> +--------+---------------+------+-----+---------+-------+
> 3 rows in set (0.00 sec)
> 
> mysql> select count(*) from student,score;
> +----------+
> | count(*) |
> +----------+
> |       72 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> select count(*) from student,score where student.sno = score.sno;
> +----------+
> | count(*) |
> +----------+
> |       12 |
> +----------+
> 1 row in set (0.10 sec)
> 
> mysql> select *  from student,score where student.sno = score.sno;
> +-----+--------+------+---------------------+-------+------+-------+--------+
> | sno | sname  | ssex | sbirthday           | class | sno  | cno   | degree |
> +-----+--------+------+---------------------+-------+------+-------+--------+
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 103  | 3-245 |     86 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 103  | 3-105 |     92 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 103  | 3-105 |     64 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 103  | 6-166 |     85 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 105  | 3-245 |     75 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 105  | 3-105 |     88 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 105  | 3-105 |     91 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 105  | 6-166 |     79 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 109  | 3-245 |     68 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 109  | 3-105 |     76 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 109  | 3-105 |     78 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 109  | 6-166 |     81 |
> +-----+--------+------+---------------------+-------+------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select student.sno,student.sname,student.ssex,student.sbirthday,student.class,score.cno,score.degree from student,score where student.sno=score.sno;
> +-----+--------+------+---------------------+-------+-------+--------+
> | sno | sname  | ssex | sbirthday           | class | cno   | degree |
> +-----+--------+------+---------------------+-------+-------+--------+
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 3-245 |     86 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 3-105 |     92 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 3-105 |     64 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 6-166 |     85 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 3-245 |     75 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 3-105 |     88 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 3-105 |     91 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 6-166 |     79 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 3-245 |     68 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 3-105 |     76 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 3-105 |     78 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 6-166 |     81 |
> +-----+--------+------+---------------------+-------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s,score c where s.sno=c.sno;
> +-----+--------+------+-------+--------+
> | sno | sname  | ssex | cno   | degree |
> +-----+--------+------+-------+--------+
> | 103 | 陆君   | 男   | 3-245 |     86 |
> | 103 | 陆君   | 男   | 3-105 |     92 |
> | 103 | 陆君   | 男   | 3-105 |     64 |
> | 103 | 陆君   | 男   | 6-166 |     85 |
> | 105 | 匡明   | 男   | 3-245 |     75 |
> | 105 | 匡明   | 男   | 3-105 |     88 |
> | 105 | 匡明   | 男   | 3-105 |     91 |
> | 105 | 匡明   | 男   | 6-166 |     79 |
> | 109 | 王芳   | 女   | 3-245 |     68 |
> | 109 | 王芳   | 女   | 3-105 |     76 |
> | 109 | 王芳   | 女   | 3-105 |     78 |
> | 109 | 王芳   | 女   | 6-166 |     81 |
> +-----+--------+------+-------+--------+
> 12 rows in set (0.00 sec)
> ```

##### 1.1内连接-inner join on 

> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s,score c where s.sno=c.sno;就是内连接，但是他不是标准sql语句,而标准的sql语句使用的join ...on...实现内连接
>
> 下面的两条语句是等价的：
>
> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s,score c where s.sno=c.sno;     方言
>
> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s join score c on s.sno=c.sno;     sql标准语句
>
> ```shell
> 演示命令：
> mysql> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s,score c where s.sno=c.sno;
> +-----+--------+------+-------+--------+
> | sno | sname  | ssex | cno   | degree |
> +-----+--------+------+-------+--------+
> | 103 | 陆君   | 男   | 3-245 |     86 |
> | 103 | 陆君   | 男   | 3-105 |     92 |
> | 103 | 陆君   | 男   | 3-105 |     64 |
> | 103 | 陆君   | 男   | 6-166 |     85 |
> | 105 | 匡明   | 男   | 3-245 |     75 |
> | 105 | 匡明   | 男   | 3-105 |     88 |
> | 105 | 匡明   | 男   | 3-105 |     91 |
> | 105 | 匡明   | 男   | 6-166 |     79 |
> | 109 | 王芳   | 女   | 3-245 |     68 |
> | 109 | 王芳   | 女   | 3-105 |     76 |
> | 109 | 王芳   | 女   | 3-105 |     78 |
> | 109 | 王芳   | 女   | 6-166 |     81 |
> +-----+--------+------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s,score c where s.sno=c.sno;
> +-----+--------+------+-------+--------+
> | sno | sname  | ssex | cno   | degree |
> +-----+--------+------+-------+--------+
> | 103 | 陆君   | 男   | 3-245 |     86 |
> | 103 | 陆君   | 男   | 3-105 |     92 |
> | 103 | 陆君   | 男   | 3-105 |     64 |
> | 103 | 陆君   | 男   | 6-166 |     85 |
> | 105 | 匡明   | 男   | 3-245 |     75 |
> | 105 | 匡明   | 男   | 3-105 |     88 |
> | 105 | 匡明   | 男   | 3-105 |     91 |
> | 105 | 匡明   | 男   | 6-166 |     79 |
> | 109 | 王芳   | 女   | 3-245 |     68 |
> | 109 | 王芳   | 女   | 3-105 |     76 |
> | 109 | 王芳   | 女   | 3-105 |     78 |
> | 109 | 王芳   | 女   | 6-166 |     81 |
> +-----+--------+------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select s.sno,s.sname,s.ssex,c.cno,c.degree  from student s join score c on s.sno=c.sno;
> +-----+--------+------+-------+--------+
> | sno | sname  | ssex | cno   | degree |
> +-----+--------+------+-------+--------+
> | 103 | 陆君   | 男   | 3-245 |     86 |
> | 103 | 陆君   | 男   | 3-105 |     92 |
> | 103 | 陆君   | 男   | 3-105 |     64 |
> | 103 | 陆君   | 男   | 6-166 |     85 |
> | 105 | 匡明   | 男   | 3-245 |     75 |
> | 105 | 匡明   | 男   | 3-105 |     88 |
> | 105 | 匡明   | 男   | 3-105 |     91 |
> | 105 | 匡明   | 男   | 6-166 |     79 |
> | 109 | 王芳   | 女   | 3-245 |     68 |
> | 109 | 王芳   | 女   | 3-105 |     76 |
> | 109 | 王芳   | 女   | 3-105 |     78 |
> | 109 | 王芳   | 女   | 6-166 |     81 |
> +-----+--------+------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> 
> 
> 
> #1.查询分数大于70的学生信息
> mysql> select s.sno,sname,ssex,sbirthday,class,degree  from student s,score c  where s.sno=c.sno and degree>70;
> +-----+--------+------+---------------------+-------+--------+
> | sno | sname  | ssex | sbirthday           | class | degree |
> +-----+--------+------+---------------------+-------+--------+
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |     86 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |     75 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |     92 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |     88 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |     76 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |     91 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |     78 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 |     85 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 |     79 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 |     81 |
> +-----+--------+------+---------------------+-------+--------+
> 10 rows in set (0.00 sec)
> 
> mysql> select s.sno,sname,ssex,class,degree from student s join score c on s.sno=c.sno where degree>70;
> +-----+--------+------+-------+--------+
> | sno | sname  | ssex | class | degree |
> +-----+--------+------+-------+--------+
> | 103 | 陆君   | 男   | 95031 |     86 |
> | 105 | 匡明   | 男   | 95031 |     75 |
> | 103 | 陆君   | 男   | 95031 |     92 |
> | 105 | 匡明   | 男   | 95031 |     88 |
> | 109 | 王芳   | 女   | 95031 |     76 |
> | 105 | 匡明   | 男   | 95031 |     91 |
> | 109 | 王芳   | 女   | 95031 |     78 |
> | 103 | 陆君   | 男   | 95031 |     85 |
> | 105 | 匡明   | 男   | 95031 |     79 |
> | 109 | 王芳   | 女   | 95031 |     81 |
> +-----+--------+------+-------+--------+
> 10 rows in set (0.00 sec)
> ```

##### 1.2外连接

> 分类：
>
> ​	左外连接【left join on】：除了指定内连接的数据之外，增加左边表中的额外数据【左表选择全部数据，右表选择交集的数据】
>
> ​	右外连接【right join on】：同左外连接相反，出内连接的数据之外，额外选择右表中的额外数据【右表选择全部数据，左表选择交集的数据】
>
> ​	全外连接：【MySQL不支持】
>
> ```shell
> #左外连接
> #参照student
> mysql> select s.sno,sname,cno  from student s left join score c on s.sno=c.sno;
> +-----+--------+-------+
> | sno | sname  | cno   |
> +-----+--------+-------+
> | 101 | 李军   | NULL  |
> | 103 | 陆君   | 3-245 |
> | 103 | 陆君   | 3-105 |
> | 103 | 陆君   | 3-105 |
> | 103 | 陆君   | 6-166 |
> | 105 | 匡明   | 3-245 |
> | 105 | 匡明   | 3-105 |
> | 105 | 匡明   | 3-105 |
> | 105 | 匡明   | 6-166 |
> | 107 | 王丽   | NULL  |
> | 108 | 曾华   | NULL  |
> | 109 | 王芳   | 3-245 |
> | 109 | 王芳   | 3-105 |
> | 109 | 王芳   | 3-105 |
> | 109 | 王芳   | 6-166 |
> +-----+--------+-------+
> 15 rows in set (0.01 sec)
> 
> #左外连接
> #参照score
> mysql> select s.sno,sname,cno  from score c left join student s on s.sno=c.sno;
> +------+--------+-------+
> | sno  | sname  | cno   |
> +------+--------+-------+
> | 103  | 陆君   | 3-245 |
> | 105  | 匡明   | 3-245 |
> | 109  | 王芳   | 3-245 |
> | 103  | 陆君   | 3-105 |
> | 105  | 匡明   | 3-105 |
> | 109  | 王芳   | 3-105 |
> | 103  | 陆君   | 3-105 |
> | 105  | 匡明   | 3-105 |
> | 109  | 王芳   | 3-105 |
> | 103  | 陆君   | 6-166 |
> | 105  | 匡明   | 6-166 |
> | 109  | 王芳   | 6-166 |
> +------+--------+-------+
> 12 rows in set (0.00 sec)
> 
> #右外连接
> #参照score
> mysql> select s.sno,sname,cno  from student s right join score c on s.sno=c.sno;
> +------+--------+-------+
> | sno  | sname  | cno   |
> +------+--------+-------+
> | 103  | 陆君   | 3-245 |
> | 105  | 匡明   | 3-245 |
> | 109  | 王芳   | 3-245 |
> | 103  | 陆君   | 3-105 |
> | 105  | 匡明   | 3-105 |
> | 109  | 王芳   | 3-105 |
> | 103  | 陆君   | 3-105 |
> | 105  | 匡明   | 3-105 |
> | 109  | 王芳   | 3-105 |
> | 103  | 陆君   | 6-166 |
> | 105  | 匡明   | 6-166 |
> | 109  | 王芳   | 6-166 |
> +------+--------+-------+
> 12 rows in set (0.00 sec)
> 
> #右外连接
> #参照student
> mysql> select s.sno,sname,cno  from score c right join student s on s.sno=c.sno;
> 
> mysql> 
> ```
>
> 总结：
>
> ​	a.表A   inner join 表B:
>
> ​		A和B匹配的行会出现在结果集中
>
> ​	b.表A   left  join 表B /  表B   right   join 表A:
>
> ​		A和B匹配的行会出现在结果集中,外加A中独有的数据，未对应的数据使用null填充
>
> ​	c.表A   right  join 表B  /  表B   left  join 表A:
>
> ​		A和B匹配的行会出现在结果集中,外加B中独有的数据，未对应的数据使用null填充

##### 1.3自然连接-natural join

> 连接查询会产生笛卡尔积，通常使用主外键关系等式去除无用的信息，而自然连接不需要你给出主外键关系，它会自动找到两张表中的等式
>
> ```
> mysql> select * from student natural join score;
> +-----+--------+------+---------------------+-------+-------+--------+
> | sno | sname  | ssex | sbirthday           | class | cno   | degree |
> +-----+--------+------+---------------------+-------+-------+--------+
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 3-245 |     86 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 3-105 |     92 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 3-105 |     64 |
> | 103 | 陆君   | 男   | 1974-06-03 00:00:00 | 95031 | 6-166 |     85 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 3-245 |     75 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 3-105 |     88 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 3-105 |     91 |
> | 105 | 匡明   | 男   | 1975-10-02 00:00:00 | 95031 | 6-166 |     79 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 3-245 |     68 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 3-105 |     76 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 3-105 |     78 |
> | 109 | 王芳   | 女   | 1975-02-10 00:00:00 | 95031 | 6-166 |     81 |
> +-----+--------+------+---------------------+-------+-------+--------+
> 12 rows in set (0.00 sec)
> 
> mysql> select s.sno,sname,ssex,class,cno,degree  from stduent s natural join score c;
> ERROR 1146 (42S02): Table 'mydb2.stduent' doesn't exist
> mysql> select s.sno,sname,ssex,class,cno,degree  from student s natural join score c;
> +-----+--------+------+-------+-------+--------+
> | sno | sname  | ssex | class | cno   | degree |
> +-----+--------+------+-------+-------+--------+
> | 103 | 陆君   | 男   | 95031 | 3-245 |     86 |
> | 103 | 陆君   | 男   | 95031 | 3-105 |     92 |
> | 103 | 陆君   | 男   | 95031 | 3-105 |     64 |
> | 103 | 陆君   | 男   | 95031 | 6-166 |     85 |
> | 105 | 匡明   | 男   | 95031 | 3-245 |     75 |
> | 105 | 匡明   | 男   | 95031 | 3-105 |     88 |
> | 105 | 匡明   | 男   | 95031 | 3-105 |     91 |
> | 105 | 匡明   | 男   | 95031 | 6-166 |     79 |
> | 109 | 王芳   | 女   | 95031 | 3-245 |     68 |
> | 109 | 王芳   | 女   | 95031 | 3-105 |     76 |
> | 109 | 王芳   | 女   | 95031 | 3-105 |     78 |
> | 109 | 王芳   | 女   | 95031 | 6-166 |     81 |
> +-----+--------+------+-------+-------+--------+
> 12 rows in set (0.00 sec)
> ```

#### 2.子查询

> 一个select语句中包含另一个完整的select语句【select语句嵌套】
>
> 子查询就是嵌套查询，如果一条语句中包含两个或者两个以上的select，那么被称为子查询
>
> 注意：
>
> ​	a.子查询出现的位置
>
> ​		from后，同时where后，作为条件的一部分使用
>
> ​	b.当子查询出现在where后面作为条件时，则可以使用关键字any和all
>
> ​	c.子查询结果集的形式：
>
> ​		单行单列【用于条件】
>
> ​		单行多列【用于条件】
>
> ​		多行单列【用于条件】
>
> ​		多行多列【用于表】
>
> ```shell
> #1.查询和allen在同一个部门的员工信息
> #思路：查询allen的部门xxx     查询部门为xxx的员工
> #2.查询工资高于black的员工信息
> #3.查询工资高于30部门所有人的员工信息
> #4.查询工作和工资与martin完全相同的员工信息
> #5.查询有两个以上直接下属的员工编号
> 
> 演示命令：
> mysql> select deptno from emp where empname='allen';
> +--------+
> | deptno |
> +--------+
> |     30 |
> +--------+
> 1 row in set (0.00 sec)
> 
> mysql> select * from emp where deptno=30;
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7499 | allen   | salesman | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen  | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> |  7698 | blake   | manager  | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 5 rows in set (0.00 sec)
> 
> mysql> select * from emp where deptno=(select deptno from emp where empname='allen');
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7499 | allen   | salesman | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen  | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> |  7698 | blake   | manager  | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 5 rows in set (0.09 sec)
> 
> mysql> select sal from emp where empname='blake';
> +------+
> | sal  |
> +------+
> | 2850 |
> +------+
> 1 row in set (0.18 sec)
> 
> mysql> select * from emp where sal=2850;
> +-------+---------+---------+------+------------+------+------+--------+
> | empno | empname | job     | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+---------+------+------------+------+------+--------+
> |  7698 | blake   | manager | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> +-------+---------+---------+------+------------+------+------+--------+
> 1 row in set (0.04 sec)
> 
> mysql> select * from emp where sal>2850;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 3 rows in set (0.00 sec)
> 
> mysql> select * from emp where sal>(select sal from emp where empname='blake');
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 3 rows in set (0.00 sec)
> 
> mysql> select max(sal) from emp where deptno=30;
> +----------+
> | max(sal) |
> +----------+
> |     2975 |
> +----------+
> 1 row in set (0.01 sec)
> 
> mysql> select * from emp where sal>2975;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from emp where sal>(select max(sal) from emp where deptno=30); 
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 2 rows in set (0.00 sec)
> 
> mysql> select job,sal from emp where empname='martin';
> +----------+------+
> | job      | sal  |
> +----------+------+
> | salesman | 1250 |
> +----------+------+
> 1 row in set (0.01 sec)
> 
> mysql> select * from emp where job='salesman' and sal=1250;
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 2 rows in set (0.02 sec)
> 
> mysql> select * from emp where job=(select job from emp where empname='martin') and sal=(select sal from emp where empname='martin');
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 2 rows in set (0.05 sec)
> 
> mysql> select * from emp where (job,sal) in(select job,sal from emp where empname='martin');
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 2 rows in set (0.11 sec)
> 
> mysql> select * from emp;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7369 | smith   | clark     | 7902 | 1980-12-17 |  800 | NULL |     20 |
> |  7499 | allen   | salesman  | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman  | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman  | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> |  7698 | blake   | manager   | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> |  7782 | clark   | manageer  | 7839 | 1980-06-17 | 2450 | NULL |     10 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 9 rows in set (0.00 sec)
> 
> mysql> select count(*) from emp group by mgr;
> +----------+
> | count(*) |
> +----------+
> |        1 |
> |        1 |
> |        3 |
> |        3 |
> |        1 |
> +----------+
> 5 rows in set (0.09 sec)
> ```

#### 3.自连接

> 自己连接自己
>
> ```shell
> mysql> select * from emp e1,emp e2 where e1.sal=e2.sal;
> 
> mysql> select * from emp e1 natural join emp e2;
> +-------+---------+----------+------+------------+------+------+--------+
> | empno | empname | job      | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+----------+------+------------+------+------+--------+
> |  7499 | allen   | salesman | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7654 | martin  | salesman | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> +-------+---------+----------+------+------------+------+------+--------+
> 3 rows in set (0.00 sec)
> ```

> 补充：
>
> ​	1.DQL:select .....from
>
> ​	             where:设置条件【分组前】
>
> ​		     group by:分组
>
> ​		     having:设置条件【分组后】
>
> ​		     order by:排序【asc:升序，desc：降序】
>
> ​		      limit:分页查询
>
> ​		     like指定模糊条件，as/distinct用于控制字段，聚合函数用于对列进行计算
>
> ​	2.主键，外键和唯一约束
>
> ​			主键：是一个表中的唯一标识，字段的值不能为null
>
> ​	                外键：在表中唯一和其他表进行关联的字段，起到约束作用，作用：多表联合查询
>
> ​	     		唯一约束：在一个表中可以有多个，并且设置了唯一约束的字段的值可以为null
>
> ​	3.索引
>
> ​		优点：
>
> ​			a.在进行分页查询的时候 ，可以通过索引控制需要获取的数据范围
>
> ​			 b.可以提高查询效率
>
> ​	        缺点：
>
> ​			a.维护索引需要耗费时间，并且随着数据量的增大所耗费的时间也会增加
>
> ​			b.索引也需要占用空间，如果有大量的索引，占用的空间也会随着增大
>
> ​			c.当对数据表中的索引进行创建，删除以及修改时，会耗费精力，索引也需要进行动态的维护

### 三、数据库的备份和恢复

#### 1.备份

> 生成sql脚本，导出数据
>
> 命令：mysqldump   -u 用户名 -p   数据库名>生成的脚本文件路径
>
> ​	   mysqldump   -u用户名    -p密码   数据库名>生成的脚本文件路径
>
> ```shell
> mysql> exit
> Bye
> rock@rockrong:~$ mysqldump -uroot -pabc123 mydb1>/home/rock/Desktop/mydb1.sql
> mysqldump: [Warning] Using a password on the command line interface can be insecure.
> rock@rockrong:~$ cd Desktop/
> rock@rockrong:~/Desktop$ ls
> mydb1.sql  shellPro
> rock@rockrong:~/Desktop$ gedit mydb1.sql 
> ```

#### 2.恢复

> 执行sql脚本，恢复数据
>
> 执行sql脚本必须先登录数据库，然后进入指定数据库，才可以执行sql脚本
>
> 命令：source   sql文件的路径
>
> ```shell
> rock@rockrong:~$ mysql -uroot -pabc123
> mysql: [Warning] Using a password on the command line interface can be insecure.
> Welcome to the MySQL monitor.  Commands end with ; or \g.
> Your MySQL connection id is 7
> Server version: 5.7.27-0ubuntu0.16.04.1 (Ubuntu)
> 
> Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
> 
> Oracle is a registered trademark of Oracle Corporation and/or its
> affiliates. Other names may be trademarks of their respective
> owners.
> 
> Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
> 
> mysql> use mydb1;
> Reading table information for completion of table and column names
> You can turn off this feature to get a quicker startup with -A
> 
> Database changed
> mysql> drop table emp;
> Query OK, 0 rows affected (0.24 sec)
> 
> mysql> drop table student;
> Query OK, 0 rows affected (0.08 sec)
> 
> mysql> show tables;
> Empty set (0.00 sec)
> 
> mysql> source /home/rock/Desktop/mydb1.sql;
> Query OK, 0 rows affected (0.01 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.03 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.02 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected, 1 warning (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.12 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.01 sec)
> 
> Query OK, 9 rows affected (0.04 sec)
> Records: 9  Duplicates: 0  Warnings: 0
> 
> Query OK, 0 rows affected (0.01 sec)
> 
> Query OK, 0 rows affected (0.01 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.02 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.02 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 9 rows affected (0.00 sec)
> Records: 9  Duplicates: 0  Warnings: 0
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> 
> Query OK, 0 rows affected (0.00 sec)
> mysql> show tables;
> +-----------------+
> | Tables_in_mydb1 |
> +-----------------+
> | emp             |
> | student         |
> +-----------------+
> 2 rows in set (0.00 sec)
> 
> mysql> select * from emp;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7369 | smith   | clark     | 7902 | 1980-12-17 |  800 | NULL |     20 |
> |  7499 | allen   | salesman  | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman  | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman  | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> |  7698 | blake   | manager   | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> |  7782 | clark   | manageer  | 7839 | 1980-06-17 | 2450 | NULL |     10 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 9 rows in set (0.00 sec)
> 
> mysql> create database text charset utf8;
> Query OK, 1 row affected (0.04 sec)
> 
> mysql> use text;
> Database changed
> mysql> show tables;
> Empty set (0.00 sec)
> mysql> source /home/rock/Desktop/mydb1.sql;
> mysql> show tables;
> +----------------+
> | Tables_in_text |
> +----------------+
> | emp            |
> | student        |
> +----------------+
> 2 rows in set (0.00 sec)
> ```

### 四、常用内置函数

#### 1.时间

> now()
>
> ```shell
> mysql> select current_date();
> +----------------+
> | current_date() |
> +----------------+
> | 2019-08-28     |
> +----------------+
> 1 row in set (0.00 sec)
> 
> mysql> select current_time();
> +----------------+
> | current_time() |
> +----------------+
> | 14:37:21       |
> +----------------+
> 1 row in set (0.00 sec)
> 
> mysql> select current_timestamp();
> +---------------------+
> | current_timestamp() |
> +---------------------+
> | 2019-08-28 14:37:50 |
> +---------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select now();
> +---------------------+
> | now()               |
> +---------------------+
> | 2019-08-28 14:38:20 |
> +---------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select date(now());
> +-------------+
> | date(now()) |
> +-------------+
> | 2019-08-28  |
> +-------------+
> 1 row in set (0.04 sec)
> 
> mysql> select year(now());
> +-------------+
> | year(now()) |
> +-------------+
> |        2019 |
> +-------------+
> 1 row in set (0.00 sec)
> 
> mysql> select month(now());
> +--------------+
> | month(now()) |
> +--------------+
> |            8 |
> +--------------+
> 1 row in set (0.00 sec)
> 
> mysql> select day(now());
> +------------+
> | day(now()) |
> +------------+
> |         28 |
> +------------+
> 1 row in set (0.00 sec)
> 
> mysql> select addtime("14:39:10","1:1:1");
> +-----------------------------+
> | addtime("14:39:10","1:1:1") |
> +-----------------------------+
> | 15:40:11                    |
> +-----------------------------+
> 1 row in set (0.02 sec)
> 
> mysql> select date_add(now(),interval 1 year);
> +---------------------------------+
> | date_add(now(),interval 1 year) |
> +---------------------------------+
> | 2020-08-28 14:41:23             |
> +---------------------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select date_add(now(),interval -1 year);
> +----------------------------------+
> | date_add(now(),interval -1 year) |
> +----------------------------------+
> | 2018-08-28 14:41:43              |
> +----------------------------------+
> 1 row in set (0.05 sec)
> 
> mysql> select date_add(now(),interval -1 month);
> +-----------------------------------+
> | date_add(now(),interval -1 month) |
> +-----------------------------------+
> | 2019-07-28 14:41:54               |
> +-----------------------------------+
> 1 row in set (0.00 sec)
> ```

#### 2.字符串

> ```shell
> mysql> select charset('tom');
> +----------------+
> | charset('tom') |
> +----------------+
> | utf8           |
> +----------------+
> 1 row in set (0.00 sec)
> 
> mysql> select concat('hello','world');
> +-------------------------+
> | concat('hello','world') |
> +-------------------------+
> | helloworld              |
> +-------------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select * from emp;
> +-------+---------+-----------+------+------------+------+------+--------+
> | empno | empname | job       | mgr  | hiredate   | sal  | comm | deptno |
> +-------+---------+-----------+------+------------+------+------+--------+
> |  7369 | smith   | clark     | 7902 | 1980-12-17 |  800 | NULL |     20 |
> |  7499 | allen   | salesman  | 7698 | 1981-02-20 | 1600 |  300 |     30 |
> |  7521 | ward    | salesman  | 7698 | 1981-02-22 | 1250 |  500 |     30 |
> |  7566 | jones   | managen   | 7839 | 1981-04-02 | 2975 | NULL |     30 |
> |  7654 | martin  | salesman  | 7698 | 1981-09-28 | 1250 | 1400 |     30 |
> |  7698 | blake   | manager   | 7839 | 1981-05-01 | 2850 | NULL |     30 |
> |  7782 | clark   | manageer  | 7839 | 1980-06-17 | 2450 | NULL |     10 |
> |  7788 | scott   | analyst   | 7566 | 1987-02-20 | 3000 | NULL |     20 |
> |  7839 | king    | president | NULL | 1987-02-20 | 5000 | NULL |     10 |
> +-------+---------+-----------+------+------------+------+------+--------+
> 9 rows in set (0.00 sec)
> 
> mysql> select concat(ename,job) from emp;
> ERROR 1054 (42S22): Unknown column 'ename' in 'field list'
> mysql> select concat(empname,job) from emp;
> +---------------------+
> | concat(empname,job) |
> +---------------------+
> | smithclark          |
> | allensalesman       |
> | wardsalesman        |
> | jonesmanagen        |
> | martinsalesman      |
> | blakemanager        |
> | clarkmanageer       |
> | scottanalyst        |
> | kingpresident       |
> +---------------------+
> 9 rows in set (0.01 sec)
> 
> mysql> select instr("hello",'l');
> +--------------------+
> | instr("hello",'l') |
> +--------------------+
> |                  3 |
> +--------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select instr("hello",'a');
> +--------------------+
> | instr("hello",'a') |
> +--------------------+
> |                  0 |
> +--------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select instr("hello",'h');
> +--------------------+
> | instr("hello",'h') |
> +--------------------+
> |                  1 |
> +--------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select right("admin",2);
> +------------------+
> | right("admin",2) |
> +------------------+
> | in               |
> +------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select left("admin",2);
> +-----------------+
> | left("admin",2) |
> +-----------------+
> | ad              |
> +-----------------+
> 1 row in set (0.00 sec)
> 
> mysql> select replace('black','ack','ddddd');
> +--------------------------------+
> | replace('black','ack','ddddd') |
> +--------------------------------+
> | blddddd                        |
> +--------------------------------+
> 1 row in set (0.03 sec)
> 
> mysql> select strcmp('ab','ad');
> +-------------------+
> | strcmp('ab','ad') |
> +-------------------+
> |                -1 |
> +-------------------+
> 1 row in set (0.01 sec)
> 
> mysql> select strcmp('ad','ab');
> +-------------------+
> | strcmp('ad','ab') |
> +-------------------+
> |                 1 |
> +-------------------+
> 1 row in set (0.01 sec)
> 
> mysql> select strcmp('ad','ad');
> +-------------------+
> | strcmp('ad','ad') |
> +-------------------+
> |                 0 |
> +-------------------+
> 1 row in set (0.00 sec)
> 
> mysql> select length('fsdf');
> +----------------+
> | length('fsdf') |
> +----------------+
> |              4 |
> +----------------+
> 1 row in set (0.00 sec)
> 
> ```

#### 3.数学相关的函数

> abs():绝对值
>
> round(num,n),求四舍五入的值，n表示保留小数点后n位
>
> ceil/floor:向上或者向下取整
>
> ```shell
> mysql> select abs(-10);
> +----------+
> | abs(-10) |
> +----------+
> |       10 |
> +----------+
> 1 row in set (0.00 sec)
> 
> mysql> select round(1.3443,2);
> +-----------------+
> | round(1.3443,2) |
> +-----------------+
> |            1.34 |
> +-----------------+
> 1 row in set (0.03 sec)
> 
> mysql> select round(1.3453,2);
> +-----------------+
> | round(1.3453,2) |
> +-----------------+
> |            1.35 |
> +-----------------+
> 1 row in set (0.01 sec)
> 
> mysql> select ceil(1.8);
> +-----------+
> | ceil(1.8) |
> +-----------+
> |         2 |
> +-----------+
> 1 row in set (0.01 sec)
> 
> mysql> select floor(1.8);
> +------------+
> | floor(1.8) |
> +------------+
> |          1 |
> +------------+
> 1 row in set (0.00 sec)
> 
> mysql> 
> 
> ```

### 五、MySQL事务

1.DTL

> Database Transaction  Language，数据库事务语言
>
> begin:开启事务
>
> ​	在事务开启之前，所做的DML操作都可以取消
>
> rollback:回滚事务
>
> ​	在事务开启之后使用
>
> ​	在提交事务之前，可以取消事务开启之后所做的DML操作
>
> commit:提交事务
>
> ​	在事务开启之后使用
>
> ​	当事务开启之后，可以提交所有的DML操作
>
> ​	提交事务后，不能再回滚
>
> ​	如果事务开启后，执行DDL操作时会自动提交事务
>
> 事务：每个客户端连接操作相同数据时，锁定这条记录不让别的客户端连续去修改【在同一时间内只由一个客户端操作一条数据】，类似于Python中的多线程操作同一数据时的加锁操作
>
> 注意：在MySQL支持事务的数据库引擎是InnoDB

#### 2.事务的隔离级别

> 事务的隔离级别指的是两个事务之间修改同一个数据设置的间隔情况
>
> 【面试题】：事务的特征以及作用
>
> ACID:
>
> ​	A：Atomicity，原子性，或者称为不可分割性【一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间的某个环节，事务在执行的过程中发生错误，则会被回滚到之前的状态】
>
> ​	C:Consistency，一致性【在事务开始和事务结束以后，数据库的完整性没有被破坏】
>
> ​	I:Isolation,隔离性【数据库允许并发事务同时对其数据进行修改，但是隔离性可以保证不会将数据改乱】
>
> ​	D:Durability，持久性【事务处理结束之后，对数据的修改是永久的，，即使系统故障也不会丢失】

#### 3.使用

> ```shell
> mysql> create database testdb;
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> use testdb;
> Database changed
> mysql> create table test(id int(5));
> Query OK, 0 rows affected (0.03 sec)
> 
> mysql> begin;
> Query OK, 0 rows affected (0.00 sec)
> 
> mysql> insert into test value(5);
> Query OK, 1 row affected (0.01 sec)
> 
> mysql> insert into test value(6);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> +------+
> 2 rows in set (0.01 sec)
> 
> mysql> commit;
> Query OK, 0 rows affected (0.01 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> +------+
> 2 rows in set (0.00 sec)
> 
> mysql> begin;
> Query OK, 0 rows affected (0.00 sec)
> 
> mysql> insert into test value(7);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> |    7 |
> +------+
> 3 rows in set (0.00 sec)
> 
> mysql> rollback;
> Query OK, 0 rows affected (0.07 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> +------+
> 2 rows in set (0.00 sec)
> 
> mysql> commit;
> Query OK, 0 rows affected (0.00 sec)
> 
> mysql> insert into test value(8);
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> |    8 |
> +------+
> 3 rows in set (0.00 sec)
> 
> mysql> rollback;
> Query OK, 0 rows affected (0.00 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> |    8 |
> +------+
> 3 rows in set (0.00 sec)
> 
> mysql> begin;
> Query OK, 0 rows affected (0.00 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    5 |
> |    6 |
> +------+
> 2 rows in set (0.00 sec)
> 
> mysql> delete from test where id=5;
> Query OK, 1 row affected (0.00 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
> |    6 |
> +------+
> 1 row in set (0.00 sec)
> 
> mysql> rollback;
> Query OK, 0 rows affected (0.03 sec)
> 
> mysql> select * from test;
> +------+
> | id   |
> +------+
>  5 |
> |    6 |
> +------+
> 2 rows in set (0.00 sec)
> 
> mysql> commit;
> Query OK, 0 rows affected (0.00 sec)
> 
> mysql> 
> ```

### 六、MySQL与Python的交互

#### 1.概念

> 要完成MySQL和Python之间的交互，Python提供了一个第三方模块pymysql,
>
> pymysql是从Python连接到mysql数据库服务器接口，并包含了纯Pythonmysql客户端库

#### 2.安装pymysql

> pip install pymysql

#### 3.使用

##### 3.1连接数据库

> ```Python
> import pymysql
> 
> #1.连接数据库
> #参数：mysql服务器地址，数据库用户名，数据库密码，数据库名
> db = pymysql.connect('localhost','root','abc123','testdb')
> 
> print("连接成功....")
> 
> #2.获取一个游标
> cursor = db.cursor()
> 
> #3.执行sql语句：查询mysql的版本
> cursor.execute('select version()')
> 
> #4.获取游标中的一条语句
> data = cursor.fetchone()
> 
> print("数据库版本为：%s" % (data))
> 
> #5.关闭数据库
> db.close()
> 
> ```

##### 3.2创建数据表

> ```Python
> import pymysql
> 
> #1.连接数据库
> #参数：mysql服务器地址，用户名，密码，数据库名
> db = pymysql.connect('localhost','root','abc123','testdb')
> 
> print("连接成功....")
> 
> 
> #2.获取一个游标
> cursor = db.cursor()
> 
> #3.执行sql语句：创建数据表
> sql = """create table student(
> id int primary key auto_increment,
> name varchar(20) unique not null,
> age int default 18
> );
> """
> cursor.execute(sql)
> 
> print("create successful...")
> 
> 
> #4.关闭数据库
> db.close()
> ```

##### 3.3插入操作【增】

> ```Python
> import pymysql
> 
> #1.连接数据库
> #参数：mysql服务器地址，用户名，密码，数据库名
> db = pymysql.connect('localhost','root','abc123','testdb')
> 
> print("连接成功....")
> 
> 
> #2.获取一个游标
> cursor = db.cursor()
> 
> #3.执行sql语句：查询数据
> sql = """select * from student where age>15;
> """
> cursor.execute(sql)
> 
> #DQL查询，返回一个结果集【可迭代对象】
> #a.fetchone:只返回一条语句，类型为元组
> # result = cursor.fetchone()
> # print(result)
> # print(type(result))
> 
> #b.fetchall:查询所有,类型为二维元组
> # result = cursor.fetchall()
> # print(result)
> # print(type(result))
> 
> #c.fetchmany:查询一部分
> result = cursor.fetchmany(1)
> print(result)
> print(type(result))
> 
> print("insert successful...")
> 
> 
> #4.关闭数据库
> db.close()
> ```

##### 3.4读取操作【查】

> ```Python
> import pymysql
> 
> #1.连接数据库
> #参数：mysql服务器地址，用户名，密码，数据库名
> db = pymysql.connect('localhost','root','abc123','testdb')
> 
> print("连接成功....")
> 
> 
> #2.获取一个游标
> cursor = db.cursor()
> 
> #3.执行sql语句：查询数据
> sql = """select * from student where age>15;
> """
> cursor.execute(sql)
> 
> #DQL查询，返回一个结果集【可迭代对象】
> #a.fetchone:只返回一条语句，类型为元组
> # result = cursor.fetchone()
> # print(result)
> # print(type(result))
> 
> #b.fetchall:查询所有,类型为二维元组
> # result = cursor.fetchall()
> # print(result)
> # print(type(result))
> 
> #c.fetchmany:查询一部分
> result = cursor.fetchmany(1)
> print(result)
> print(type(result))
> 
> print("insert successful...")
> 
> 
> #4.关闭数据库
> db.close()
> ```

##### 3.5更新操作【改】

> ```Python
> import pymysql
> 
> #1.连接数据库
> #参数：mysql服务器地址，用户名，密码，数据库名
> db = pymysql.connect('localhost','root','abc123','testdb')
> 
> print("连接成功....")
> 
> 
> #2.获取一个游标
> cursor = db.cursor()
> 
> #3.执行sql语句：更新数据
> sql = """
> update student set age=age+1  where name like '%a%';
> """
> 
> try:
>  cursor.execute(sql)
>  #提交事务
>  db.commit()
> except:
>  #回滚
>  db.rollback()
> 
> print("insert successful...")
> 
> 
> #4.关闭数据库
> db.close()
> 
> ```

##### 3.6删除操作【删】

> ```Python
> import pymysql
> 
> #1.连接数据库
> #参数：mysql服务器地址，用户名，密码，数据库名
> db = pymysql.connect('localhost','root','abc123','testdb')
> 
> print("连接成功....")
> 
> 
> #2.获取一个游标
> cursor = db.cursor()
> 
> #3.执行sql语句：删除数据
> sql = """
> delete from student where age between 15 and 20;
> """
> 
> try:
>  cursor.execute(sql)
>  #提交事务
>  db.commit()
> except:
>  #回滚
>  db.rollback()
> 
> print("delete successful...")
> 
> 
> #4.关闭数据库
> db.close()
> 
> ```

#### 4.封装工具类

> ```Python
> import  pymysql
> 
> class DBHelper(object):
>  
>  def __init__(self,host,user,passwd,dbname):
>      self.host = host
>      self.user = user
>      self.passwd = passwd
>      self.dbname = dbname
>  
>  #行为
>  #连接数据库
>  def connect(self):
>      self.db = pymysql.connect(self.host,self.user,self.passwd,self.dbname)
>      
>      self.cursor = self.db.cursor()
>      
>  #查询
>  def get_one(self,sql):
>      try:
>          self.connect()
>          self.cursor.execute(sql)
>          result = self.cursor.fetchone()
>          self.db.close()
>      except:
>          print("查询失败")
>          
>      return result
> 
>  def get_all(self, sql):
>      try:
>          self.connect()
>          self.cursor.execute(sql)
>          result = self.cursor.fetchall()
>          self.db.close()
>      except:
>          print("查询失败")
> 
>      return result
>  
>  #DML:插入，更改，删除
>  def insert(self,sql):
>      self.dml()
>  def update(self,sql):
>      self.dml()
>  def delete(self,sql):
>      self.dml()
>  
>  def dml(self,sql):
>      try:
>          self.connect()
>          self.cursor.execute(sql)
>          self.db.commit()
>          self.db.close()
>      except:
>          print("事务提交失败")
>          self.db.rollback()
> ```

# Day4 MangoDB

上堂回顾

> 默写题目
>
> 使用pymysql实现下面操作，已知user表在testdb数据库下
>
> ​	1.向user表中插入一条数据， name:abc  age:10
>
> ​	2.删除user表中年龄在10~20之间的人的信息

### 一、MongoDB简介

#### 1.概述

> ​	MongoDB是一个基于分布式文件存储的数据库，由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。
>
> ​	MongoDB介于关系型数据库和非关系型数据库之间【在非关系型数据库中功能相对比较丰富，功能最像关系型数据库】，数据的格式类似于json，因此可以存储比较复杂的数据类型
>
> ​	MongoDB将数据存储为一个文档，数据结构由key:value的方式存储
>
> ```shell
> {
> name:'jack',     #field:value
> age:19,
> groups:['news','games']
> }
> ```

#### 2.MongoDB和MySQL之间的区别【面试题】

##### 2.1MySQL

> 关系型数据库
>
> 查询语句是使用传统的sql语句，拥有成熟的体系
>
> 关系型数据库遵循ACID原则
>
> 缺点：在处理海量数据的时候，效率会显著变慢

##### 2.2MongoDB

> 非关系型数据库【nosql】,属于文档型数据库【可以存放xml或者json等类型数据的数据库】
>
> 数据结构由键值对组成
>
> 查询语句采用独特的MongoDB的语法
>
> 优势：
>
> ​	数据读写速度非常快，高扩展，json的存储格式

##### 2.3二者之间的区别

> | MySQL       | MongoDB     | 解释            |
> | ----------- | ----------- | --------------- |
> | database    | database    | 数据库          |
> | table       | collection  | 数据表/集合     |
> | row         | document    | 数据记录行/文档 |
> | column      | filed       | 数据字段列/字段 |
> | t1 join  t1 | 不支持      | 表连接          |
> | primary key | primary key | 主键            |
> |             |             |                 |

#### 3.使用场景

> - 网站数据
>   - Mongo 非常适合实时的插入，更新与查询，并具备网站实时数据存储所需的复制及高度伸缩性
> - 缓存
>   - 由于性能很高，Mongo 也适合作为信息基础设施的缓存层。
>   - 在系统重启之后，由Mongo 搭建的持久化缓存层可以避免下层的数据源过载
> - 对象及JSON 数据的存储
>   ​	Mongo 的BSON 数据格式非常适合文档化格式的存储及查询
> - 高伸缩性的场景
>   - Mongo 非常适合由数十或数百台服务器组成的数据库，
> - Mongo 的路线图中已经包含对MapReduce 引擎的内置支持。
>
> **【扩展】不合适应用mongodb的场景**
>
> - 高度事务性的系统：例如，银行或会计系统
> - 传统的商业智能应用：针对特定问题的BI 数据库会产生高度优化的查询方式
> - 需要SQL 的问题

### 二、MongoDB安装和卸载

#### 1.卸载

> ```mysql
> 执行命令：
> sudo apt-get autoremove mongodb
> sudo apt-get autoclean mongodb
> sudo apt-get --purge remove mongodb mongodb-clients mongodb-server
> 
> #清除残留数据
> dpkg -l |grep ^rc|awk '{print $2}' |tr ["\n"] [" "]|sudo xargs dpkg -P 
> ```

#### 2.安装

> ##### 第1步 – 导入公钥**
>
> Ubuntu软件包管理器apt（高级软件包工具）需要软件分销商的GPG密钥来确保软件包的一致性和真实性。 执行此下面的命令将MongoDB密钥导入到您的服务器：
>
> sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
>
> **第2步 – 创建源列表文件MongoDB**
>
> 检查URL http://repo.mongodb.org/apt/ubuntu/dists/。 如果您在该网页上看到一个目录“bionic”，则将下述命令中的单词“xenial”替换为“bionic”一词，【原因：MongoDB尚未发布Bionic Beaver软件包，但Xenial软件包在Ubuntu 18.04 LTS上运行良好】
>
> 执行以下命令在/etc/apt/sources.list.d/中创建一个MongoDB列表文件：
>
> echo "deb http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.6 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list
>
> **第3步 – 更新存储库**
>
> 使用apt命令更新存储库：
>
> sudo apt-get update
>
> 说明：执行完会提示一些失败，不用在意
>
> **第4步 – 安装MongoDB**
>
> 执行以下命令来安装MongoDB：
>
> sudo apt-get install -y mongodb
>
> ##### 第5步：启动MongoDB
>
> 执行以下命令启动MongoDB并将其添加为在启动时启动的服务
>
> systemctl start mongodb
>
> ```
> 如果执行完这一步终端没有任何输出，则说明是正确的
> 如果启动的时候提示：Failed to start mongod.service: Unit mongodb.service not found.
> 解决办法如下：
> 	1创建配置文件：
> 		在/etc/systemd/system/下
> 		sudo vim mongodb.service
> 
> 	2.在里面追加文本：
> 		[Unit]
> 		Description=High-performance, schema-free document-oriented database
> 		After=network.target
> 
> 		[Service]
> 		User=mongodb
> 		ExecStart=/usr/bin/mongod --quiet --config /etc/mongodb.conf
> 
> 		[Install]
> 		WantedBy=multi-user.target
> 	3.按ctrl+X退出
> 	4.启动服务
> 		sudo systemctl start mongodb
> 		sudo systemctl status mongodb
> 	5.让它永久启动
> 		sudo systemctl enable mongodb
> ```
>
> ##### 第6步：检查MongoDB是否已经启动在27017端口号上
>
> 执行下面的命令：
>
> netstat -plntu
>
> ##### 第7步：登录MongoDB
>
> mongo		
>
> ```
> 如果出现错误全局初始化失败：BadValue无效或无用户区域设置。 请确保LANG和/或LC_ *环境变量设置正确，请尝试命令：
> 	export LC_ALL=C
> 	mongo
> ```
>
> 补充：ubuntu下如何查看软件安装目录以及安装版本
>
> ```mysql
> 1.查询版本
> aptitude show 软件名  或者 dpkg -l软件名
> 2.查询安装路径
> dpkg -L 软件名  或者 whereis 软件名
> ```

#### 3.启动和停止服务

> service  mongodb start:开启服务
>
> service  mongodb stop:开启服务
>
> service  mongodb restart:开启服务

### 三、MongoDB使用

> mongodb的三个重要概念：文档，集合和数据库
>
> a.文档
>
> ​	文档是mongodb中的基本单位，类似于mysql中的行【比行复杂】
>
> ​	多个键及其关联的值有序的放在一起构成了文档【document】,同Python中的字典类似，如：{"name":"abc","age":10}
>
> ​	支持字符类型，整型，浮点型，布尔型等数据类型，注意：文档中的键值是有序的，如：{"name":"abc","age":10}和{"age":10,"name":"abc"}并非一个 文档，属于两个文档
>
> b.集合
>
> ​	集合就是一组文档，类似于mysql中的数据表
>
> ​	集合中的文档可以是各种各样的【可以存放任何类型的文档】
>
> ​	为了方便查询可以将结构相同的文档放到同一个集合中，如：某业务功能，分user集合和权限集合等，mongodb推荐使用以命名空间的方式命名子集合，如：login.user和login.role,login.就是一个命名空间
>
> c.数据库
>
> ​	由多个集合组成数据库，一个mongodb实例可以承载多个数据库
>
> ​	每个数据库都是独立的，有独立的权限控制，在磁盘文件中，不同的数据库被存放在不同的文件中
>
> mysql:行------》数据表-------》数据库
>
> mongodb:文档------》集合------》数据库	
>
> 注意：mongodb中已经存在的系统数据库
>
> ​	a.admin数据库
>
> ​		权限数据库，如果创建用户的时候将该用户添加到admin数据库中，那么该用户将自动继承访问所有数据库的权限
>
> ​	b.local数据库
>
> ​		数据库永远不会被同步到其他节点
>
> ​		可以用来存储本地服务器中的任意集合
>
> ​	c.config数据库	
>
> ​		用于系统的配置信息

#### 1.创建和删除数据库

##### 1.1创建数据库

> 语法：
>
> ```shell
> use DATABASE_NAME
> #注意：如果指定的数据库DATABASE_NAME不存在，则该命令将创建一个新的数据库，否则返回现有的数据库
> ```
>
> 数据库也通过名字来标识。数据库名可以是满足以下条件的任意UTF-8字符串。
>
> ​	a.不能是空字符串（"")。
>
> ​	b.不得含有' '（空格)、.、$、/、\和\0 (空字符)。
>
> ​	c.应全部小写。
>
> ​	d.最多64字节
>
> ​	e.有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库
>
> ```shell
> #1.db:查看当前正在工作的数据库，【select database();】
> 
> #2.show dbs:查看所有的数据库列表【show databases;】
> #注意：要显示数据库，需要至少插入一个文档，，空的数据库在数据库列表中是不会显示的
> 
> #3.db.集合名称.insert(文档)，在当前的数据库下，插入文档的同时，会生成一个集合，注意：mongo中有一个默认的数据库：test,当首次登陆mongo，如果没有创建任何的数据库，则集合或者文档都默认存储在test中
> 
> #4.db.help():查看mongodb中的所有的命令，db属于关键字
> 
> rock@rockrong:~$ mongo
> MongoDB shell version: 2.6.10
> connecting to: test
> Welcome to the MongoDB shell.
> For interactive help, type "help".
> For more comprehensive documentation, see
> 	http://docs.mongodb.org/
> Questions? Try the support group
> 	http://groups.google.com/group/mongodb-user
> > use db
> switched to db db
> > db
> db
> > show dbs;
> admin  (empty)
> local  0.078GB
> > use mydb1
> switched to db mydb1
> > db
> mydb1
> > show dbs
> admin  (empty)
> local  0.078GB
> > db.items.insert({"name":"zhangsan"})
> WriteResult({ "nInserted" : 1 })
> > show dbs
> admin  (empty)
> local  0.078GB
> mydb1  0.078GB
> > db.help()
> DB methods:
> 	db.adminCommand(nameOrDocument) - switches to 'admin' db, and runs command [ just calls db.runCommand(...) ]
> 	db.auth(username, password)
> 	db.cloneDatabase(fromhost)
> 	db.commandHelp(name) returns the help for the command
> 	db.copyDatabase(fromdb, todb, fromhost)
> 	db.createCollection(name, { size : ..., capped : ..., max : ... } )
> 	db.createUser(userDocument)
> 	db.currentOp() displays currently executing operations in the db
> 	db.dropDatabase()
> 	db.eval(func, args) run code server-side
> 	db.fsyncLock() flush data to disk and lock server for backups
> 	db.fsyncUnlock() unlocks server following a db.fsyncLock()
> 	db.getCollection(cname) same as db['cname'] or db.cname
> 	db.getCollectionInfos()
> 	db.getCollectionNames()
> 	db.getLastError() - just returns the err msg string
> 	db.getLastErrorObj() - return full status object
> 	db.getMongo() get the server connection object
> 	db.getMongo().setSlaveOk() allow queries on a replication slave server
> 	db.getName()
> 	db.getPrevError()
> 	db.getProfilingLevel() - deprecated
> 	db.getProfilingStatus() - returns if profiling is on and slow threshold
> 	db.getReplicationInfo()
> 	db.getSiblingDB(name) get the db at the same server as this one
> 	db.getWriteConcern() - returns the write concern used for any operations on this db, inherited from server object if set
> 	db.hostInfo() get details about the server's host
> 	db.isMaster() check replica primary status
> 	db.killOp(opid) kills the current operation in the db
> 	db.listCommands() lists all the db commands
> 	db.loadServerScripts() loads all the scripts in db.system.js
> 	db.logout()
> 	db.printCollectionStats()
> 	db.printReplicationInfo()
> 	db.printShardingStatus()
> 	db.printSlaveReplicationInfo()
> 	db.dropUser(username)
> 	db.repairDatabase()
> 	db.resetError()
> 	db.runCommand(cmdObj) run a database command.  if cmdObj is a string, turns it into { cmdObj : 1 }
> 	db.serverStatus()
> 	db.setProfilingLevel(level,<slowms>) 0=off 1=slow 2=all
> 	db.setWriteConcern( <write concern doc> ) - sets the write concern for writes to the db
> 	db.unsetWriteConcern( <write concern doc> ) - unsets the write concern for writes to the db
> 	db.setVerboseShell(flag) display extra information in shell output
> 	db.shutdownServer()
> 	db.stats()
> 	db.version() current version of the server
> ```

##### 1.2删除数据库

> 语法：
>
> ```shell
> db.dropDatabase()：区别于mysql，删除数据库不需要指明数据库的名称，默认删除当前正在使用的数据库
> 
> #注意：如果没有选择任何数据库，则默认删除test
> 
> > show dbs
> admin  (empty)
> local  0.078GB
> mydb1  0.078GB
> > db
> mydb1
> > db.dropDatabase()
> { "dropped" : "mydb1", "ok" : 1 }
> > show dbs
> admin  (empty)
> local  0.078GB
> > db
> mydb1
> > 
> ```
>
> 

#### 2.创建和删除集合

> 注意：集合存在于数据库中，集合没有固定的结构，意味着你对集合可以插入不同格式和不同类型的数据，一般情况下，插入集合的数据是由关联性【一致性】
>
> 集合名的注意事项：
>
> - 集合名不能是空字符串""。
> - 集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。
> - 集合名不能以"system."开头，这是为系统集合保留的前缀。
> - 用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。

##### 2.1创建集合

> 语法：
>
> ```shell
> db.createCollection(name, options)  #创建集合，类似于mysql的create table  表名（字段 类型....）
> 
> #name的类型为string类型，是要创建的集合的名称
> #options的类型是一个文档，是可选的
> 
> ```
>
> 下面是可以使用的选项列表：
>
> 在插入文档时，MongoDB首先检查上限集合`capped`字段的大小，然后检查`max`字段。
>
> | 字段          | 类型      | 描述                                                         |
> | ------------- | --------- | ------------------------------------------------------------ |
> | `capped`      | `Boolean` | (可选)如果为`true`，则启用封闭的集合。上限集合是固定大小的集合，它在达到其最大大小时自动覆盖其最旧的条目。 如果指定`true`，则还需要指定`size`参数。 |
> | `autoIndexId` | `Boolean` | (可选)如果为`true`，则在`_id`字段上自动创建索引。默认值为`false`。 |
> | `size`        | 数字      | (可选)指定上限集合的最大大小(以字节为单位)。 如果`capped`为`true`，那么还需要指定此字段的值。 |
> | `max`         | 数字      | (可选)指定上限集合中允许的最大文档数。                       |

> a.options被省略
>
> ```shell
> > use db        #如果数据库存在，则切换
> switched to db db
> > db.createCollection("myCol")      #创建一个名为myCol的集合
> { "ok" : 1 }
> > show collections  #查看当前数据库下的所有的集合列表，类似于show tables
> myCol
> 
> ```
>
> a.options不省略
>
> ```shell
> > db.createCollection("mycol2",{capped:true,size:100000,autoIndexId:true,max:1000})
> { "ok" : 1 }
> > show collections
> myCol
> mycol2
> 
> #{capped:true,size:100000,autoIndexId:true,max:1000})中的键值对不是必须的，都是可选的，根据具体的需求决定选择使用哪个选项，使用较多的是autoIndexId和max
> 
> ```
>
> c.不需要直接创建集合，向一个不存在的集合中插入文档，该集合会被自动创建
>
> ```shell
> > db.newCol.insert({"name":"aaa"})
> WriteResult({ "nInserted" : 1 })
> > show collections
> myCol
> mycol2
> newCol
> 
> ```

##### 2.2删除集合

> 语法：
>
> ```shell
> db.COLLECTION_NAME.drop()
> 
> 注意：如果选定的集合成功删除，drop()方法将返回true，否则返回false
> 
> > show collections
> myCol
> mycol2
> newCol
> system.indexes
> > db.mycol2.drop()     #mysql中的drop  table  表名
> true
> > show collections
> myCol
> newCol
> 
> ```

#### 3.文档操作

> 文档是一组键值对，MongoDB不要设置相同的字段，并且相同的字段不需要相同的数据类型，这和关系型数据库有很大的区别
>
> ```
> mysql:数据库mybd1,数据表user
> insert into user value("abc",19,"female","dance")
> insert into user value("aaa",10,"male","sing")
> 
> mongodb:数据库mybd1,集合user
> db.user.insert({"name":"abc","age":19,"gender":"female","hobby":"dance"})
> db.user.insert({"num":10,"score":100,"height":172.0})
> 
> ```
>
> 注意：
>
> ​	a.文档中的键值是有序的
>
> ​	b.文档中的值可以是字符串，也可以是数字，布尔，数组等
>
> ​	c.区分类型和大小写
>
> ​	d.不能出现重复的键
>
> ​	e.键一般都是字符串
>
> 文档键命名规范：
>
> - 键不能含有\0 (空字符)。这个字符用来表示键的结尾。
> - .和$有特别的意义，只有在特定环境下才能使用。
> - 以下划线"_"开头的键是保留的(不是严格要求的)。

##### 3.1插入文档

> 语法：
>
> ```shell
> db.COLLECTION_NAME.insert(document)
> 
> > db.myCol.insert({
> ... "id":101,
> ... 'name':'zhangsan',
> ... 'age':19,
> ... 'score':99
> ... })
> WriteResult({ "nInserted" : 1 })
> > db.myCol.find()
> { "_id" : ObjectId("5d674cf81738dd1b927a5ea5"), "id" : 101, "name" : "zhangsan", "age" : 19, "score" : 99 }
> > db.newCol.insert({"_id":101,"name":'aaa'})
> WriteResult({ "nInserted" : 1 })
> > db.newCol.find()
> { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "aaa" }
> { "_id" : 101, "name" : "aaa" }
> > 
> 
> #注意：如果插入的字段中没有_id，则在文档中会默认添加一个_id,该键的值是当前文档的唯一标识，但是，如果自定义了_id，给定的值会覆盖默认的值
> 
> 
> > db.myCol.find()
> { "_id" : ObjectId("5d674cf81738dd1b927a5ea5"), "id" : 101, "name" : "zhangsan", "age" : 19, "score" : 99 }
> > db.newCol.insert({"_id":101,"name":'aaa'})
> WriteResult({ "nInserted" : 1 })
> > db.newCol.find()
> { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "aaa" }
> { "_id" : 101, "name" : "aaa" }
> > db.newCol.insert({
> ... '_id':102,
> ... 'name':'abc',
> ... 'hobby':'dance'
> ... },
> ... {
> ... '_id':103,
> ... 'name':'jack',
> ... 'hobby':'sing'
> ... })
> WriteResult({ "nInserted" : 1 })
> > db.newCol.find()
> { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "aaa" }
> { "_id" : 101, "name" : "aaa" }
> { "_id" : 102, "name" : "abc", "hobby" : "dance" }
> 
> ```
>
> 注意：在插入的文档中，如果不指定_id参数，那么 MongoDB 会为此文档分配一个唯一的ObjectId
>
> _id为集合中的每个文档唯一的12个字节的十六进制数。 12字节划分如下 
>
> ```mysql
> _id: ObjectId(4 bytes timestamp, 3 bytes machine id, 2 bytes process id, 
>    3 bytes incrementer)
> 
> ```
>
> ##### 其它插入文档的方法【作为了解】
>
> db.collection.insertOne():插入单个文档
>
> db.collection.insertMany()：插入多个文档
>
> a.db.collection.insertOne()方法
>
> db.collection.insertOne()`方法将单个文档插入到集合中。 如果文档没有指定`_id`字段，MongoDB会自动将`_id`字段与`ObjectId`值添加到新文档
>
> 演示：
>
> ```mysql
> #以下示例将新文档插入到库存集合中
> db.invent.insertOne({ 
>        item: "canvas", 
>        num: 100, 
>        tags: ["cotton"], 
>        size: { 
>             h: 20,
>             w: 30, 
>         } 
> })
> 
> 
> #db.collection.insertOne()方法返回包含新插入的文档的`_id```字段值的文档
> 
> 执行结果如下：
> > db.inventory.insertOne(
> ...    { item: "canvas", qty: 100, tags: ["cotton"], size: { h: 28, w: 35.5, uom: "cm" } }
> ... )
> {
>         "acknowledged" : true,
>         "insertedId" : ObjectId("5955220846be576f199feb55")
> }
> >
> 
> ```
>
> b.db.collection.insertMany()方法
>
> db.collection.insertMany()`方法将多个文档插入到集合中，可将一系列文档传递给`db.collection.insertMany()`方法。以下示例将三个新文档插入到库存集合中。如果文档没有指定`_id`字段，MongoDB会向每个文档添加一个ObjectId值的`_id`字段
>
> 演示：
>
> ```mysql
> db.inventory.insertMany([
>    { item: "journal", qty: 25, tags: ["blank", "red"], size: { h: 14, w: 21, uom: "cm" } },
>    { item: "mat", qty: 85, tags: ["gray"], size: { h: 27.9, w: 35.5, uom: "cm" } },
>    { item: "mousepad", qty: 25, tags: ["gel", "blue"], size: { h: 19, w: 22.85, uom: "cm" } }
> ])
> 
> #insertMany()返回包含新插入的文档_id字段值的文档。执行结果如下：
> > db.inventory.insertMany([
> ...    { item: "journal", qty: 25, tags: ["blank", "red"], size: { h: 14, w: 21, uom: "cm" } },
> ...    { item: "mat", qty: 85, tags: ["gray"], size: { h: 27.9, w: 35.5, uom: "cm" } },
> ...    { item: "mousepad", qty: 25, tags: ["gel", "blue"], size: { h: 19, w: 22.85, uom: "cm" } }
> ... ])
> {
>         "acknowledged" : true,
>         "insertedIds" : [
>                 ObjectId("59552c1c46be576f199feb56"),
>                 ObjectId("59552c1c46be576f199feb57"),
>                 ObjectId("59552c1c46be576f199feb58")
>         ]
> }
> 
> ```

##### 3.2查询文档

> 语法：
>
> ```
> db.COLLECTION_NAME.find(document)
> 
> ```
>
> - db.youCollection.find(criteria, filterDisplay) 
>
>   - criteria ：查询条件，可选 
>   - filterDisplay：筛选显示部分数据， 显示指定列数据
>
> - db.集合名.find()：  查询所有记录。
>
> - db.集合名.find().pretty() 查询所有记录，并友好地显示出来， pretty() 是以格式化方式显示文档信息。
>
> - db.集合名.find({},{name:1, age:1})       select name,age from xxxx
>
>   - 1：要显示的key【显示】
>   - 0:  不要显示的key【隐藏】
>
>   显示所有记录的name和age
>
> - db.集合名.find({name: 'zhangsan'})   查看集合中name为zhangsan的文档
>
> - db.集合名.find({name:'zhangsan', age:20})   查看集合中name为zhangsan同时age为20的文档
>
> - db.集合名.find({$or: [{age: 22}, {age: 25}]})
>
> - db.集合名.find({"age":{$gt: 20}}) 查询age > 20的记录
>
>   - $lt 小于 <
>   - \$lte 小于等于 <=
>   - $gt 大于 >
>   - \$gte 大于等于 >=
>   - \$ne 不等于 !=
>
> - db.集合名.find({age : {$lt :30, $gt : 20}})  查找 age 在 (20, 30)之间的纪录
>
> - db.集合名.find({_id:{$in: [1,3,5]}})  显示id为1,3和5的文档记录
>
> - db.集合名.find({name: {$regex: "y"}}) 查询 name的key中包含 y字符的所有文档记录
>
> - db.集合.find().sort({age:1}) 查找所有，并按age升序排列， 1 升序， -1 降序
>
> ```shell
> 演示命令：
> db.user.find()
> db.user.find().pretty()
> db.user.find({},{'name':1})
> db.user.find({'score':80})
> db.user.find({'age':{$lt:20}})
> db.user.find({$or:[{'score':80},{'age':{$lt:20}}]})     #or
> db.user.find({'score':80,'age':{$lt:20}})     #and
> db.user.find({'age':{$in:[8,10,18]}})    #in
> 
> db.user.find().sort({'age':1})
> db.user.find().sort({'score':-1})
> db.user.find().sort({'score':1,'age':-1})    #排序
> 
> > use mydb2
> switched to db mydb2
> > db
> mydb2
> > db.createCollection('user')
> { "ok" : 1 }
> > show collections
> system.indexes
> user
> > db.user.insert({'name':'abc','age':18,"score":90})
> WriteResult({ "nInserted" : 1 })
> > db.user.insert({'name':'abc','age':35,"score":60})
> WriteResult({ "nInserted" : 1 })
> > db.user.insert({'name':'jack','age':10,"score":77})
> WriteResult({ "nInserted" : 1 })
> > db.user.insert({'name':'lisi','age':14,"score":80})
> WriteResult({ "nInserted" : 1 })
> > db.user.insert({'name':'wangwu','age':20,"score":66})
> WriteResult({ "nInserted" : 1 })
> > db.user.insert({'name':'aaaa','age':33,"score":66})
> WriteResult({ "nInserted" : 1 })
> > db.user.insert({'name':'bbbb','age':8,"score":80})
> WriteResult({ "nInserted" : 1 })
> > db.user.find()
> { "_id" : ObjectId("5d6775c51738dd1b927a5ea6"), "name" : "abc", "age" : 18, "score" : 90 }
> { "_id" : ObjectId("5d6775d01738dd1b927a5ea7"), "name" : "abc", "age" : 35, "score" : 60 }
> { "_id" : ObjectId("5d6775e01738dd1b927a5ea8"), "name" : "jack", "age" : 10, "score" : 77 }
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi", "age" : 14, "score" : 80 }
> { "_id" : ObjectId("5d6775f91738dd1b927a5eaa"), "name" : "wangwu", "age" : 20, "score" : 66 }
> { "_id" : ObjectId("5d6776091738dd1b927a5eab"), "name" : "aaaa", "age" : 33, "score" : 66 }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb", "age" : 8, "score" : 80 }
> > db.user.find().pretty()
> {
> 	"_id" : ObjectId("5d6775c51738dd1b927a5ea6"),
> 	"name" : "abc",
> 	"age" : 18,
> 	"score" : 90
> }
> {
> 	"_id" : ObjectId("5d6775d01738dd1b927a5ea7"),
> 	"name" : "abc",
> 	"age" : 35,
> 	"score" : 60
> }
> {
> 	"_id" : ObjectId("5d6775e01738dd1b927a5ea8"),
> 	"name" : "jack",
> 	"age" : 10,
> 	"score" : 77
> }
> {
> 	"_id" : ObjectId("5d6775ea1738dd1b927a5ea9"),
> 	"name" : "lisi",
> 	"age" : 14,
> 	"score" : 80
> }
> {
> 	"_id" : ObjectId("5d6775f91738dd1b927a5eaa"),
> 	"name" : "wangwu",
> 	"age" : 20,
> 	"score" : 66
> }
> {
> 	"_id" : ObjectId("5d6776091738dd1b927a5eab"),
> 	"name" : "aaaa",
> 	"age" : 33,
> 	"score" : 66
> }
> {
> 	"_id" : ObjectId("5d67761b1738dd1b927a5eac"),
> 	"name" : "bbbb",
> 	"age" : 8,
> 	"score" : 80
> }
> > db.user.find()
> { "_id" : ObjectId("5d6775c51738dd1b927a5ea6"), "name" : "abc", "age" : 18, "score" : 90 }
> { "_id" : ObjectId("5d6775d01738dd1b927a5ea7"), "name" : "abc", "age" : 35, "score" : 60 }
> { "_id" : ObjectId("5d6775e01738dd1b927a5ea8"), "name" : "jack", "age" : 10, "score" : 77 }
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi", "age" : 14, "score" : 80 }
> { "_id" : ObjectId("5d6775f91738dd1b927a5eaa"), "name" : "wangwu", "age" : 20, "score" : 66 }
> { "_id" : ObjectId("5d6776091738dd1b927a5eab"), "name" : "aaaa", "age" : 33, "score" : 66 }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb", "age" : 8, "score" : 80 }
> > db.user.find({},{'name':1})
> { "_id" : ObjectId("5d6775c51738dd1b927a5ea6"), "name" : "abc" }
> { "_id" : ObjectId("5d6775d01738dd1b927a5ea7"), "name" : "abc" }
> { "_id" : ObjectId("5d6775e01738dd1b927a5ea8"), "name" : "jack" }
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi" }
> { "_id" : ObjectId("5d6775f91738dd1b927a5eaa"), "name" : "wangwu" }
> { "_id" : ObjectId("5d6776091738dd1b927a5eab"), "name" : "aaaa" }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb" }
> > db.user.find({'score':80})
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi", "age" : 14, "score" : 80 }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb", "age" : 8, "score" : 80 }
> > db.user.find({'age':{$lt:20}})
> { "_id" : ObjectId("5d6775c51738dd1b927a5ea6"), "name" : "abc", "age" : 18, "score" : 90 }
> { "_id" : ObjectId("5d6775e01738dd1b927a5ea8"), "name" : "jack", "age" : 10, "score" : 77 }
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi", "age" : 14, "score" : 80 }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb", "age" : 8, "score" : 80 }
> > db.user.find({$or:[{'score':80},{'age':{$lt:20}}]})
> { "_id" : ObjectId("5d6775c51738dd1b927a5ea6"), "name" : "abc", "age" : 18, "score" : 90 }
> { "_id" : ObjectId("5d6775e01738dd1b927a5ea8"), "name" : "jack", "age" : 10, "score" : 77 }
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi", "age" : 14, "score" : 80 }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb", "age" : 8, "score" : 80 }
> > db.user.find({'score':80,'age':{$lt:20}})
> { "_id" : ObjectId("5d6775ea1738dd1b927a5ea9"), "name" : "lisi", "age" : 14, "score" : 80 }
> { "_id" : ObjectId("5d67761b1738dd1b927a5eac"), "name" : "bbbb", "age" : 8, "score" : 80 }
> 
> ```
>
> 
>
> ##### MongoDB 与 RDBMS的等效MySQL子句
>
> 要在一些条件的基础上查询文档，可以使用以下操作:
>
> | 相等     | `{<key>:<value>}`        | `db.mycol.find({"by":"yiibai"}).pretty()`     | `where by = 'yiibai'` |
> | -------- | ------------------------ | --------------------------------------------- | --------------------- |
> | 操作     | 语法                     | 示例                                          | MySQL等效语句         |
> | 小于     | `{<key>:{$lt:<value>}}`  | `db.mycol.find({"likes":{$lt:50}}).pretty()`  | `where likes < 50`    |
> | 小于等于 | `{<key>:{$lte:<value>}}` | `db.mycol.find({"likes":{$lte:50}}).pretty()` | `where likes <= 50`   |
> | 大于     | `{<key>:{$gt:<value>}}`  | `db.mycol.find({"likes":{$gt:50}}).pretty()`  | `where likes > 50`    |
> | 大于等于 | `{<key>:{$gte:<value>}}` | `db.mycol.find({"likes":{$gte:50}}).pretty()` | `where likes >= 50`   |
> | 不等于   | `{<key>:{$ne:<value>}}`  | `db.mycol.find({"likes":{$ne:50}}).pretty()`  | `where likes != 50`   |
>
> 演示：
>
> a.MongoDB中的AND操作符
>
> 语法：
>
> ```
> #在find()方法中，如果通过使用’，‘将它们分开传递多个键，则 MongoDB 将其视为AND条件。 以下是AND的基本语法
> >db.mycol.find(
>    {
>       $and: [
>          {key1: value1}, {key2:value2}
>       ]
>    }
> ).pretty()
> 
> ```
>
> b.MongoDB中的OR操作符
>
> 语法：
>
> ```
> #在要根据OR条件查询文档，需要使用$or关键字。 以下是OR条件的基本语法
> >db.mycol.find(
>    {
>       $or: [
>          {key1: value1}, {key2:value2}
>       ]
>    }
> ).pretty()
> 
> ```
>
> c.使用 AND 和 OR 联合使用

##### 3.3更新文档

> 1>update()：更新现有文档中的值
>
> 语法：
>
> ```
> db.COLLECTION_NAME.update(SELECTION_CRITERIA, UPDATED_DATA)
> 
> ```
>
> update函数执行数据更新操作，该函数接受3个主要参数：criteria，action，options：
>
> - 参数criteria用于指定一个查询，查询选择将要更新的目标记录。
>
> - 参数action用于指定更新信息，也可以使用操作符来完成。
>
> - 参数options用于指定更新文档时的选项，可选值包括：upsert和multi。upsert可以指定如果数据存在就更新，不存在就创建数据；multi选项指定是否应该更新所有匹配的文档，或者只更新第一个文档（默认行为）
>
>   ```shell
>   > db.newCol.find({},{'_id':1,'name':1})
>   { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "aaa" }
>   { "_id" : 101, "name" : "aaa" }
>   { "_id" : 102, "name" : "abc" }
>   
>   #只显示name和_id字段，0表示隐藏字段，1表示显示字段
>   > db.newCol.find({'name':'aaa'},{'_id':1,'name':1})
>   { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "aaa" }
>   { "_id" : 101, "name" : "aaa" }
>   
>   #更新一条文档【如果查询的结果有多个，则只更新匹配到的第一条文档】
>   > db.newCol.update({'name':'aaa'},{$set:{"name":"zhangsan"}})
>   WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
>   > db.newCol.find()
>   { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "zhangsan" }
>   { "_id" : 101, "name" : "aaa" }
>   { "_id" : 102, "name" : "abc", "hobby" : "dance" }
>   > db.newCol.insert({
>   ... '_id':103,
>   ... 'name':"aaa"
>   ... })
>   WriteResult({ "nInserted" : 1 })
>   > db.newCol.find()
>   { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "zhangsan" }
>   { "_id" : 101, "name" : "aaa" }
>   { "_id" : 102, "name" : "abc", "hobby" : "dance" }
>   { "_id" : 103, "name" : "aaa" }
>   #更新查询到的所有的文档，只需要设置{multi:true}
>   > db.newCol.update({'name':'aaa'},{$set:{'name':'jack'}},{multi:true})
>   WriteResult({ "nMatched" : 2, "nUpserted" : 0, "nModified" : 2 })
>   > db.newCol.find()
>   { "_id" : ObjectId("5d67486f1738dd1b927a5ea4"), "name" : "zhangsan" }
>   { "_id" : 101, "name" : "jack" }
>   { "_id" : 102, "name" : "abc", "hobby" : "dance" }
>   { "_id" : 103, "name" : "jack" }
>   > 
>   
>   #mongodb
>   db.newCol.update({'name':'aaa'},{$set:{'name':'jack'}},{multi:true})
>   #sql语句：update newCol set name='jack' where name='aaa';
>   
>   ```
>
>
>   #练习：假设mycol集合，查询集合中年龄大于15的人的记录,将结果的人的年龄设置为20
>
>   db.user.update({'age':{$gt:15}},{$set:{'age':20}},{multi:true})
>
>   ```
> 2>save()：使用`save()`方法中传递的文档数据替换现有文档
> 
> 语法：
> 
> 
>   ```
>
> >db.COLLECTION_NAME.save({_id:ObjectId(),NEW_DATA})
>
> db.user.save({'_id':ObjectId("5d6776091738dd1b927a5eab"),'name':'aaa11','age':66,'score':100})
>
> ```
> 
> ```

##### 3.4删除文档

> MongoDB中的 `remove()`方法用于从集合中删除文档。 `remove()`方法接受两个参数。 一个是删除条件，第二个是标志：`justOne`。
>
> ​	criteria - (可选)符合删除条件的集合将被删除。
>
> ​	justOne - (可选)如果设置为`true`或`1`，则只删除一个文档
>
> 语法：
>
> ```
> >db.COLLECTION_NAME.remove(DELLETION_CRITTERIA)
> 
> #删除年龄大于等于20的人的信息
> db.user.remove({'age':{$gte:20}})   #删除匹配到的全部数据
> db.user.remove({'age':{$gte:20}},1)   #只删除匹配到的一条语句
> db.user.remove()    #清空集合
> 
> ```

#### 4.查询

##### 4.1投影

> 语法：
>
> ```
> >db.COLLECTION_NAME.find({},{KEY:1})
> 
> ```

##### 4.2限制筛选记录

> 1>limit方法
>
> 语法：
>
> ```
> > db.COLLECTION_NAME.find().limit(NUMBER)
> 
> db.user.find().limit(2)
> 
> ```
>
> 2>skip方法
>
> 语法：
>
> ```
> >db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)
> 
> db.user.find().limit(1).skip(1)
> db.user.find().limit(2).skip(1)
> 
> ```

##### 4.3对查询记录排序

> 语法：
>
> ```
> >db.COLLECTION_NAME.find().sort({KEY:1})
> 
> #mysql:asc  desc
> #mongodb:1  -1
> 
> ```

##### 4.4分组与聚合函数查询

> 1>aggregate()方法
>
> 语法：
>
> ```
> >db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)
> 
> ```
>
> 以下是可用聚合表达式的列表。
>
> | 表达式      | 描述                                                         | 示例                                                         |
> | ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
> | `$sum`      | 从集合中的所有文档中求出定义的值。                           | `db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : "$likes"}}}])` |
> | `$avg`      | 计算集合中所有文档的所有给定值的平均值。                     | `db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$avg : "$likes"}}}])` |
> | `$min`      | 从集合中的所有文档获取相应值的最小值。                       | `db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$min : "$likes"}}}])` |
> | `$max`      | 从集合中的所有文档获取相应值的最大值。                       | `db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$max : "$likes"}}}])` |
> | `$push`     | 将值插入到生成的文档中的数组中。                             | `db.mycol.aggregate([{$group : {_id : "$by_user", url : {$push: "$url"}}}])` |
> | `$addToSet` | 将值插入生成的文档中的数组，但不会创建重复项。               | `db.mycol.aggregate([{$group : {_id : "$by_user", url : {$addToSet : "$url"}}}])` |
> | `$first`    | 根据分组从源文档获取第一个文档。 通常情况下，这只适用于以前应用的“`$sort`”阶段。 | `db.mycol.aggregate([{$group : {_id : "$by_user", first_url : {$first : "$url"}}}])` |
> | `$last`     | 根据分组从源文档获取最后一个文档。通常情况下，这只适用于以前应用的“`$sort`”阶段。 | `db.mycol.aggregate([{$group : {_id : "$by_user", last_url : {$last : "$url"}}}])` |

> ```shell
> db.article.aggregate([{$group:{'_id':"$by_user",num:{$sum:"$likes"}}}]) #分组求和
> db.article.aggregate([{$group:{'_id':'$by_user','num':{$avg:'$likes'}}}])#分组求平均数
> 
> select by_user,sum(likes)  from article group by by_user;
> 
> ```

### 四、MongoDB和Python的交互

#### 1.安装pymongo

> pip  install pymongo

#### 2.使用

##### 2.1建立连接

> ```Python
> from pymongo import  MongoClient
> 
> #创建一个对象
> 
> #1
> #client = MongoClient()   #可以连接默认的主机和端口
> 
> 
> #2.可以明确制定主机和端口
> # client = MongoClient("localhost",27017)
> # client = MongoClient(host="localhost",port=27017)
> 
> #3.使用mongo  URI的方式
> client = MongoClient("mongodb://localhost:27017")
> 
> ```

##### 2.2获取数据库

> ```Python
> #二、获取数据库
> #mongodb的一个对象可以支持多个数据库，使用MOngoClient对象访问相关的属性和方法即可
> #语法：MongoCLient的对象.数据库名
> db = client.test
> print(db)
> 
> ```

##### 2.3获取集合

> ```Python
> #三、获取集合
> #1.
> col1 = db.student
> # print(col1)
> 
> #2.
> # col2 = db['student']
> # print(col2)
> 
> """
> MongoDB中的集合和数据库是懒创建
> 上述代码在mongodb服务器没有执行任何操作，
> 当第一个文档插入集合的时候才创建集合和数据库
> """
> 
> ```

##### 2.4文档操作

> 文档的增删改查
>
> ```Python
> from pymongo import  *
> 
> client = MongoClient("mongodb://localhost:27017")
> 
> db = client.test
> 
> col1 = db.student
> 
> #四、插入文档
> #mongodb中的数据使用json方式来表示文档，在Python中使用字典表示文档
> stu1 = {
>  'id':101,
>  'name':"zhangsan",
>  'age':10
> }
> 
> #1.插入单条数据
> #1.1
> #返回值为当前文档的_id值
> # result1 = col1.insert(stu1)
> # print(result1)
> 
> #1.2
> #insert_one()
> col1.insert_one(stu1)
> 
> 
> #2.插入多条数据
> stu2 = {
>  'id':102,
>  'name':"lisi",
>  'age':12
> }
> stu3 = {
>  'id':103,
>  'name':"aaa",
>  'age':16
> }
> #2.1
> # result1 = col1.insert([stu2,stu3])
> # print(result1)
> 
> #2.2insert_many
> col1.insert_many([stu2,stu3])
> 
> 
> #一、更新
> #update默认只修改一个文档
> # condition = {"name":"lisi"}
> # stu = col1.find_one(condition)
> # print(stu)
> # stu["age"] = 20
> # col1.update(condition,stu)
> 
> 
> #update_one()
> condition = {"name":"lisi"}
> stu = col1.find_one(condition)
> stu["age"] = 20
> col1.update_one(condition,{'$set':stu})
> 
> 
> #update_many()
> # condition = {"age":{"$gt":20}}    #查询条件
> # col1.update_many(condition,{"$inc":{"age":1}})  #给age增加1
> 
> 
> #二、删除
> #remove 默认删除匹配到的全部数据
> # col1.remove({'age':{'$lte':15}})
> 
> #delete_one()
> # col1.delete_one({'age':{'$lte':15}})
> 
> #delete_many()
> # col1.delete_many({'age':{'$lte':15}})
> 
> 
> #三、查询
> # result = col1.find_one({"name":"lisi"})
> # print(result)
> #
> # result = col1.find_one({"age":{"$gt":15}})
> # print(result)
> 
> #会查找所有符合条件的结果，返回一个可迭代对象，其中的元素为符合条件的字典
> result = col1.find({"age":{"$gt":15}})
> print(result)
> for item in result:
>  print(item)
> 
> #其他用法
> #统计全部的条数
> print(col1.find().count())
> 
> #排序
> result = col1.find().sort("age",ASCENDING)
> print(result)
> for item in result:
>  print(item)
> 
> 
> result = col1.find().sort("age",ASCENDING).skip(1).limit(1)
> 
> ```

# Day5 Redis

### 一、Redis基础【掌握】

#### 1.概念

> Redis是一个开源，存储键值对的数据库，用于构建高性能，可扩展的web应用程序
>
> 特点：
>
> ​	a.将数据完全保存在内存中
>
> ​	b.与其他的键值存储系统比较，拥有更加丰富的数据类型
>
> ​	c.用作缓存较多

#### 2.Redis的优点

> a.读取/获取/设置速度极快
>
> b.支持丰富的数据类型【字符串，数字，列表，集合，有序集合，哈希：键值对】
>
> c.原子性【确保两个客户端并发访问，都能访问到最新的值】
>
> d.多使用工具【1.缓存，2.web程序中的会话，网页命中计数】

#### 3.Redis与其他键值系统

> Redis是内存数据库，同时也是一个键值存储数据库，拥有复杂的数据类型，操作简便

#### 4.与MySQL的区别【面试题】

> mysql是关系型数据库，主要用于持久化数据，将数据存储在硬盘上，在数据量比较大的情况下，数据的读写速度慢
>
> Redis是Nosql【非关系型数据库】，也被称为缓存数据库，数据被存储在缓存中，缓存的读写速度非常快，提高工作效率，但是保存时间有限
>
> a.类型上
>
> ​	mysql是关系型数据库，Redis是缓存数据库
>
> b.作用上
>
> ​	mysql用于持久化数据到硬盘，功能强大，但是速度慢【偏向于存数据】
>
> ​	Redis用于存储使用频繁的数据到缓存中，读取速度快【偏向于取数据】，使用场景：排行榜，计数器，好友关注，粉丝数
>
> c.需求上
>
> ​	mysql和redis在同一个项目中，一般会根据需求配合使用
>
> d.存储上
>
> ​	mysql：数据存储在磁盘上，redis:数据存储在内存中

### 二、Redis 的安装

> ##### 第一步：安装Redis，打开终端执行以下命令
>
> ```
> sudo apt-get install redis-server
> ```
>
> 第二步：启动Redis
>
> ```
> redis-server
> ```
>
> 第三步：检查Redis是否正在工作
>
> ```
> redis-cli
> ```
>
> 执行完得到的结果： `127.0.0.1:6379>`则说明正常工作
>
> 说明：`127.0.0.1`是计算机的IP地址，`6379`是运行Redis服务器的端口。 
>
> 第四步：执行`PING`命令。
>
> ```
> redis 127.0.0.1:6379> ping 
> PONG
> ```
>
> 得到结果为PONG表明**Redis**已成功安装
>
> 注意：在redis的server端，维护着多个数据库（默认为16个）
> 　        所有的数据库以数组的形式保存在redisServer结构中

### 三、Redis keys 命令

> 下表给出了与 Redis 键相关的基本命令：
>
> | 序号 | 命令及描述                                                   |
> | ---- | ------------------------------------------------------------ |
> | 1    | DEL key该命令用于在 key 存在时删除 key                       |
> |      |                                                              |
> | 2    | EXISTS key 检查给定 key 是否存在。                           |
> | 3    | EXPIRE key seconds为给定 key 设置过期时间。                  |
> |      |                                                              |
> | 4    | PEXPIRE key milliseconds 设置 key 的过期时间以毫秒计。       |
> |      |                                                              |
> | 5    | KEYS pattern 查找所有符合给定模式( pattern)的 key 。         |
> | 6    | MOVE key db 将当前数据库的 key 移动到给定的数据库 db 当中。  |
> | 7    | PERSIST key 移除 key 的过期时间，key 将持久保持。            |
> | 8    | PTTL key 以毫秒为单位返回 key 的剩余的过期时间。             |
> | 9    | TTL key 以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。 |
> | 10   | RANDOMKEY 从当前数据库中随机返回一个 key 。                  |
> | 11   | RENAME key newkey 修改 key 的名称                            |
> |      |                                                              |
> | 12   | TYPE key 返回 key 所储存的值的类型。                         |

> ```shell
> keys  * :查询所有，*表示任意长度的任意字符
> ping:测试redis连接是否存活
> dbsize:返回数据库中键的个数
> ctrl+d/ctrl+c/quit/exit:退出redis客户端
> 
> 演示命令：
> rock@rockrong:~$ redis-cli
> 127.0.0.1:6379> ping
> PONG
> 127.0.0.1:6379> dbsize
> (integer) 0
> 127.0.0.1:6379> select 1
> OK
> 127.0.0.1:6379[1]> select 12
> OK
> 127.0.0.1:6379[12]> select 1
> OK
> 127.0.0.1:6379[1]> keys *
> (empty list or set)
> 127.0.0.1:6379[1]> dbsize
> (integer) 0
> 
> 
> 127.0.0.1:6379[1]> del subject
> (integer) 1
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "weight"
> 127.0.0.1:6379[1]> exists name
> (integer) 1
> 127.0.0.1:6379[1]> exists subject
> (integer) 0
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "weight"
> 127.0.0.1:6379[1]> expire score 5
> (integer) 1
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "weight"
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "gender"
> 5) "weight"
> 127.0.0.1:6379[1]> move weight 8
> (integer) 1
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "weight"
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "gender"
> 5) "weight"
> 127.0.0.1:6379[1]> move weight 8
> (integer) 1
> ```

### 四、数据类型

> Redis支持`5`种数据类型。

#### 1.字符串

> String是redis最基本的数据类型，最大能存储512M的数据，string可以存储普通文本，json数据，特殊格式的数据【图片，音视频，序列化对象等】，简单来说，string类型可以存储任意类型的数据
>
> redis字符串的应用场景：
>
> ​	a.临时存储用户信息以及用户登录状态
>
> ​	b.存储用户的订单信息
>
> ​	c.存储ip地址，判断该ip访问某个资源的次数
>
> ​	d.设定用户登录的过期时间
>
> 下表列出了一些用于在**Redis**中管理字符串的基本命令。
>
> | 编号 | 命令                          | 描述说明                                   |
> | ---- | ----------------------------- | ------------------------------------------ |
> | 1    | SET key value                 | 此命令设置指定键的值。                     |
> | 2    | GET key                       | 获取指定键的值。                           |
> | 3    | GETRANGE key start end        | 获取存储在键上的字符串的子字符串。         |
> | 4    | GETSET key value              | 设置键的字符串值并返回其旧值。             |
> | 5    | GETBIT key offset             | 返回在键处存储的字符串值中偏移处的位值。   |
> | 6    | MGET key1 key2..              | 获取所有给定键的值                         |
> | 7    | SETBIT key offset value       | 存储在键上的字符串值中设置或清除偏移处的位 |
> | 8    | SETEX key seconds value       | 使用键和到期时间来设置值                   |
> | 10   | SETRANGE key offset value     | 在指定偏移处开始的键处覆盖字符串的一部分   |
> | 9    | SETNX key value               | 设置键的值，仅当键不存在时                 |
> | 12   | MSET key value key value …    | 为多个键分别设置它们的值                   |
> | 11   | STRLEN key                    | 获取存储在键中的值的长度                   |
> | 13   | MSETNX key value key value …  | 为多个键分别设置它们的值，仅当键不存在时   |
> | 14   | PSETEX key milliseconds value | 设置键的值和到期时间(以毫秒为单位)         |
> | 16   | INCRBY key increment          | 将键的整数值按给定的数值增加               |
> | 15   | INCR key                      | 将键的整数值增加`1`                        |
> | 17   | INCRBYFLOAT key increment     | 将键的浮点值按给定的数值增加               |
> | 18   | DECR key                      | 将键的整数值减`1`                          |
> | 19   | DECRBY key decrement          | 按给定数值减少键的整数值                   |
> | 20   | APPEND key value              | 将指定值附加到键                           |

> redis数据库中，默认有16个数据库，数据库名称默认为0~15,一旦登录redis，默认在0库中
>
> 切换数据库：select   num
>
> 注意：redis中的命令不区分大小写，如：SET,Set和set表示同一个关键字，字符串值的最大长度为512M

> a.设置
>
> ```shell
> set  key value  #添加一对键值对【如果键不存在，则直接添加；如果建存在，则会被覆盖】
> mset key value key value #添加多对键值对
> setex key seconds value  #添加一对键值对，但是设置过期时间，时间一到，该键值对从内存消失
> setnx key value  #添加一对键值对【如果键存在，则添加失败；如果键不存在，则添加成功】
> ```
>
> b.获取
>
> ```shell
> get  key   #获取指定key的value值
> getrange key start end  #获取指定key的value值的一部分，[start，end],字符串的下标从0开始，截取字符串：包头包尾
> getset  key  value   #给指定的key重新设置value值，同时获取原来的value值
> mget  key key ....  #同时获取多个key分别对应的value值
> ```
>
> c.运算
>
> ```shell
> incr  key   #将key对应的value值加1 ，注意：value为数字
> decr  key   #将key对应的value值减1 ，注意：value为数字
> incrby key increment   #给指定的key的value加指定的值
> decrby key increment   #给指定的key的value减指定的值
> ```
>
> d.其他
>
> ```shell
> append key value   #给指定key的value值追加一个新的内容
> strlen key   #获取指定key的value值的长度
> substr key start  end   #截取子字符串，start和end表示字符串的索引，从0开始，也开始是负数
> 
> ```
>
> ```shell
> 演示命令：
> 127.0.0.1:6379[1]> set name 'xiaoming'
> OK
> 127.0.0.1:6379[1]> get name
> "xiaoming"
> 127.0.0.1:6379[1]> set name 'jack'
> OK
> 127.0.0.1:6379[1]> get name
> "jack"
> 127.0.0.1:6379[1]> set age 18
> OK
> 127.0.0.1:6379[1]> set score 100
> OK
> 127.0.0.1:6379[1]> set hobby 'sing'
> OK
> 127.0.0.1:6379[1]> mset gender 'male' subject 'chinese'
> OK
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "subject"
> 127.0.0.1:6379[1]> values *
> (error) ERR unknown command 'values'
> 127.0.0.1:6379[1]> setex height 10 172.0
> OK
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "subject"
> 7) "height"
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "subject"
> 127.0.0.1:6379[1]> setnx hobby 'dance'
> (integer) 0
> 127.0.0.1:6379[1]> get hobby
> "sing"
> 127.0.0.1:6379[1]> setnx weight 56
> (integer) 1
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "subject"
> 7) "weight"
> 127.0.0.1:6379[1]> get name
> "jack"
> 127.0.0.1:6379[1]> setrange name 1 'zhangsan'
> (integer) 9
> 127.0.0.1:6379[1]> get name
> "jzhangsan"
> 127.0.0.1:6379[1]> keys *
> 1) "age"
> 2) "name"
> 3) "hobby"
> 4) "score"
> 5) "gender"
> 6) "subject"
> 7) "weight"
> 127.0.0.1:6379[1]> get hobby
> "sing"
> 127.0.0.1:6379[1]> getrange hobby 2 3
> "ng"
> 127.0.0.1:6379[1]> getrange hobby 0 3
> "sing"
> 127.0.0.1:6379[1]> get gender
> "male"
> 127.0.0.1:6379[1]> getset gender hhhhh
> "male"
> 127.0.0.1:6379[1]> get gender
> "hhhhh"
> 127.0.0.1:6379[1]> mget name gender subject weight
> 1) "jzhangsan"
> 2) "hhhhh"
> 3) "chinese"
> 4) "56"
> 127.0.0.1:6379[1]> get age
> "18"
> 127.0.0.1:6379[1]> incr age
> (integer) 19
> 127.0.0.1:6379[1]> decr age
> (integer) 18
> 127.0.0.1:6379[1]> incrby age 7
> (integer) 25
> 127.0.0.1:6379[1]> decrby age 10
> (integer) 15
> 127.0.0.1:6379[1]> get age
> "15"
> 127.0.0.1:6379[1]> get name
> "jzhangsan"
> 127.0.0.1:6379[1]> append name 'hello'
> (integer) 14
> 127.0.0.1:6379[1]> get name
> "jzhangsanhello"
> 127.0.0.1:6379[1]> append name aaa
> (integer) 17
> 127.0.0.1:6379[1]> get name
> "jzhangsanhelloaaa"
> 127.0.0.1:6379[1]> strlen name
> (integer) 17
> 127.0.0.1:6379[1]> substr name -4 -1
> "oaaa"
> 127.0.0.1:6379[1]> substr name 13 16
> "oaaa"
> 127.0.0.1:6379[1]> substr name -1 -4
> ""
> 127.0.0.1:6379[1]> substr name -1 -4 -1
> (error) ERR wrong number of arguments for 'substr' command
> 127.0.0.1:6379[1]> 
> ```

#### 2.哈希

> 哈希值：被称为散列函数，通常使用一个短的随机字母和数字组成的字符串序列表示
>
> Redis哈希(Hashes)是键值对的集合。Redis哈希是字符串字段和字符串值之间的映射。因此，它们用于存储对象。
>
> | 序号 | 命令                                      | 说明                                   |
> | ---- | ----------------------------------------- | -------------------------------------- |
> | 1    | HDEL key field2 [field2\]                 | 删除一个或多个哈希字段。               |
> | 2    | HEXISTS key field                         | 判断是否存在散列字段。                 |
> | 3    | HGET key field                            | 获取存储在指定键的哈希字段的值。       |
> | 4    | HGETALL key                               | 获取存储在指定键的哈希中的所有字段和值 |
> | 5    | HINCRBY key field increment               | 将哈希字段的整数值按给定数字增加       |
> | 6    | HINCRBYFLOAT key field increment          | 将哈希字段的浮点值按给定数值增加       |
> | 7    | HKEYS key                                 | 获取哈希中的所有字段                   |
> | 8    | HLEN key                                  | 获取散列中的字段数量                   |
> | 9    | HMGET key field1 [field2\]                | 获取所有给定哈希字段的值               |
> | 10   | [HMSET key field1 value1 field2 value2 \] | 为多个哈希字段分别设置它们的值         |
> | 11   | HSET key field value                      | 设置散列字段的字符串值                 |
> | 12   | HSETNX key field value                    | 仅当字段不存在时，才设置散列字段的值   |
> | 13   | HVALS key                                 | 获取哈希中的所有值                     |

> a.设置
>
> ```shell
> hset key field value  #设置一对键值对，同时需要自定义一个散列字段
> hmset key field1 value1 field2 value2   ##设置多对键值对，同时需要自定义多个散列字段，只需要定义一个key
> 
> #注意：在同一个key中可以存储多个field【key用于存储包含一个对象基本信息的字段】
> 
> ```
>
> b.获取
>
> ```shell
> hget key field    #获取存储在指定键的哈希字段的值
> hmget key field1  field2... #获取指定key中中多个字段的值
> hgetall   key   #获取指定key中所有的字段和值
> hkeys  key    #获取指定key中所有字段
> hvals key   #获取指定key中所有字段的值
> hlen  key    #获取指定key中数据的个数
> 
> ```
>
> c.其他
>
> ```shell
> hexists key  field    #判断指定key中的指定字段是否存在，如果存在返回1，否则返回0
> hdel key  field     #删除指定key中的指定的字段以及值
> 
> ```

> ```
> 演示命令：
> 127.0.0.1:6379[1]> select 2
> OK
> 127.0.0.1:6379[2]> hset ukey name 'zhangsan'
> (integer) 1
> 127.0.0.1:6379[2]> kes *
> (error) ERR unknown command 'kes'
> 127.0.0.1:6379[2]> keys * 
> 1) "ukey"
> 127.0.0.1:6379[2]> hmset ukey1 name 'jack'
> OK
> 127.0.0.1:6379[2]> keys * 
> 1) "ukey"
> 2) "ukey1"
> 127.0.0.1:6379[2]> hset ukey age 10
> (integer) 1
> 127.0.0.1:6379[2]> hget ukey name
> "zhangsan"
> 127.0.0.1:6379[2]> hget ukey age
> "10"
> 127.0.0.1:6379[2]> hmget ukey name age
> 1) "zhangsan"
> 2) "10"
> 127.0.0.1:6379[2]> keys *
> 1) "ukey"
> 2) "ukey1"
> 127.0.0.1:6379[2]> hgetall ukey
> 1) "name"
> 2) "zhangsan"
> 3) "age"
> 4) "10"
> 127.0.0.1:6379[2]> hkeys ukey
> 1) "name"
> 2) "age"
> 127.0.0.1:6379[2]> hlen ukey
> (integer) 2
> 127.0.0.1:6379[2]> hvals ukey
> 1) "zhangsan"
> 2) "10"
> 127.0.0.1:6379[2]> hexists ukey name
> (integer) 1
> 127.0.0.1:6379[2]> hexists ukey gender
> (integer) 0
> 127.0.0.1:6379[2]> hdel ukey name
> (integer) 1
> 127.0.0.1:6379[2]> hgetall ukey
> 1) "age"
> 2) "10"
> ```

#### 3.列表

> Redis列表只是字符串列表，按插入顺序排序。您可以向Redis列表的头部或尾部添加元素。
>
> 列表的最大长度为`2^32 - 1`个元素(`4294967295`，每个列表可容纳超过`40`亿个元素)。
>
> 下表列出了与列表相关的一些基本命令。
>
> | 序号 | 命令                                  | 说明                                                         |
> | ---- | ------------------------------------- | ------------------------------------------------------------ |
> | 1    | BLPOP key1 [key2 \] timeout           | 删除并获取列表中的第一个元素，或阻塞，直到有一个元素可用     |
> | 2    | BRPOP key1 [key2 \] timeout           | 删除并获取列表中的最后一个元素，或阻塞，直到有一个元素可用   |
> | 3    | BRPOPLPUSH source destination timeout | 从列表中弹出值，将其推送到另一个列表并返回它; 或阻塞，直到一个可用 |
> | 4    | LINDEX key index                      | 通过其索引从列表获取元素                                     |
> | 5    | LINSERT key BEFORE/AFTER pivot value  | 在列表中的另一个元素之前或之后插入元素                       |
> | 6    | LLEN key                              | 获取列表的长度                                               |
> | 8    | LPUSH key value1 [value2\]            | 将一个或多个值添加到列表                                     |
> | 7    | LPOP key                              | 删除并获取列表中的第一个元素                                 |
> | 9    | LPUSHX key value                      | 仅当列表存在时，才向列表添加值                               |
> | 11   | LREM key count value                  | 从列表中删除元素                                             |
> | 10   | LRANGE key start stop                 | 从列表中获取一系列元素                                       |
> | 12   | LSET key index value                  | 通过索引在列表中设置元素的值                                 |
> | 13   | LTRIM key start stop                  | 修剪列表的指定范围                                           |
> | 14   | RPOP key                              | 删除并获取列表中的最后一个元素                               |
> | 15   | RPOPLPUSH source                      | 删除列表中的最后一个元素，将其附加到另一个列表并返回         |
> | 16   | RPUSH key value1 [value2\]            | 将一个或多个值附加到列表                                     |
> | 17   | RPUSHX key value                      | 仅当列表存在时才将值附加到列表                               |

> a.设置
>
> ```shell
> lpush  list value   #在指定列表的头部添加一个指定的value
> rpush  list value   #在指定列表的尾部添加一个指定的value
> 
> linsert list before/after  old  new  #在指定列表的指定元素的前或者后面添加一个指定的value
> 
> lset list  index value   #在指定列表中的指定索引处修改原来的值为新的value
> 
> ```
>
> b.获取
>
> ```shell
> lrange list   start  end  #获取指定列表中指定区间内的元素，索引从0开始，包头包尾
> 
> llen   list   #获取列表的长度
> 
> lindex list   index #从指定列表中获取指定索引处的value值
> 
> lpop list    #删除并获取头部的value
> rpop list     #删除并获取尾部的value
> 
> ```
>
> c.其他
>
> ```shell
> ltrim  list  start stop   #根据指定范围裁剪原列表
> 
> ```
>
> ```shell
> 演示命令：
> 127.0.0.1:6379[2]> select 3
> OK
> 127.0.0.1:6379[3]> lpush alist redis
> (integer) 1
> 127.0.0.1:6379[3]> lpush alist mongodb
> (integer) 2
> 127.0.0.1:6379[3]> lpush alist mysql
> (integer) 3
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "mysql"
> 2) "mongodb"
> 3) "redis"
> 127.0.0.1:6379[3]> lrange alist 0 2
> 1) "mysql"
> 2) "mongodb"
> 3) "redis"
> 127.0.0.1:6379[3]> lrange alist 0 1
> 1) "mysql"
> 2) "mongodb"
> 127.0.0.1:6379[3]> lrange alist 0 0
> 1) "mysql"
> 127.0.0.1:6379[3]> lpush alist server
> (integer) 4
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "server"
> 2) "mysql"
> 3) "mongodb"
> 4) "redis"
> 127.0.0.1:6379[3]> rpush alist client
> (integer) 5
> 127.0.0.1:6379[3]> lrange alist  0 10
> 1) "server"
> 2) "mysql"
> 3) "mongodb"
> 4) "redis"
> 5) "client"
> 127.0.0.1:6379[3]> linsert alist after mongodb  aaaaa
> (integer) 6
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "server"
> 2) "mysql"
> 3) "mongodb"
> 4) "aaaaa"
> 5) "redis"
> 6) "client"
> 127.0.0.1:6379[3]> linsert alist before mongodb  bbbbb
> (integer) 7
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "server"
> 2) "mysql"
> 3) "bbbbb"
> 4) "mongodb"
> 5) "aaaaa"
> 6) "redis"
> 7) "client"
> 127.0.0.1:6379[3]> lset alist 2 abcabc
> OK
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "server"
> 2) "mysql"
> 3) "abcabc"
> 4) "mongodb"
> 4) "aaaaa"
> 5) "redis"
> 127.0.0.1:6379[3]> llen alist
> (integer) 5
> 127.0.0.1:6379[3]> lindex alist 2
> "mongodb"
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "mysql"
> 2) "abcabc"
> 3) "mongodb"
> 4) "aaaaa"
> 5) "redis"
> 127.0.0.1:6379[3]> ltrim alist 0 3
> OK
> 127.0.0.1:6379[3]> lrange alist 0 10
> 1) "mysql"
> 2) "abcabc"
> 3) "mongodb"
> 4) "aaaaa"
> 
> ```

#### 4.集合

> Redis集合是唯一字符串的无序集合。 唯一值表示集合中不允许键中有重复的数据。
>
> 一个集合中的最大成员数量为`2^32 - 1`(即`4294967295`，每个集合中元素数量可达`40`亿个)个。
>
> 下表列出了与集合相关的一些基本命令。
>
> | 序号 | 命令                                            | 说明                             |
> | ---- | ----------------------------------------------- | -------------------------------- |
> | 1    | SADD key member1 [member2\]                     | 将一个或多个成员添加到集合       |
> | 2    | SCARD key                                       | 获取集合中的成员数               |
> | 3    | SDIFF key1 [key2\]                              | 减去多个集合                     |
> | 4    | SDIFFSTORE destination key1 [key2\]             | 减去多个集并将结果集存储在键中   |
> | 5    | SINTER key1 [key2\]                             | 相交多个集合                     |
> | 6    | SINTERSTORE destination key1 [key2\]            | 交叉多个集合并将结果集存储在键中 |
> | 7    | SISMEMBER key member                            | 判断确定给定值是否是集合的成员   |
> | 8    | SMOVE source destination member                 | 将成员从一个集合移动到另一个集合 |
> | 9    | SPOP key                                        | 从集合中删除并返回随机成员       |
> | 10   | SRANDMEMBER key [count\]                        | 从集合中获取一个或多个随机成员   |
> | 11   | SREM key member1 [member2\]                     | 从集合中删除一个或多个成员       |
> | 12   | SUNION key1 [key2\]                             | 添加多个集合                     |
> | 13   | SUNIONSTORE destination key1 [key2\]            | 添加多个集并将结果集存储在键中   |
> | 14   | SSCAN key cursor [MATCH pattern\] [COUNT count] | 递增地迭代集合中的元素           |

> a.设置
>
> ```shell
> sadd  set  value    #在指定的集合中添加一个指定的value
> 
> ```
>
> b.获取
>
> ```shell
> smembers set    #获取指定集合中的所有value
> scard  set   #获取指定集合中成员的个数
> 
> ```
>
> c.其他
>
> ```shell
> sinter   set1  set2   #求两个集合的交集
> sdiff  set1 set2   #求两个集合的差集
> sismember  set  value  #在指定集合中判断指定的值是否存在
> 
> ```

> ```shell
> 演示命令：
> 127.0.0.1:6379[3]> select 4
> OK
> 127.0.0.1:6379[4]> sadd aset aaaa
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset aaaa
> (integer) 0
> 127.0.0.1:6379[4]> smembers aset
> 1) "aaaa"
> 127.0.0.1:6379[4]> sadd aset bbbb
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset cccc
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset dddd
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset  eeeee
> (integer) 1
> 127.0.0.1:6379[4]> smembers aset
> 1) "dddd"
> 2) "bbbb"
> 3) "cccc"
> 4) "aaaa"
> 5) "eeeee"
> 127.0.0.1:6379[4]> scard aset
> (integer) 5
> 127.0.0.1:6379[4]> sadd aset1 aaaa
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset1 bbbbb
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset1 cccc
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset1 zhangsan
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset1 lisi
> (integer) 1
> 127.0.0.1:6379[4]> sadd aset1 jack
> (integer) 1
> 127.0.0.1:6379[4]> smembers aset
> 1) "dddd"
> 2) "bbbb"
> 3) "cccc"
> 4) "aaaa"
> 5) "eeeee"
> 127.0.0.1:6379[4]> smembers aset1
> 1) "zhangsan"
> 2) "cccc"
> 3) "aaaa"
> 4) "bbbbb"
> 5) "lisi"
> 6) "jack"
> 127.0.0.1:6379[4]> sinter aset aset1
> 1) "cccc"
> 2) "aaaa"
> 127.0.0.1:6379[4]> sdiff aset aset1
> 1) "bbbb"
> 2) "dddd"
> 3) "eeeee"
> 127.0.0.1:6379[4]> sismember aset aaaa
> (integer) 1
> 127.0.0.1:6379[4]> sismember aset zhangsan
> (integer) 0
> ```

#### 5.有序集合

> Redis中的有序集合和集合一样，只是成员有序的，但是仍然不允许重复元素出现
>
> 在有序集合中，每个元素都会关联一个double类型的分数，redis通过分数为集合中的成员从小到大进行排序
>
> 注意：有序集合中的成员是唯一的，但是分数【score】可以重复
>
> 下表列出了 redis 有序集合的基本命令:
>
> | 序号 | 命令及描述                                                   |
> | ---- | ------------------------------------------------------------ |
> | 1    | ZADD key score1 member1 [score2 member2\]向有序集合添加一个或多个成员，或者更新已存在成员的分数 |
> | 2    | ZCARD key 获取有序集合的成员数                               |
> | 3    | ZCOUNT key min max 计算在有序集合中指定区间分数的成员数      |
> | 4    | ZINCRBY key increment member 有序集合中对指定成员的分数加上增量 increment |
> | 5    | ZINTERSTORE destination numkeys key [key ...\] 计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中 |
> | 6    | ZLEXCOUNT key min max 在有序集合中计算指定字典区间内成员数量 |
> | 7    | [ZRANGE key start stop [WITHSCORES\]通过索引区间返回有序集合成指定区间内的成员 |
> | 8    | ZRANGEBYLEX key min max [LIMIT offset count\]通过字典区间返回有序集合的成员 |
> | 9    | ZRANGEBYSCORE key min max [WITHSCORES\] [LIMIT]通过分数返回有序集合指定区间内的成员 |
> | 10   | ZRANK key member 返回有序集合中指定成员的索引                |
> | 11   | ZREM key member member...移除有序集合中的一个或多个成员      |
> | 12   | ZREMRANGEBYLEX key min max 移除有序集合中给定的字典区间的所有成员 |
> | 13   | ZREMRANGEBYRANK key start stop 移除有序集合中给定的排名区间的所有成员 |
> | 14   | ZREMRANGEBYSCORE key min max移除有序集合中给定的分数区间的所有成员 |
> | 15   | ZREVRANGE key start stop [WITHSCORES\]返回有序集中指定区间内的成员，通过索引，分数从高到底 |
> | 16   | ZREVRANGEBYSCORE key max min [WITHSCORES\]返回有序集中指定分数区间内的成员，分数从高到低排序 |
> | 17   | ZREVRANK key member 返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序 |
> | 18   | ZSCORE key member 返回有序集中，成员的分数值                 |
> | 19   | ZUNIONSTORE destination numkeys key [key ...\]计算给定的一个或多个有序集的并集，并存储在新的 key 中 |
> | 20   | ZSCAN key cursor [MATCH pattern\] [COUNT count]迭代有序集合中的元素（包括元素成员和元素分值 |

> a.设置
>
> ```shell
> zadd   set  score1  value1 score2  value2....   #向指定有序集合中添加多个值
> 
> ```
>
> b.获取
>
> ```shell
> zrange  set   start stop #获取指定有序集合中指定区间内的成员
> zcard   set    #获取指定有序集合中成员的个数
> zscore  set  member   #获取指定有序集合中指定成员的分数值
> 
> zcount set  min  max  #在指定有序集合中统计分数值在指定区间内的成员的个数
> zrank set member   #在指定有序集合中获取指定成员的索引【score从小到大】
> zrevrank  set member   #在指定有序集合中获取指定成员的索引【score从大到小】
> 
> ```
>
> c.移除
>
> ```shell
> zrem set member    #移除指定有序集合中的指定的成员
> zremrangebyscore set  min   max    #移除有序集合中score值在指定区间内的成员
> zremrangebyrank  set start stop   #移除有序集合中指定索引区间内的成员
> 
> ```
>
> ```shell
> 演示命令
> 127.0.0.1:6379[4]> select 5
> OK
> 127.0.0.1:6379[5]> zadd z1 1 a 2 b 3 c 4 d
> (integer) 4
> 127.0.0.1:6379[5]> zrange z1  0 3
> 1) "a"
> 2) "b"
> 3) "c"
> 4) "d"
> 127.0.0.1:6379[5]> zcard z1
> (integer) 4
> 127.0.0.1:6379[5]> zadd z1 1 e 2 f
> (integer) 2
> 127.0.0.1:6379[5]> zrange z1  0 5
> 1) "a"
> 2) "e"
> 3) "b"
> 4) "f"
> 5) "c"
> 6) "d"
> 127.0.0.1:6379[5]> zscore z1 b
> "2"
> 127.0.0.1:6379[5]> zscore z1 f
> "2"
> 127.0.0.1:6379[5]> zcount z1 2 3
> (integer) 3
> 127.0.0.1:6379[5]> zcount z1 1 4
> (integer) 6
> 127.0.0.1:6379[5]> zrank z1 b
> (integer) 2
> 127.0.0.1:6379[5]> zrevrank z1 b
> (integer) 3
> 127.0.0.1:6379[5]> zrevrank z1 f
> (integer) 2
> 127.0.0.1:6379[5]> zrem z1 b
> (integer) 1
> 127.0.0.1:6379[5]> zrange z1 0 10
> 1) "a"
> 2) "e"
> 3) "f"
> 4) "c"
> 5) "d"
> 127.0.0.1:6379[5]> zremrangebyscore z1 2 3
> (integer) 2
> 127.0.0.1:6379[5]> zrange z1 0 10
> 1) "a"
> 2) "e"
> 3) "d"
> 127.0.0.1:6379[5]> zadd z1 5 f 6 g 7 h 8 i 9 j
> (integer) 5
> 127.0.0.1:6379[5]> zrange z1 0 10
> 1) "a"
> 2) "e"
> 3) "d"
> 4) "f"
> 5) "g"
> 6) "h"
> 7) "i"
> 8) "j"
> 127.0.0.1:6379[5]> zremrangebyrank z1 0 2
> (integer) 3
> 127.0.0.1:6379[5]> 
> 127.0.0.1:6379[5]> zrange z1 0 10
> 1) "f"
> 2) "g"
> 3) "h"
> 4) "i"
> 5) "j"
> ```

### 五、与Python 交互

> 执行命令：pip3  install  redis
>
> 引入模块
>
> ##### from redis import StrictRedis
>
> 这个模块中提供了StrictRedis对象(Strict严格)，用于连接redis服务器，并按照不同类型提供 了不同方法，进行交互操作
>
> ##### StrictRedis对象方法:
>
> 通过init创建对象，指定参数host、port与指定的服务器和端口连接，host默认为localhost，port默认为6379，db默认为0
> sr = StrictRedis(host='localhost', port=6379, db=0)
>
> ```Python
> # from redis import  StrictRedis
> import  redis
> 
> # sr = redis.StrictRedis(host='localhost',port=6379,db=11)
> sr = redis.Redis(host='localhost',port=6379)
> 
> res1 = sr.set('name','lisi')
> print(res1)
> res11 = sr.get('name')
> print(res11)
> 
> res21 = sr.set('name','jack')
> print(res21)
> res22 = sr.get('name')
> print(res22)
> 
> res3 = sr.delete('name')
> print(res3)
> 
> res31 = sr.get('name')
> print(res31)
> 
> 
> """
> #1.
>  set()
>  setex()
>  mset()
>  hset()
>  sadd()
> #2
>  get()
>  mget()
>  getrange()   
> """
> ```
>
> ```Python
> # from redis import  StrictRedis
> import  redis
> 
> # sr = redis.StrictRedis(host='localhost',port=6379,db=11)
> sr = redis.Redis(host='localhost',port=6379)
> 
> res1 = sr.set('name','lisi')
> print(res1)
> res11 = sr.get('name')
> print(res11)
> 
> res21 = sr.set('name','jack')
> print(res21)
> res22 = sr.get('name')
> print(res22)
> 
> res3 = sr.delete('name')
> print(res3)
> 
> res31 = sr.get('name')
> print(res31)
> 
> 
> """
> #1.
>  set()
>  setex()
>  mset()
>  hset()
>  sadd()
> #2
>  get()
>  mget()
>  getrange()   
> """
> ```